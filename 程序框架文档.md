# æ¥å£ç­›é€‰ç¨‹åº - è¯¦ç»†æ¡†æ¶æ–‡æ¡£

> **ä½œè€…**: ç‹ä»»è¶…ï¼ˆå»ºç­‘ç»“æ„æ‰€ï¼‰  
> **ç‰ˆæœ¬**: 2.0  
> **æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-10-21  
> **ä»£ç åˆ†æè¿­ä»£**: 3æ¬¡æ·±åº¦åˆ†æ

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆä¸ä¾èµ–](#2-æŠ€æœ¯æ ˆä¸ä¾èµ–)
3. [æ•´ä½“æ¶æ„](#3-æ•´ä½“æ¶æ„)
4. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#4-æ ¸å¿ƒæ¨¡å—è¯¦è§£)
5. [æ•°æ®å¤„ç†æµç¨‹](#5-æ•°æ®å¤„ç†æµç¨‹)
6. [é…ç½®ç³»ç»Ÿ](#6-é…ç½®ç³»ç»Ÿ)
7. [éƒ¨ç½²ä¸æ‰“åŒ…](#7-éƒ¨ç½²ä¸æ‰“åŒ…)
8. [å…³é”®ç®—æ³•](#8-å…³é”®ç®—æ³•)
9. [æ–‡ä»¶ç»“æ„](#9-æ–‡ä»¶ç»“æ„)
10. [æ‰©å±•ä¸ç»´æŠ¤](#10-æ‰©å±•ä¸ç»´æŠ¤)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

**æ¥å£ç­›é€‰ç¨‹åº**æ˜¯ä¸€ä¸ªä¼ä¸šçº§Excelæ•°æ®è‡ªåŠ¨åŒ–å¤„ç†å·¥å…·ï¼Œä¸»è¦æœåŠ¡äºå»ºç­‘ç»“æ„æ‰€çš„æ¥å£ç®¡ç†å·¥ä½œæµç¨‹ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½

- âœ… **6ç§æ¥å£ç±»å‹æ‰¹é‡è¯†åˆ«ä¸ç­›é€‰**
- âœ… **å¤šé¡¹ç›®å¹¶è¡Œå¤„ç†**ï¼ˆåŸºäºé¡¹ç›®å·è‡ªåŠ¨åˆ†ç»„ï¼‰
- âœ… **è§’è‰²æƒé™ç®¡ç†**ï¼ˆåŸºäºå§“åè§’è‰²è¡¨ï¼‰
- âœ… **è‡ªåŠ¨åŒ–å®šæ—¶å¤„ç†**ï¼ˆæ”¯æŒæ¯æ—¥å®šæ—¶ä»»åŠ¡ï¼‰
- âœ… **æ™ºèƒ½æ—¥æœŸç­›é€‰**ï¼ˆæ–°æ—§ä¸¤å¥—é€»è¾‘å¯åˆ‡æ¢ï¼‰
- âœ… **ç»“æœå¯¼å‡ºå¹¶ä¿æŒåŸå§‹Excelæ ¼å¼**
- âœ… **ç³»ç»Ÿæ‰˜ç›˜ä¸å¼€æœºè‡ªå¯åŠ¨**
- âœ… **å®æ—¶å¤„ç†ç›‘æ§**ï¼ˆç‹¬ç«‹ç›‘æ§çª—å£ï¼‰

### 1.3 åº”ç”¨åœºæ™¯

1. **æ—¥å¸¸æ¥å£ç®¡ç†**ï¼šæ¯æ—¥è‡ªåŠ¨åˆ·æ–°ã€ç­›é€‰ã€å¯¼å‡ºå¾…å¤„ç†æ¥å£
2. **å¤šé¡¹ç›®ååŒ**ï¼šåŒæ—¶å¤„ç†å¤šä¸ªé¡¹ç›®çš„æ¥å£æ•°æ®
3. **è§’è‰²åˆ†çº§ç®¡ç†**ï¼šä¸åŒè§’è‰²ï¼ˆå®¤ä¸»ä»»ã€æ‰€é•¿ã€è®¾è®¡äººå‘˜ï¼‰çœ‹åˆ°ä¸åŒèŒƒå›´çš„æ•°æ®
4. **å®šæ—¶è‡ªåŠ¨åŒ–**ï¼šæ¯æ—¥10:00å’Œ16:00è‡ªåŠ¨å¤„ç†å¹¶ç”ŸæˆæŠ¥å‘Š

---

## 2. æŠ€æœ¯æ ˆä¸ä¾èµ–

### 2.1 æ ¸å¿ƒæŠ€æœ¯

| æŠ€æœ¯ç±»åˆ« | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | ç”¨é€” |
|---------|---------|------|------|
| **ç¼–ç¨‹è¯­è¨€** | Python | 3.8 | ä¸»è¦å¼€å‘è¯­è¨€ï¼ˆWin7å…¼å®¹ï¼‰ |
| **GUIæ¡†æ¶** | Tkinter | å†…ç½® | å›¾å½¢ç”¨æˆ·ç•Œé¢ |
| **æ•°æ®å¤„ç†** | pandas | 1.1.5 | Excelæ•°æ®è¯»å–ä¸å¤„ç† |
| **Excelè¯»å†™** | openpyxl | 3.0.10 | xlsxæ ¼å¼å¤„ç†ï¼ˆå«æ ¼å¼ä¿æŒï¼‰ |
| **Excelè¯»å†™** | xlrd | 1.2.0 | xlsæ ¼å¼è¯»å– |
| **ç³»ç»Ÿæ‰˜ç›˜** | pystray | 0.19.4 | åå°è¿è¡Œä¸æ‰˜ç›˜å›¾æ ‡ |
| **å›¾åƒå¤„ç†** | Pillow | 8.4.0 | å›¾æ ‡å¤„ç† |
| **æ‰“åŒ…å·¥å…·** | PyInstaller | 4.10 | å¯æ‰§è¡Œæ–‡ä»¶æ‰“åŒ… |

### 2.2 Pythonä¾èµ–æ¸…å•

```python
# requirements.txt
pandas==1.1.5        # Excelæ•°æ®å¤„ç†æ ¸å¿ƒ
numpy==1.19.5        # æ•°å€¼è®¡ç®—æ”¯æŒ
openpyxl==3.0.10     # xlsxæ–‡ä»¶æ ¼å¼æ“ä½œ
xlrd==1.2.0          # xlsæ–‡ä»¶è¯»å–
pystray==0.19.4      # ç³»ç»Ÿæ‰˜ç›˜åŠŸèƒ½
Pillow==8.4.0        # å›¾æ ‡å›¾åƒå¤„ç†
```

### 2.3 ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 7/8/10/11
- **Pythonç‰ˆæœ¬**: 3.8ï¼ˆå‘ä¸‹å…¼å®¹Win7ï¼‰
- **å†…å­˜**: å»ºè®®2GBä»¥ä¸Š
- **ç£ç›˜ç©ºé—´**: ç¨‹åºæœ¬ä½“çº¦150MB

---

## 3. æ•´ä½“æ¶æ„

### 3.1 æ¶æ„å±‚æ¬¡å›¾ï¼ˆv2.1 é‡æ„åï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·äº¤äº’å±‚ (UI Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  çª—å£ç®¡ç†å™¨   â”‚  â”‚  ç›‘æ§å™¨çª—å£   â”‚  â”‚  ç³»ç»Ÿæ‰˜ç›˜     â”‚       â”‚
â”‚  â”‚(window.py)   â”‚  â”‚(Monitor.py) â”‚  â”‚  (pystray)   â”‚       â”‚
â”‚  â”‚  NEW! 306è¡Œ  â”‚  â”‚   422è¡Œ      â”‚  â”‚             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘ (å›è°ƒæœºåˆ¶)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚ (Logic Layer)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  åº”ç”¨ç¨‹åºæ§åˆ¶å™¨ (base.py - çº¦2500è¡Œ)                â”‚     â”‚
â”‚  â”‚  - äº‹ä»¶å¤„ç†  - è§’è‰²æƒé™  - å®šæ—¶å™¨  - é…ç½®ç®¡ç†       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  æ‰¹é‡æ–‡ä»¶è¯†åˆ«  â†’  ç­›é€‰é€»è¾‘  â†’  æ•°æ®å¤„ç†  â†’  ç»“æœå¯¼å‡º  â”‚     â”‚
â”‚  â”‚         (main.py - 3435è¡Œæ ¸å¿ƒé€»è¾‘)                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ç»“æœæ±‡æ€»ç”Ÿæˆ  (main2.py - æŒ‰ç§‘å®¤/é¡¹ç›®/æ—¶é—´åˆ†ç±»)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚ (Data Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Excelæºæ–‡ä»¶â”‚  â”‚ é…ç½®æ–‡ä»¶  â”‚  â”‚ è§’è‰²æƒé™è¡¨ â”‚  â”‚ ç»“æœæ–‡ä»¶  â”‚   â”‚
â”‚  â”‚  (6ç±»)    â”‚  â”‚JSON/YAMLâ”‚  â”‚  (xlsx)   â”‚  â”‚  (xlsx)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—å…³ç³»å›¾ï¼ˆv2.1 é‡æ„åï¼‰

```
base.py (åº”ç”¨ç¨‹åºæ§åˆ¶å™¨)
    â”‚
    â”œâ”€â”€> window.py (çª—å£ç®¡ç†å™¨) NEW!
    â”‚       â”œâ”€â”€> WindowManager.setup() - çª—å£åˆå§‹åŒ–
    â”‚       â”œâ”€â”€> WindowManager.display_excel_data() - æ•°æ®æ˜¾ç¤º
    â”‚       â”œâ”€â”€> WindowManager.enable_export_button() - æŒ‰é’®æ§åˆ¶
    â”‚       â””â”€â”€> WindowManager.update_file_info() - ä¿¡æ¯æ›´æ–°
    â”‚
    â”œâ”€â”€> main.py (æ•°æ®å¤„ç†æ ¸å¿ƒ)
    â”‚       â”œâ”€â”€> find_all_target_files1~6() - æ–‡ä»¶è¯†åˆ«
    â”‚       â”œâ”€â”€> process_target_file1~6() - æ•°æ®ç­›é€‰
    â”‚       â””â”€â”€> export_result_to_excel1~6() - ç»“æœå¯¼å‡º
    â”‚
    â”œâ”€â”€> main2.py (æ±‡æ€»ç”Ÿæˆ)
    â”‚       â””â”€â”€> write_export_summary() - ç”Ÿæˆæ±‡æ€»TXT
    â”‚
    â”œâ”€â”€> Monitor.py (ç›‘æ§å™¨)
    â”‚       â”œâ”€â”€> ProcessMonitor (ç›‘æ§çª—å£ç±»)
    â”‚       â””â”€â”€> log_message() (æ—¥å¿—è®°å½•)
    â”‚
    â””â”€â”€> config.json + config.yaml (é…ç½®æ–‡ä»¶)

tests/ (æµ‹è¯•å¥—ä»¶) NEW!
    â”œâ”€â”€> conftest.py (æµ‹è¯•é…ç½®)
    â””â”€â”€> test_window.py (24ä¸ªæµ‹è¯•ç”¨ä¾‹, 57%è¦†ç›–ç‡)
```

---

## 4. æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 4.0 window.py - çª—å£ç®¡ç†å™¨ (NEW! v2.1)

**æ–‡ä»¶è·¯å¾„**: `window.py`  
**ä»£ç è¡Œæ•°**: 306è¡Œ  
**èŒè´£**: ä¸“æ³¨äºGUIç•Œé¢çš„åˆ›å»ºã€å¸ƒå±€å’Œæ•°æ®æ˜¾ç¤ºï¼ˆä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼‰

#### æ ¸å¿ƒç±»: WindowManager

```python
class WindowManager:
    """çª—å£ç®¡ç†å™¨ - è´Ÿè´£æ‰€æœ‰GUIç›¸å…³çš„åˆ›å»ºã€å¸ƒå±€å’Œæ˜¾ç¤º"""
    
    def __init__(self, root, callbacks=None):
        """
        åˆå§‹åŒ–çª—å£ç®¡ç†å™¨
        
        å‚æ•°:
            root: Tkinteræ ¹çª—å£å¯¹è±¡
            callbacks: å›è°ƒå‡½æ•°å­—å…¸ï¼Œç”¨äºä¸ä¸šåŠ¡é€»è¾‘äº¤äº’
        """
```

#### ä¸»è¦æ–¹æ³•ç»„

**1. çª—å£åˆå§‹åŒ–**
```python
setup(config_data, process_vars)         # ä¸€é”®åˆå§‹åŒ–å®Œæ•´çª—å£
setup_window()                           # è®¾ç½®ä¸»çª—å£å±æ€§
setup_window_size()                      # å¤šåˆ†è¾¨ç‡è‡ªé€‚åº”
center_window_if_needed()               # çª—å£å±…ä¸­
```

**è‡ªé€‚åº”åˆ†è¾¨ç‡æ”¯æŒ**:
- 1920x1080+ â†’ å…¨å±æ˜¾ç¤º
- 1600x900 â†’ 90%å±å¹•ç©ºé—´
- 1366x768 â†’ 85%å±å¹•ç©ºé—´
- æ›´å°åˆ†è¾¨ç‡ â†’ æœ€å°æ¨èå°ºå¯¸(1200x800)

**2. å¸ƒå±€ç®¡ç†**
```python
create_widgets(config_data)              # åˆ›å»ºæ‰€æœ‰GUIç»„ä»¶
create_path_section(parent, config_data) # è·¯å¾„é€‰æ‹©åŒºåŸŸ
create_info_section(parent)              # æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºåŒº
create_tabs_section(parent)              # 6ä¸ªé€‰é¡¹å¡åŒºåŸŸ
create_button_section(parent)            # æŒ‰é’®åŒºåŸŸ
```

**3. æ•°æ®æ˜¾ç¤ºï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**
```python
display_excel_data(viewer, df, tab_name, show_all=False, original_row_numbers=None)
    # åœ¨viewerä¸­æ˜¾ç¤ºExcelæ•°æ®
    # å‚æ•°:
    #   show_all: True=æ˜¾ç¤ºå…¨éƒ¨æ•°æ®ï¼ŒFalse=ä»…æ˜¾ç¤ºå‰20è¡Œ
    #   original_row_numbers: åŸå§‹Excelè¡Œå·åˆ—è¡¨

show_empty_message(viewer, message)
    # æ˜¾ç¤ºç©ºæ•°æ®æç¤º

calculate_column_widths(df, columns)
    # æ™ºèƒ½åˆ—å®½è®¡ç®—
    # ä¸­æ–‡å­—ç¬¦16pxï¼Œè‹±æ–‡å­—ç¬¦8px
    # é™åˆ¶èŒƒå›´: 60-300px

_create_optimized_display(df, tab_name)
    # åˆ›å»ºä¼˜åŒ–æ˜¾ç¤ºï¼ˆä»…æ˜¾ç¤ºå…³é”®åˆ—ï¼‰
    # æ–‡ä»¶1: A,B,H,K,Måˆ—
    # æ–‡ä»¶2: A,I,M,N,F,ABåˆ—
    # æ–‡ä»¶3: C,L,Q,M,T,I,AF,Nåˆ—
    # æ–‡ä»¶4: A,I,M,O,H,AFåˆ—
```

**4. æ»šåŠ¨æ¡æ”¯æŒï¼ˆæ–°åŠŸèƒ½ï¼‰**
```python
create_excel_viewer(parent, tab_id, tab_name)
    # åˆ›å»ºå¸¦æ»šåŠ¨æ¡çš„Excelé¢„è§ˆæ§ä»¶
    # - å‚ç›´æ»šåŠ¨æ¡: æ”¯æŒå¤§æ•°æ®é‡ä¸Šä¸‹æ»šåŠ¨
    # - æ°´å¹³æ»šåŠ¨æ¡: æ”¯æŒå®½è¡¨æ ¼å·¦å³æ»šåŠ¨
```

**5. æ§åˆ¶æ–¹æ³•**
```python
update_file_info(info_text)             # æ›´æ–°æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
enable_export_button(enabled=True)      # å¯ç”¨/ç¦ç”¨å¯¼å‡ºæŒ‰é’®
get_path_value()                        # è·å–æ–‡ä»¶å¤¹è·¯å¾„
set_path_value(path)                    # è®¾ç½®æ–‡ä»¶å¤¹è·¯å¾„
get_selected_tab_index()                # è·å–å½“å‰é€‰ä¸­çš„é€‰é¡¹å¡ç´¢å¼•
```

#### ä½¿ç”¨ç¤ºä¾‹

**åœ¨base.pyä¸­é›†æˆ**:
```python
from window import WindowManager

class ExcelProcessorApp:
    def __init__(self):
        self.root = tk.Tk()
        
        # é…ç½®å›è°ƒ
        callbacks = {
            'on_browse_folder': self.browse_folder,
            'on_refresh_files': self.refresh_file_list,
            'on_start_processing': self.start_processing,
            'on_export_results': self.export_results,
            'on_open_folder': self.open_folder,
            'on_open_monitor': self.open_monitor,
            'on_settings_menu': self.show_settings_menu,
            'on_tab_changed': self.on_tab_changed,
        }
        
        # åˆ›å»ºçª—å£ç®¡ç†å™¨
        self.window_manager = WindowManager(self.root, callbacks)
        
        # é…ç½®æ•°æ®
        config_data = {
            'folder_path': self.config.get('folder_path', ''),
            'export_folder_path': self.config.get('export_folder_path', ''),
        }
        
        # åˆå§‹åŒ–çª—å£
        self.window_manager.setup(config_data, self.process_vars)
```

**æ˜¾ç¤ºå¤„ç†ç»“æœ**:
```python
# å¤„ç†å®Œæˆåæ˜¾ç¤ºå…¨éƒ¨ç»“æœ
viewer = self.window_manager.viewers['tab1']
self.window_manager.display_excel_data(
    viewer=viewer,
    df=å¤„ç†ç»“æœDataFrame,
    tab_name="å†…éƒ¨éœ€æ‰“å¼€æ¥å£",
    show_all=True,  # æ˜¾ç¤ºå…¨éƒ¨æ•°æ®
    original_row_numbers=excel_row_numbers
)

# å¯ç”¨å¯¼å‡ºæŒ‰é’®
self.window_manager.enable_export_button(True)
```

#### æµ‹è¯•è¦†ç›–

**æµ‹è¯•æ–‡ä»¶**: `tests/test_window.py`  
**æµ‹è¯•ç”¨ä¾‹**: 24ä¸ª  
**è¦†ç›–ç‡**: 57%  
**æµ‹è¯•é€šè¿‡ç‡**: 100%

**æµ‹è¯•ç±»åˆ«**:
- çª—å£åˆå§‹åŒ–æµ‹è¯•ï¼ˆ3ä¸ªï¼‰
- çª—å£å°ºå¯¸è‡ªé€‚åº”æµ‹è¯•ï¼ˆ4ä¸ªï¼‰
- åˆ—å®½è®¡ç®—æµ‹è¯•ï¼ˆ4ä¸ªï¼‰
- æ•°æ®æ˜¾ç¤ºæµ‹è¯•ï¼ˆ5ä¸ªï¼‰
- å›è°ƒè§¦å‘æµ‹è¯•ï¼ˆ3ä¸ªï¼‰
- è·¯å¾„æ–¹æ³•æµ‹è¯•ï¼ˆ2ä¸ªï¼‰
- æŒ‰é’®æ§åˆ¶æµ‹è¯•ï¼ˆ1ä¸ªï¼‰
- ä¿¡æ¯æ›´æ–°æµ‹è¯•ï¼ˆ1ä¸ªï¼‰
- ä¼˜åŒ–æ˜¾ç¤ºæµ‹è¯•ï¼ˆ2ä¸ªï¼‰

---

### 4.1 base.py - åº”ç”¨ç¨‹åºæ§åˆ¶å™¨ï¼ˆé‡æ„åï¼‰ (3335è¡Œ)

#### 4.1.1 ä¸»ç±»ï¼šExcelProcessorApp

```python
class ExcelProcessorApp:
    """ä¸»åº”ç”¨ç¨‹åºç±» - è´Ÿè´£GUIä¸æµç¨‹æ§åˆ¶"""
    
    def __init__(self, auto_mode: bool = False):
        """
        åˆå§‹åŒ–å‚æ•°:
        - auto_mode: è‡ªåŠ¨æ¨¡å¼å¼€å…³ï¼ˆç”¨äºå®šæ—¶ä»»åŠ¡æˆ–å¼€æœºè‡ªå¯ï¼‰
        """
        pass
```

#### 4.1.2 æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³•å | åŠŸèƒ½ | å…³é”®é€»è¾‘ |
|-------|------|---------|
| `setup_window()` | çª—å£åˆå§‹åŒ– | é€‚é…å¤šç§åˆ†è¾¨ç‡ï¼ˆ1366x768~1920x1080+ï¼‰ |
| `load_config()` | åŠ è½½é…ç½® | JSONä¸»é…ç½® + YAMLå®šæ—¶å™¨é…ç½® |
| `create_widgets()` | åˆ›å»ºGUIç»„ä»¶ | 6ä¸ªé€‰é¡¹å¡ + æ–‡ä»¶æµè§ˆ + æŒ‰é’®åŒº |
| `refresh_file_list()` | åˆ·æ–°æ–‡ä»¶åˆ—è¡¨ | æ‰¹é‡è¯†åˆ«6ç§æ–‡ä»¶å¹¶æ˜¾ç¤ºä¿¡æ¯ |
| `start_processing()` | å¼€å§‹å¤„ç† | å¤šçº¿ç¨‹è°ƒç”¨main.pyå¤„ç†é€»è¾‘ |
| `export_results()` | å¯¼å‡ºç»“æœ | è°ƒç”¨main.pyå¯¼å‡ºå‡½æ•° + main2.pyç”Ÿæˆæ±‡æ€» |
| `_run_auto_flow()` | è‡ªåŠ¨æ¨¡å¼æµç¨‹ | åˆ·æ–°â†’å¤„ç†â†’å¯¼å‡ºâ†’å¼¹çª—æ±‡æ€» |
| `_enforce_user_name_gate()` | å§“åé—¨ç¦ | æœªå¡«å†™å§“ååˆ™ç¦ç”¨åŠŸèƒ½æŒ‰é’® |
| `_apply_role_filter()` | è§’è‰²è¿‡æ»¤ | æ ¹æ®è§’è‰²è¡¨è¿‡æ»¤æ˜¾ç¤ºå†…å®¹ |

#### 4.1.3 è§’è‰²æƒé™ç³»ç»Ÿ

```python
è§’è‰²å®šä¹‰ï¼ˆexcel_bin/å§“åè§’è‰²è¡¨.xlsxï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§’è‰²åç§°      â”‚ æƒé™èŒƒå›´                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰€é•¿         â”‚ æŸ¥çœ‹æ‰€æœ‰æ•°æ®                  â”‚
â”‚ ä¸€å®¤ä¸»ä»»     â”‚ æŸ¥çœ‹æœ¬å®¤ï¼ˆ25C1ï¼‰æ•°æ®          â”‚
â”‚ äºŒå®¤ä¸»ä»»     â”‚ æŸ¥çœ‹æœ¬å®¤ï¼ˆ25C2ï¼‰æ•°æ®          â”‚
â”‚ å»ºç­‘æ€»å›¾å®¤ä¸»ä»»â”‚ æŸ¥çœ‹æœ¬å®¤ï¼ˆ25C3ï¼‰æ•°æ®          â”‚
â”‚ è®¾è®¡äººå‘˜     â”‚ æŸ¥çœ‹è´£ä»»äººåŒ¹é…è‡ªå·±å§“åçš„æ•°æ®   â”‚
â”‚ ç®¡ç†å‘˜       â”‚ æŸ¥çœ‹æ‰€æœ‰æ•°æ®ï¼ˆåŒæ‰€é•¿ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.4 é…ç½®ç®¡ç†åŒè½¨åˆ¶

**config.jsonï¼ˆä¸»é…ç½®ï¼‰**:
```json
{
  "folder_path": "D:/Programs/ç­›é€‰ç¨‹åº/ç®€æ˜“æµ‹è¯•æ–‡ä»¶",
  "export_folder_path": "",
  "user_name": "å¼ ä¸‰",
  "auto_startup": false,
  "minimize_to_tray": true,
  "dont_ask_again": false,
  "hide_previous_months": false,
  "role_export_days": {
    "ä¸€å®¤ä¸»ä»»": 7,
    "äºŒå®¤ä¸»ä»»": 7,
    "å»ºç­‘æ€»å›¾å®¤ä¸»ä»»": 7,
    "æ‰€é•¿": 2,
    "ç®¡ç†å‘˜": null,
    "è®¾è®¡äººå‘˜": null
  }
}
```

**config.yamlï¼ˆå®šæ—¶å™¨é…ç½®ï¼‰**:
```yaml
general:
  folder_path: "D:/Programs/..."
  user_name: "å¼ ä¸‰"
  
timer:
  enabled: true
  require_24h: true          # å¯åŠ¨å24å°æ—¶æ‰è§¦å‘
  times: "10:00,16:00"       # å®šæ—¶è§¦å‘æ—¶é—´ç‚¹
  grace_minutes: 10          # å®¹å·®çª—å£ï¼ˆåˆ†é’Ÿï¼‰
```

---

### 4.2 main.py - æ•°æ®å¤„ç†æ ¸å¿ƒ (3435è¡Œ)

#### 4.2.1 æ–‡ä»¶è¯†åˆ«ç³»ç»Ÿ

```python
6ç§æ–‡ä»¶çš„æ­£åˆ™åŒ¹é…è§„åˆ™:

æ–‡ä»¶ç±»å‹1ï¼ˆå†…éƒ¨éœ€æ‰“å¼€æ¥å£ï¼‰:
  æ ¼å¼: (\d{4})æŒ‰é¡¹ç›®å¯¼å‡ºIDIæ‰‹å†Œ\d{4}-\d{2}-\d{2}.*\.(xlsx|xls)
  ç¤ºä¾‹: 2016æŒ‰é¡¹ç›®å¯¼å‡ºIDIæ‰‹å†Œ2025-08-01-17_55_52.xlsx
  é¡¹ç›®å·: å‰4ä½æ•°å­— (2016)

æ–‡ä»¶ç±»å‹2ï¼ˆå†…éƒ¨éœ€å›å¤æ¥å£ï¼‰:
  æ ¼å¼: å†…éƒ¨æ¥å£ä¿¡æ¯å•æŠ¥è¡¨(\d{4})\d{8}\.(xlsx|xls)
  ç¤ºä¾‹: å†…éƒ¨æ¥å£ä¿¡æ¯å•æŠ¥è¡¨201612345678.xlsx
  é¡¹ç›®å·: å‰4ä½æ•°å­— (2016)

æ–‡ä»¶ç±»å‹3ï¼ˆå¤–éƒ¨éœ€æ‰“å¼€æ¥å£ï¼‰:
  æ ¼å¼: å¤–éƒ¨æ¥å£ICMæŠ¥è¡¨(\d{4})\d{8}\.(xlsx|xls)
  ç¤ºä¾‹: å¤–éƒ¨æ¥å£ICMæŠ¥è¡¨201620250801.xlsx
  é¡¹ç›®å·: å‰4ä½æ•°å­— (2016)

æ–‡ä»¶ç±»å‹4ï¼ˆå¤–éƒ¨éœ€å›å¤æ¥å£ï¼‰:
  æ ¼å¼: å¤–éƒ¨æ¥å£å•æŠ¥è¡¨(\d{4})\d{8}\.(xlsx|xls)
  ç¤ºä¾‹: å¤–éƒ¨æ¥å£å•æŠ¥è¡¨201620250801.xlsx
  é¡¹ç›®å·: å‰4ä½æ•°å­— (2016)

æ–‡ä»¶ç±»å‹5ï¼ˆä¸‰ç»´æèµ„æ¥å£ï¼‰:
  æ ¼å¼: ä¸‰ç»´è®¾è®¡æèµ„æ¥å£å•æŠ¥è¡¨(\d{4})\d{8}\.(xlsx|xls)
  ç¤ºä¾‹: ä¸‰ç»´è®¾è®¡æèµ„æ¥å£å•æŠ¥è¡¨201620250801.xlsx
  é¡¹ç›®å·: å‰4ä½æ•°å­— (2016)

æ–‡ä»¶ç±»å‹6ï¼ˆæ”¶å‘æ–‡å‡½ï¼‰:
  æ ¼å¼: æ”¶å‘æ–‡æ¸…å•(\d{4})?.*\.(xlsx|xls)
  ç¤ºä¾‹: æ”¶å‘æ–‡æ¸…å•2016.xlsx
  é¡¹ç›®å·: å¯é€‰çš„4ä½æ•°å­—ï¼ˆæ— åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
```

#### 4.2.2 ç­›é€‰é€»è¾‘çŸ©é˜µ

**å¾…å¤„ç†æ–‡ä»¶1ï¼ˆå†…éƒ¨éœ€æ‰“å¼€æ¥å£ï¼‰** - 4æ­¥ç­›é€‰:
```
Process1: Håˆ—åŒ…å« "25C1"ã€"25C2"ã€"25C3"
Process2: Kåˆ—æ—¥æœŸåœ¨ç­›é€‰èŒƒå›´å†…ï¼ˆè§æ—¥æœŸé€»è¾‘ï¼‰
Process3: Måˆ—ä¸ºç©ºå€¼ ä¸” Aåˆ—ä¸ä¸ºç©º
Process4: Båˆ—åŒ…å«"ä½œåºŸ"ï¼ˆéœ€æ’é™¤ï¼‰

æœ€ç»ˆç»“æœ = (P1 âˆ© P2 âˆ© P3) - P4
```

**å¾…å¤„ç†æ–‡ä»¶2ï¼ˆå†…éƒ¨éœ€å›å¤æ¥å£ï¼‰** - 4æ­¥ç­›é€‰:
```
Process1: Iåˆ—åŒ…å« "25C1"ã€"25C2"ã€"25C3"
Process2: Måˆ—æ—¥æœŸåœ¨ç­›é€‰èŒƒå›´å†…
Process3: 
  ç»„1: Måˆ—ä¸ºç©ºå€¼ ä¸” ABåˆ—ä¸º"æ­£å¸¸" ä¸” Nåˆ—ä¸ºç©º
  ç»„2: Måˆ—éç©º ä¸” ABåˆ—ä¸º"æ­£å¸¸" ä¸” Fåˆ—ä¸ºç©º
  æœ€ç»ˆ = ç»„1 âˆª ç»„2
Process4: ACåˆ—åŒ…å«"ä½œåºŸ"ï¼ˆéœ€æ’é™¤ï¼‰

æœ€ç»ˆç»“æœ = (P1 âˆ© P2 âˆ© P3) - P4
```

**å¾…å¤„ç†æ–‡ä»¶3ï¼ˆå¤–éƒ¨éœ€æ‰“å¼€æ¥å£ï¼‰** - 4æ­¥ç­›é€‰:
```
Process1: Låˆ—åŒ…å« "25C1"ã€"25C2"ã€"25C3"
Process2: Qåˆ—æ—¥æœŸåœ¨ç­›é€‰èŒƒå›´å†…
Process3: Tåˆ—ä¸ºç©ºå€¼ ä¸” Cåˆ—ä¸ä¸ºç©º
Process4: Nåˆ—åŒ…å«"ä½œåºŸ"ï¼ˆéœ€æ’é™¤ï¼‰

æœ€ç»ˆç»“æœ = (P1 âˆ© P2 âˆ© P3) - P4
```

**å¾…å¤„ç†æ–‡ä»¶4ï¼ˆå¤–éƒ¨éœ€å›å¤æ¥å£ï¼‰** - 4æ­¥ç­›é€‰:
```
Process1: Iåˆ—åŒ…å« "25C1"ã€"25C2"ã€"25C3"
Process2: Måˆ—æ—¥æœŸåœ¨ç­›é€‰èŒƒå›´å†…
Process3: 
  ç»„1: Måˆ—ä¸ºç©ºå€¼ ä¸” AFåˆ—ä¸º"æ­£å¸¸" ä¸” Oåˆ—ä¸ºç©º
  ç»„2: Måˆ—éç©º ä¸” AFåˆ—ä¸º"æ­£å¸¸" ä¸” Håˆ—ä¸ºç©º
  æœ€ç»ˆ = ç»„1 âˆª ç»„2
Process4: AGåˆ—åŒ…å«"ä½œåºŸ"ï¼ˆéœ€æ’é™¤ï¼‰

æœ€ç»ˆç»“æœ = (P1 âˆ© P2 âˆ© P3) - P4
```

**å¾…å¤„ç†æ–‡ä»¶5ï¼ˆä¸‰ç»´æèµ„æ¥å£ï¼‰** - 4æ­¥ç­›é€‰:
```
Process1: Kåˆ—åŒ…å« "25C1"ã€"25C2"ã€"25C3"
Process2: Oåˆ—æ—¥æœŸåœ¨ç­›é€‰èŒƒå›´å†…
Process3: Råˆ—ä¸ºç©ºå€¼ ä¸” Cåˆ—ä¸ä¸ºç©º
Process4: Måˆ—åŒ…å«"ä½œåºŸ"ï¼ˆéœ€æ’é™¤ï¼‰

æœ€ç»ˆç»“æœ = (P1 âˆ© P2 âˆ© P3) - P4
```

**å¾…å¤„ç†æ–‡ä»¶6ï¼ˆæ”¶å‘æ–‡å‡½ï¼‰** - 4æ­¥ç­›é€‰:
```
Process1: Våˆ—åŒ…å« "æ²³åŒ—åˆ†å…¬å¸.å»ºç­‘ç»“æ„æ‰€"
Process2: Håˆ—ç­‰äº "æ˜¯"
Process3: Iåˆ—æ—¥æœŸåœ¨æœªæ¥14å¤©å†…ï¼ˆæ—§é€»è¾‘ï¼‰æˆ–å½“å¹´1æœˆ1æ—¥~å½“æœˆ/æ¬¡æœˆæœ«ï¼ˆæ–°é€»è¾‘ï¼‰
Process4: Måˆ—ç­‰äº "å°šæœªå›å¤"

æœ€ç»ˆç»“æœ = P1 âˆ© P2 âˆ© P3 âˆ© P4
```

#### 4.2.3 æ—¥æœŸç­›é€‰åŒé€»è¾‘

```python
# å…¨å±€å¼€å…³
USE_OLD_DATE_LOGIC = False  # False=æ–°é€»è¾‘, True=æ—§é€»è¾‘

# æ—§é€»è¾‘ï¼ˆåŸæœ‰ï¼‰
if current_day <= 19:
    ç­›é€‰èŒƒå›´ = å½“æœˆ (å½“æœˆ1æ—¥ ~ å½“æœˆæœ«)
else:  # 20~31å·
    ç­›é€‰èŒƒå›´ = å½“æœˆ + æ¬¡æœˆ (å½“æœˆ1æ—¥ ~ æ¬¡æœˆæœ«)


#### 4.2.4 ç»“æœå¯¼å‡ºæµç¨‹

```python
def export_result_to_excel1~6():
    """
    å¯¼å‡ºæµç¨‹ï¼ˆä¿æŒåŸå§‹æ ¼å¼ï¼‰:
    1. æ–°å»ºç©ºç™½Excelå·¥ä½œç°¿
    2. é‡å‘½åSheet1ä¸ºå¯¹åº”åç§°
    3. ä»åŸæ–‡ä»¶å¤åˆ¶è¡¨å¤´ï¼ˆç¬¬1è¡Œï¼‰çš„æ ¼å¼+å†…å®¹
    4. ä»åŸæ–‡ä»¶å¤åˆ¶ç­›é€‰ç»“æœè¡Œçš„æ ¼å¼+å†…å®¹
    5. è‡ªåŠ¨è°ƒæ•´åˆ—å®½ï¼ˆåŸºäºå‰4è¡Œæ•°æ®å†…å®¹ï¼‰
    6. ä¿å­˜åˆ° {é¡¹ç›®å·}ç»“æœæ–‡ä»¶/ æ–‡ä»¶å¤¹
    """
```

---

### 4.3 main2.py - ç»“æœæ±‡æ€»ç”Ÿæˆ (236è¡Œ)

#### 4.3.1 æ±‡æ€»æŠ¥å‘Šç»“æ„

```
ç»“æœæ±‡æ€» - 2025-10-21
================================
æ¶‰åŠçš„é¡¹ç›®å·ï¼š2016, 2017, 2018

é¡¹ç›® 2016ï¼šå†…éƒ¨éœ€æ‰“å¼€æ¥å£=5ï¼Œå†…éƒ¨éœ€å›å¤æ¥å£=3ï¼Œ...ï¼Œåˆè®¡=15
é¡¹ç›® 2017ï¼šå†…éƒ¨éœ€æ‰“å¼€æ¥å£=8ï¼Œå†…éƒ¨éœ€å›å¤æ¥å£=2ï¼Œ...ï¼Œåˆè®¡=18
...

æ€»è®¡ï¼š
å†…éƒ¨éœ€æ‰“å¼€æ¥å£åˆè®¡=13
å†…éƒ¨éœ€å›å¤æ¥å£åˆè®¡=5
...

æŒ‰ç§‘å®¤ä¸é¡¹ç›®åˆ†ç±»æ˜ç»†ï¼š

ç§‘å®¤ï¼šç»“æ„ä¸€å®¤
  å†…éƒ¨éœ€æ‰“å¼€æ¥å£
    2016é¡¹ç›®ï¼š
      10.15éœ€æ‰“å¼€3ä¸ªï¼ˆä¸‹ç­å‰å¿…é¡»å®Œæˆï¼‰
      10.20éœ€æ‰“å¼€2ä¸ªï¼ˆæ³¨æ„æ—¶é—´ï¼‰
      ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
  å†…éƒ¨éœ€å›å¤æ¥å£
    2016é¡¹ç›®ï¼š
      10.18éœ€å›å¤2ä¸ªï¼ˆå·²å»¶è¯¯ï¼ï¼ï¼‰
      ...

ç§‘å®¤ï¼šç»“æ„äºŒå®¤
  ...

================================
```

#### 4.3.2 æ—¶é—´æé†’æ ‡ç­¾é€»è¾‘

```python
def _warn_tag(mmdd: str) -> str:
    """æ ¹æ®æˆªæ­¢æ—¥æœŸä¸å½“å‰æ—¥æœŸå·®ç”Ÿæˆæé†’"""
    delta = (due_date - today).days
    
    if delta <= 0:
        return "ï¼ˆå·²å»¶è¯¯ï¼ï¼ï¼‰"
    if delta <= 3:
        return "ï¼ˆä¸‹ç­å‰å¿…é¡»å®Œæˆï¼‰"
    if delta <= 7:
        return "ï¼ˆæ³¨æ„æ—¶é—´ï¼‰"
    return ""
```

---

### 4.4 Monitor.py - å¤„ç†ç›‘æ§å™¨ (422è¡Œ)

#### 4.4.1 ç›‘æ§å™¨ç±»å›¾

```python
class ProcessMonitor:
    """å®æ—¶å¤„ç†è¿‡ç¨‹ç›‘æ§"""
    
    å±æ€§:
    - message_queue: queue.Queue  # æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
    - messages: list              # å†å²æ¶ˆæ¯åˆ—è¡¨
    - compact_mode: bool          # ç´§å‡‘æ¨¡å¼ï¼ˆè¿‡æ»¤è°ƒè¯•ä¿¡æ¯ï¼‰
    
    æ–¹æ³•:
    - create_window()             # åˆ›å»ºç›‘æ§çª—å£
    - add_message()               # æ·»åŠ æ¶ˆæ¯åˆ°é˜Ÿåˆ—
    - display_message()           # æ˜¾ç¤ºæ¶ˆæ¯ï¼ˆå¸¦é¢œè‰²ï¼‰
    - _should_suppress()          # ç´§å‡‘æ¨¡å¼è¿‡æ»¤è§„åˆ™
    - save_messages()             # ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
    - clear_messages()            # æ¸…ç©ºæ¶ˆæ¯
```

#### 4.4.2 æ¶ˆæ¯ç±»å‹ä¸é¢œè‰²

| æ¶ˆæ¯ç±»å‹ | é¢œè‰² | ç”¨é€” |
|---------|------|------|
| INFO | é»‘è‰² | å¸¸è§„ä¿¡æ¯ |
| SUCCESS | ç»¿è‰² | æˆåŠŸå®Œæˆ |
| WARNING | æ©™è‰² | è­¦å‘Šæç¤º |
| ERROR | çº¢è‰² | é”™è¯¯ä¿¡æ¯ |
| PROCESS | è“è‰² | å¤„ç†è¿‡ç¨‹ |
| SYSTEM | ç´«è‰² | ç³»ç»Ÿæ¶ˆæ¯ |

#### 4.4.3 ç´§å‡‘æ¨¡å¼è¿‡æ»¤è§„åˆ™

```python
# æ˜¾ç¤ºçš„å…³é”®è¯ï¼ˆæ–‡ä»¶çº§åˆ«ï¼‰
whitelist_keywords = [
    "å¼€å§‹æ‰¹é‡è¯†åˆ«å¾…å¤„ç†æ–‡ä»¶",
    "æ‰¾åˆ°å¾…å¤„ç†æ–‡ä»¶",
    "æ‰¹é‡è¯†åˆ«å®Œæˆ",
    "é¡¹ç›®",
    "æœ€ç»ˆå®Œæˆå¤„ç†æ•°æ®",
    "å¯¼å‡ºå®Œæˆ",
]

# éšè—çš„å…³é”®è¯ï¼ˆæ­¥éª¤/è°ƒè¯•çº§åˆ«ï¼‰
suppress_keywords = [
    "å¼€å§‹æ‰§è¡Œå¤„ç†1", "å¤„ç†1å®Œæˆ",
    "ç­›é€‰æ—¥æœŸèŒƒå›´", "è¯»å–åˆ°æ•°æ®",
    "æ ·å¼å¤åˆ¶å¤±è´¥",
]
```

---

## 5. æ•°æ®å¤„ç†æµç¨‹

### 5.1 å®Œæ•´å¤„ç†æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡»    â”‚
â”‚"åˆ·æ–°æ–‡ä»¶åˆ—è¡¨"â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰«ææŒ‡å®šæ–‡ä»¶å¤¹æ‰€æœ‰Excelæ–‡ä»¶  â”‚
â”‚ (*.xlsx, *.xls)             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡è¯†åˆ«6ç§æ–‡ä»¶ç±»å‹          â”‚
â”‚ - find_all_target_files1~6()â”‚
â”‚ - åŸºäºæ–‡ä»¶åæ­£åˆ™åŒ¹é…         â”‚
â”‚ - æå–é¡¹ç›®å·                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯æ‘˜è¦             â”‚
â”‚ - å„ç±»æ–‡ä»¶æ•°é‡              â”‚
â”‚ - é¡¹ç›®å·åˆ—è¡¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡»    â”‚
â”‚ "å¼€å§‹å¤„ç†"  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯åŠ¨åå°å¤„ç†çº¿ç¨‹             â”‚
â”‚ - threading.Thread          â”‚
â”‚ - é¿å…ç•Œé¢å†»ç»“              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯¹æ¯ç§æ–‡ä»¶ç±»å‹æ‰§è¡Œæ‰¹é‡å¤„ç†   â”‚
â”‚ FOR each project_id:        â”‚
â”‚   1. è¯»å–Excelæºæ–‡ä»¶        â”‚
â”‚   2. æ‰§è¡Œ4æ­¥ç­›é€‰é€»è¾‘        â”‚
â”‚   3. ç”Ÿæˆå¤„ç†ç»“æœDataFrame  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨è§’è‰²æƒé™è¿‡æ»¤             â”‚
â”‚ - åŸºäºuser_nameæŸ¥å§“åè§’è‰²è¡¨ â”‚
â”‚ - æ ¹æ®è§’è‰²è¿‡æ»¤æ˜¾ç¤ºå†…å®¹       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ›´æ–°GUIæ˜¾ç¤º                 â”‚
â”‚ - åˆ·æ–°6ä¸ªé€‰é¡¹å¡çš„Treeview   â”‚
â”‚ - å¯ç”¨"å¯¼å‡ºç»“æœ"æŒ‰é’®        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡»    â”‚
â”‚ "å¯¼å‡ºç»“æœ"  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡å¯¼å‡ºExcelç»“æœæ–‡ä»¶        â”‚
â”‚ FOR each (file_type, pid):  â”‚
â”‚   1. åˆ›å»º{pid}ç»“æœæ–‡ä»¶/æ–‡ä»¶å¤¹â”‚
â”‚   2. è°ƒç”¨export_result_xxx()â”‚
â”‚   3. å¤åˆ¶æ ¼å¼å¹¶å†™å…¥ç­›é€‰ç»“æœ  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆæ±‡æ€»TXTæŠ¥å‘Š              â”‚
â”‚ - write_export_summary()    â”‚
â”‚ - æŒ‰ç§‘å®¤/é¡¹ç›®/æ—¶é—´åˆ†ç±»ç»Ÿè®¡   â”‚
â”‚ - æ·»åŠ æ—¶é—´æé†’æ ‡ç­¾           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¼¹çª—æ˜¾ç¤ºæ±‡æ€»ç»“æœ             â”‚
â”‚ - è‡ªåŠ¨æ¨¡å¼å”¯ä¸€å¼¹çª—           â”‚
â”‚ - æ˜¾ç¤ºæ‰€æœ‰é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å•æ–‡ä»¶å¤„ç†è¯¦ç»†æµç¨‹ï¼ˆä»¥æ–‡ä»¶1ä¸ºä¾‹ï¼‰

```
process_target_file1(file_path, current_datetime)
    â†“
[1] è¯»å–Excelç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
    df = pd.read_excel(file_path, sheet_name=0)
    â†“
[2] æ‰§è¡ŒProcess1: Håˆ—ç­›é€‰ï¼ˆ25C1/25C2/25C3ï¼‰
    result1 = execute_process1(df)
    â†“
[3] æ‰§è¡ŒProcess2: Kåˆ—æ—¥æœŸç­›é€‰
    result2 = execute_process2(df, current_datetime)
    â†“
[4] æ‰§è¡ŒProcess3: Måˆ—ç©ºå€¼ä¸”Aåˆ—éç©º
    result3 = execute_process3(df)
    â†“
[5] æ‰§è¡ŒProcess4: Båˆ—ä½œåºŸæ ‡è®°
    result4 = execute_process4(df)
    â†“
[6] è®¡ç®—æœ€ç»ˆç»“æœé›†åˆ
    final_rows = (result1 âˆ© result2 âˆ© result3) - result4
    â†“
[7] æå–DataFrameè¡Œæ•°æ®
    result_df = df.iloc[final_indices].copy()
    â†“
[8] æ·»åŠ è¾…åŠ©åˆ—
    - åŸå§‹è¡Œå·ï¼ˆç”¨äºå¯¼å‡ºæ—¶å®šä½ï¼‰
    - ç§‘å®¤ï¼ˆåŸºäºHåˆ—å€¼æ˜ å°„ï¼‰
    - æ¥å£æ—¶é—´ï¼ˆKåˆ—æ ¼å¼åŒ–ä¸ºmm.ddï¼‰
    - è´£ä»»äººï¼ˆRåˆ—æå–ä¸­æ–‡ï¼‰
    â†“
[9] è¿”å›å¤„ç†ç»“æœDataFrame
```

---

## 6. é…ç½®ç³»ç»Ÿ

### 6.1 é…ç½®æ–‡ä»¶ä½ç½®

```
ç”¨æˆ·ä¸»ç›®å½•:
  ~/.excel_processor/
      â”œâ”€â”€ config.json         # ä¸»é…ç½®æ–‡ä»¶
      â””â”€â”€ config.yaml         # YAMLæ‰©å±•é…ç½®ï¼ˆå®šæ—¶å™¨ï¼‰
```

### 6.2 é…ç½®é¡¹è¯¦è§£

#### config.json

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|------|--------|
| `folder_path` | string | æºæ–‡ä»¶å¤¹è·¯å¾„ | "D:/Programs/..." |
| `export_folder_path` | string | å¯¼å‡ºç»“æœä½ç½®ï¼ˆå¯é€‰ï¼‰ | "" |
| `user_name` | string | å½“å‰ç”¨æˆ·å§“åï¼ˆç”¨äºè§’è‰²è¯†åˆ«ï¼‰ | "å¼ ä¸‰" |
| `auto_startup` | boolean | æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨ | false |
| `minimize_to_tray` | boolean | å…³é—­æ—¶æœ€å°åŒ–åˆ°æ‰˜ç›˜ | true |
| `dont_ask_again` | boolean | å…³é—­æ—¶ä¸å†è¯¢é—® | false |
| `hide_previous_months` | boolean | éšè—å¾€æœˆæ•°æ® | false |
| `role_export_days` | object | è§’è‰²å¯¼å‡ºå¤©æ•°é—¨æ§› | è§ä¸‹æ–‡ |

**role_export_daysè¯¦è§£**:
```json
{
  "ä¸€å®¤ä¸»ä»»": 7,      // æˆªæ­¢æ—¥æœŸ<=7å¤©å†…æ‰å¯¼å‡º
  "äºŒå®¤ä¸»ä»»": 7,
  "å»ºç­‘æ€»å›¾å®¤ä¸»ä»»": 7,
  "æ‰€é•¿": 2,          // ä»…å¯¼å‡º2å¤©å†…æˆªæ­¢çš„
  "ç®¡ç†å‘˜": null,     // nullè¡¨ç¤ºå¯¼å‡ºå…¨éƒ¨
  "è®¾è®¡äººå‘˜": null
}
```

#### config.yaml

```yaml
general:
  folder_path: "..."
  export_folder_path: "..."
  user_name: "..."
  auto_startup: false
  minimize_to_tray: true
  dont_ask_again: false
  hide_previous_months: false

timer:
  enabled: true                # æ˜¯å¦å¯ç”¨å®šæ—¶å™¨
  require_24h: true            # å¯åŠ¨å24å°æ—¶æ‰å¼€å§‹å®šæ—¶ä»»åŠ¡
  times: "10:00,16:00"         # å®šæ—¶è§¦å‘æ—¶é—´ç‚¹ï¼ˆé€—å·åˆ†éš”ï¼‰
  grace_minutes: 10            # å®¹å·®çª—å£ï¼ˆÂ±10åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
```

### 6.3 è§’è‰²æƒé™è¡¨æ ¼å¼

**excel_bin/å§“åè§’è‰²è¡¨.xlsx**:

| å§“å | è§’è‰² |
|-----|------|
| å¼ ä¸‰ | ä¸€å®¤ä¸»ä»» |
| æå›› | è®¾è®¡äººå‘˜ |
| ç‹äº” | æ‰€é•¿ |
| ... | ... |

---

## 7. éƒ¨ç½²ä¸æ‰“åŒ…

### 7.1 å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. è¿è¡Œç¨‹åº
python base.py

# 5. è‡ªåŠ¨æ¨¡å¼è¿è¡Œï¼ˆå¼€æœºè‡ªå¯åçš„æ¨¡å¼ï¼‰
python base.py --auto
```

### 7.2 PyInstalleræ‰“åŒ…é…ç½®

**excel_processor.spec** é…ç½®è§£æ:

```python
# -*- mode: python ; coding: utf-8 -*-

a = Analysis(
    ['base.py'],                    # ä¸»å…¥å£æ–‡ä»¶
    pathex=['.'],                   # æœç´¢è·¯å¾„
    binaries=[],                    # äºŒè¿›åˆ¶ä¾èµ–
    datas=[
        # å¿…é¡»æ‰“åŒ…çš„æ•°æ®æ–‡ä»¶
        ('main.py', '.'),           # å¤„ç†æ ¸å¿ƒæ¨¡å—
        ('main2.py', '.'),          # æ±‡æ€»ç”Ÿæˆæ¨¡å—
        ('Monitor.py', '.'),        # ç›‘æ§å™¨æ¨¡å—
        ('config.json', '.'),       # é…ç½®æ–‡ä»¶
        ('ico_bin/tubiao.ico', 'ico_bin'),        # å›¾æ ‡
        ('excel_bin/å§“åè§’è‰²è¡¨.xlsx', 'excel_bin'), # æƒé™è¡¨
    ],
    hiddenimports=[
        # åŠ¨æ€å¯¼å…¥çš„æ¨¡å—éœ€æ˜¾å¼å£°æ˜
        'main', 'main2', 'Monitor',
        'pandas', 'openpyxl', 'xlrd', 'numpy',
        'pystray', 'PIL', 'tkinter',
    ],
    # ...çœç•¥å…¶ä»–é…ç½®
)

exe = EXE(
    # ...
    name='æ¥å£ç­›é€‰',              # å¯æ‰§è¡Œæ–‡ä»¶å
    console=False,              # ä¸æ˜¾ç¤ºæ§åˆ¶å°çª—å£
    icon='ico_bin/tubiao.ico'   # ç¨‹åºå›¾æ ‡
)

coll = COLLECT(
    # ...
    name='æ¥å£ç­›é€‰'               # è¾“å‡ºæ–‡ä»¶å¤¹å
)
```

### 7.3 æ‰“åŒ…æµç¨‹

```bash
# 1. æ¸…ç†æ—§æ„å»ºæ–‡ä»¶
Remove-Item -Recurse -Force .\dist, .\build -ErrorAction SilentlyContinue

# 2. æ‰§è¡Œæ‰“åŒ…
pyinstaller -y excel_processor.spec

# 3. æ‰“åŒ…è¾“å‡ºä½ç½®
# dist/æ¥å£ç­›é€‰/
#     â”œâ”€â”€ æ¥å£ç­›é€‰.exe           # ä¸»ç¨‹åº
#     â”œâ”€â”€ main.py               # å¤„ç†æ¨¡å—
#     â”œâ”€â”€ main2.py              # æ±‡æ€»æ¨¡å—
#     â”œâ”€â”€ Monitor.py            # ç›‘æ§å™¨
#     â”œâ”€â”€ config.json           # é…ç½®
#     â”œâ”€â”€ ico_bin/tubiao.ico    # å›¾æ ‡
#     â”œâ”€â”€ excel_bin/å§“åè§’è‰²è¡¨.xlsx # æƒé™è¡¨
#     â”œâ”€â”€ _internal/            # ä¾èµ–åº“å’ŒDLL
#     â””â”€â”€ ...
```

### 7.4 éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤æ‰€æœ‰ä¾èµ–åŒ…å·²æ­£ç¡®æ‰“åŒ…
- [ ] æµ‹è¯•Excelæ–‡ä»¶è¯»å†™åŠŸèƒ½
- [ ] éªŒè¯ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡æ˜¾ç¤º
- [ ] æ£€æŸ¥å¼€æœºè‡ªå¯åŠ¨æ³¨å†Œè¡¨é¡¹
- [ ] æµ‹è¯•è§’è‰²æƒé™è¿‡æ»¤é€»è¾‘
- [ ] éªŒè¯å®šæ—¶å™¨åŠŸèƒ½ï¼ˆéœ€ç­‰å¾…24å°æ—¶+è§¦å‘æ—¶é—´ç‚¹ï¼‰
- [ ] æµ‹è¯•å¤šé¡¹ç›®æ‰¹é‡å¤„ç†
- [ ] éªŒè¯ç»“æœå¯¼å‡ºæ ¼å¼ä¿æŒ

---

## 8. å…³é”®ç®—æ³•

### 8.1 æ—¥æœŸç­›é€‰ç®—æ³•

```python
def calculate_date_range(current_datetime, use_old_logic=False):
    """
    è®¡ç®—æ—¥æœŸç­›é€‰èŒƒå›´
    
    æ—§é€»è¾‘:
        1~19å·: å½“æœˆ1æ—¥~å½“æœˆæœ«
        20~31å·: å½“æœˆ1æ—¥~æ¬¡æœˆæœ«
    
    """
    current_day = current_datetime.day
    current_year = current_datetime.year
    current_month = current_datetime.month
    
    if use_old_logic:
        start_date = datetime(current_year, current_month, 1)
    else:
        start_date = datetime(current_year, 1, 1)
    
    if current_day <= 19:
        # å½“æœˆæœ«
        if current_month == 12:
            end_date = datetime(current_year, 12, 31)
        else:
            end_date = datetime(current_year, current_month + 1, 1) - timedelta(days=1)
    else:
        # æ¬¡æœˆæœ«
        if current_month == 12:
            end_date = datetime(current_year + 1, 2, 1) - timedelta(days=1)
        elif current_month == 11:
            end_date = datetime(current_year + 1, 1, 1) - timedelta(days=1)
        else:
            end_date = datetime(current_year, current_month + 2, 1) - timedelta(days=1)
    
    return start_date, end_date
```

### 8.2 è§’è‰²è¿‡æ»¤ç®—æ³•

```python
def apply_role_filter(df, user_name, role_name):
    """
    æ ¹æ®ç”¨æˆ·è§’è‰²è¿‡æ»¤DataFrame
    
    è§„åˆ™:
    - æ‰€é•¿/ç®¡ç†å‘˜: çœ‹å…¨éƒ¨
    - å®¤ä¸»ä»»: ä»…çœ‹æœ¬å®¤ï¼ˆç§‘å®¤åˆ—åŒ¹é…ï¼‰
    - è®¾è®¡äººå‘˜: ä»…çœ‹è´£ä»»äººåŒ…å«è‡ªå·±å§“åçš„
    """
    if role_name in ["æ‰€é•¿", "ç®¡ç†å‘˜"]:
        return df  # è¿”å›å…¨éƒ¨
    
    if role_name in ["ä¸€å®¤ä¸»ä»»", "äºŒå®¤ä¸»ä»»", "å»ºç­‘æ€»å›¾å®¤ä¸»ä»»"]:
        # ç§‘å®¤æ˜ å°„
        dept_map = {
            "ä¸€å®¤ä¸»ä»»": "ç»“æ„ä¸€å®¤",
            "äºŒå®¤ä¸»ä»»": "ç»“æ„äºŒå®¤",
            "å»ºç­‘æ€»å›¾å®¤ä¸»ä»»": "å»ºç­‘æ€»å›¾å®¤"
        }
        target_dept = dept_map.get(role_name, "")
        if "ç§‘å®¤" in df.columns:
            return df[df["ç§‘å®¤"] == target_dept]
    
    if role_name == "è®¾è®¡äººå‘˜":
        if "è´£ä»»äºº" in df.columns:
            # è´£ä»»äººåˆ—å¯èƒ½åŒ…å«å¤šä¸ªå§“åï¼ˆé€—å·åˆ†éš”ï¼‰
            return df[df["è´£ä»»äºº"].str.contains(user_name, na=False)]
    
    return pd.DataFrame()  # æ— æƒé™è¿”å›ç©º
```

### 8.3 Excelæ ¼å¼ä¿æŒç®—æ³•

```python
def copy_cell_with_format(source_cell, target_cell):
    """
    å¤åˆ¶Excelå•å…ƒæ ¼çš„å€¼å’Œæ ¼å¼
    
    å¤åˆ¶å†…å®¹:
    - å€¼ (value)
    - å­—ä½“ (font)
    - å¡«å…… (fill)
    - è¾¹æ¡† (border)
    - å¯¹é½ (alignment)
    - æ•°å­—æ ¼å¼ (number_format)
    """
    from copy import copy
    
    # å¤åˆ¶å€¼
    target_cell.value = source_cell.value
    
    # å¤åˆ¶æ ¼å¼
    try:
        if source_cell.font:
            target_cell.font = copy(source_cell.font)
        if source_cell.fill:
            target_cell.fill = copy(source_cell.fill)
        if source_cell.border:
            target_cell.border = copy(source_cell.border)
        if source_cell.alignment:
            target_cell.alignment = copy(source_cell.alignment)
        if source_cell.number_format:
            target_cell.number_format = source_cell.number_format
    except Exception as e:
        # æ ¼å¼å¤åˆ¶å¤±è´¥æ—¶ä»…å¤åˆ¶å€¼ï¼Œä¸å½±å“ä¸»æµç¨‹
        print(f"æ ·å¼å¤åˆ¶å¤±è´¥: {e}")
```

### 8.4 åˆ—å®½è‡ªåŠ¨è°ƒæ•´ç®—æ³•

```python
def calculate_column_widths(df, columns):
    """
    åŸºäºå‰4è¡Œæ•°æ®è®¡ç®—æœ€ä½³åˆ—å®½
    
    ç®—æ³•:
    1. é€‰æ‹©ç¬¬2è¡Œæ•°æ®ï¼ˆæ•°æ®è¡Œï¼Œéè¡¨å¤´ï¼‰
    2. éå†æ¯åˆ—ï¼Œè®¡ç®—å­—ç¬¦æ˜¾ç¤ºå®½åº¦
    3. ä¸­æ–‡å­—ç¬¦æŒ‰16pxï¼Œè‹±æ–‡å­—ç¬¦æŒ‰8pxä¼°ç®—
    4. ä¹˜ä»¥1.2å€å¯Œä½™ç³»æ•°
    5. é™åˆ¶æœ€å°60pxï¼Œæœ€å¤§300px
    """
    column_widths = []
    
    if len(df) >= 2:
        calc_row = df.iloc[1]  # ä½¿ç”¨ç¬¬2è¡Œ
    elif len(df) >= 1:
        calc_row = df.iloc[0]  # ä»…æœ‰è¡¨å¤´æ—¶ç”¨è¡¨å¤´
    else:
        return [80] * len(columns)  # æ— æ•°æ®æ—¶è¿”å›é»˜è®¤
    
    for i, col in enumerate(columns):
        content_str = str(calc_row.iloc[i] if i < len(calc_row) else col)
        
        # ä¼°ç®—å®½åº¦
        estimated_width = 0
        for char in content_str:
            if ord(char) > 127:  # ä¸­æ–‡
                estimated_width += 16
            else:  # è‹±æ–‡
                estimated_width += 8
        
        # åº”ç”¨ç³»æ•°å¹¶é™åˆ¶èŒƒå›´
        col_width = int(estimated_width * 1.2)
        col_width = max(60, min(col_width, 300))
        column_widths.append(col_width)
    
    return column_widths
```

---

## 9. æ–‡ä»¶ç»“æ„

### 9.1 é¡¹ç›®ç›®å½•æ ‘

```
PythonProject3/
â”œâ”€â”€ base.py                    # GUIä¸»ç¨‹åºï¼ˆ3335è¡Œï¼‰
â”œâ”€â”€ main.py                    # æ•°æ®å¤„ç†æ ¸å¿ƒï¼ˆ3435è¡Œï¼‰
â”œâ”€â”€ main2.py                   # ç»“æœæ±‡æ€»ç”Ÿæˆï¼ˆ236è¡Œï¼‰
â”œâ”€â”€ Monitor.py                 # å¤„ç†ç›‘æ§å™¨ï¼ˆ422è¡Œï¼‰
â”œâ”€â”€ config.json                # é»˜è®¤é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–æ¸…å•
â”œâ”€â”€ excel_processor.spec       # PyInstalleræ‰“åŒ…é…ç½®
â”‚
â”œâ”€â”€ ico_bin/                   # å›¾æ ‡èµ„æº
â”‚   â””â”€â”€ tubiao.ico
â”‚
â”œâ”€â”€ excel_bin/                 # Excelèµ„æº
â”‚   â”œâ”€â”€ å§“åè§’è‰²è¡¨.xlsx         # è§’è‰²æƒé™é…ç½®è¡¨
â”‚   â””â”€â”€ å„å®¤äººå‘˜åå•.xlsx       # äººå‘˜åå•ï¼ˆå¤‡ç”¨ï¼‰
â”‚
â”œâ”€â”€ build/                     # æ‰“åŒ…ä¸­é—´æ–‡ä»¶ï¼ˆå¯åˆ é™¤ï¼‰
â”‚   â””â”€â”€ excel_processor/
â”‚
â””â”€â”€ dist/                      # æ‰“åŒ…è¾“å‡ºç›®å½•
    â””â”€â”€ æ¥å£ç­›é€‰/
        â”œâ”€â”€ æ¥å£ç­›é€‰.exe       # ä¸»ç¨‹åº
        â”œâ”€â”€ main.py
        â”œâ”€â”€ main2.py
        â”œâ”€â”€ Monitor.py
        â”œâ”€â”€ config.json
        â”œâ”€â”€ ico_bin/
        â”œâ”€â”€ excel_bin/
        â””â”€â”€ _internal/         # ä¾èµ–åº“
```

### 9.2 è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆ

```
ç”¨æˆ·ä¸»ç›®å½• (~/.excel_processor/):
â”œâ”€â”€ config.json                # ç”¨æˆ·é…ç½®
â””â”€â”€ config.yaml                # å®šæ—¶å™¨é…ç½®

å¯¼å‡ºç»“æœç›®å½• (ç”¨æˆ·æŒ‡å®š):
â”œâ”€â”€ 2016ç»“æœæ–‡ä»¶/              # é¡¹ç›®2016çš„ç»“æœ
â”‚   â”œâ”€â”€ å†…éƒ¨éœ€æ‰“å¼€æ¥å£2025-10-21.xlsx
â”‚   â”œâ”€â”€ å†…éƒ¨éœ€å›å¤æ¥å£2025-10-21.xlsx
â”‚   â”œâ”€â”€ å¤–éƒ¨éœ€æ‰“å¼€æ¥å£2025-10-21.xlsx
â”‚   â”œâ”€â”€ å¤–éƒ¨éœ€å›å¤æ¥å£2025-10-21.xlsx
â”‚   â”œâ”€â”€ ä¸‰ç»´æèµ„æ¥å£2025-10-21.xlsx
â”‚   â””â”€â”€ æ”¶å‘æ–‡å‡½2025-10-21.xlsx
â”‚
â”œâ”€â”€ 2017ç»“æœæ–‡ä»¶/              # é¡¹ç›®2017çš„ç»“æœ
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ ç»“æœæ±‡æ€»2025-10-21.txt     # æ‰€æœ‰é¡¹ç›®æ±‡æ€»æŠ¥å‘Š
```

---

## 10. æ‰©å±•ä¸ç»´æŠ¤

### 10.1 æ–°å¢æ–‡ä»¶ç±»å‹å¤„ç†

**æ­¥éª¤ç¤ºä¾‹ï¼šæ·»åŠ "æ–‡ä»¶ç±»å‹7"**

1. **åœ¨main.pyä¸­æ·»åŠ è¯†åˆ«å‡½æ•°**:
```python
def find_all_target_files7(excel_files):
    """æŸ¥æ‰¾æ–‡ä»¶ç±»å‹7"""
    pattern = r'^æ–°æ–‡ä»¶æ ¼å¼(\d{4})\d{8}\.(xlsx|xls)$'
    matched_files = []
    for file_path in excel_files:
        file_name = os.path.basename(file_path)
        m = re.match(pattern, file_name)
        if m:
            project_id = m.group(1)
            matched_files.append((file_path, project_id))
    return matched_files
```

2. **æ·»åŠ å¤„ç†å‡½æ•°**:
```python
def process_target_file7(file_path, current_datetime):
    """å¤„ç†æ–‡ä»¶ç±»å‹7"""
    # è¯»å–Excel
    df = pd.read_excel(file_path, sheet_name=0)
    
    # æ‰§è¡Œç­›é€‰é€»è¾‘
    result_rows = ...
    
    # ç”Ÿæˆç»“æœDataFrame
    result_df = df.iloc[result_rows].copy()
    result_df['åŸå§‹è¡Œå·'] = ...
    
    return result_df
```

3. **æ·»åŠ å¯¼å‡ºå‡½æ•°**:
```python
def export_result_to_excel7(df, original_file_path, current_datetime, output_dir, project_id):
    """å¯¼å‡ºæ–‡ä»¶ç±»å‹7ç»“æœ"""
    # å‚è€ƒexport_result_to_excel1çš„å®ç°
    pass
```

4. **åœ¨base.pyä¸­æ·»åŠ UIç»„ä»¶**:
```python
# create_tabs()ä¸­æ·»åŠ :
self.tab7_frame = ttk.Frame(self.notebook)
self.notebook.add(self.tab7_frame, text="æ–°æ–‡ä»¶ç±»å‹7")
```

5. **åœ¨base.pyä¸­é›†æˆå¤„ç†æµç¨‹**:
```python
# refresh_file_list()ä¸­æ·»åŠ :
self.target_files7 = main.find_all_target_files7(self.excel_files)

# start_processing()ä¸­æ·»åŠ :
self.processing_results_multi7 = {}
for file_path, project_id in self.target_files7:
    result = main.process_target_file7(file_path, self.current_datetime)
    self.processing_results_multi7[project_id] = result

# export_results()ä¸­æ·»åŠ :
for project_id, df in self.processing_results_multi7.items():
    main.export_result_to_excel7(df, ...)
```

### 10.2 ä¿®æ”¹ç­›é€‰é€»è¾‘

**ç¤ºä¾‹ï¼šä¿®æ”¹æ–‡ä»¶1çš„æ—¥æœŸç­›é€‰èŒƒå›´**

1. å®šä½åˆ° `main.py` çš„ `execute_process2()` å‡½æ•°
2. ä¿®æ”¹æ—¥æœŸèŒƒå›´è®¡ç®—é€»è¾‘
3. æµ‹è¯•éªŒè¯æ–°é€»è¾‘
4. æ›´æ–°æ–‡æ¡£è¯´æ˜

### 10.3 è°ƒæ•´è§’è‰²æƒé™è§„åˆ™

1. ä¿®æ”¹ `excel_bin/å§“åè§’è‰²è¡¨.xlsx`
2. åœ¨ `base.py` çš„ `_apply_role_filter()` ä¸­è°ƒæ•´è¿‡æ»¤è§„åˆ™
3. åœ¨ `config.json` çš„ `role_export_days` ä¸­é…ç½®æ–°è§’è‰²

### 10.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®

**å½“å‰æ€§èƒ½ç“¶é¢ˆ**:
- å¤§æ–‡ä»¶è¯»å–ï¼ˆpandas.read_excelï¼‰
- è¡Œé€ä¸€éå†ç­›é€‰
- Excelæ ¼å¼å¤åˆ¶ï¼ˆopenpyxlï¼‰

**ä¼˜åŒ–æ–¹å‘**:
1. **æ‰¹é‡è¯»å–ä¼˜åŒ–**: ä½¿ç”¨ `chunksize` åˆ†æ‰¹è¯»å–å¤§æ–‡ä»¶
2. **çŸ¢é‡åŒ–ç­›é€‰**: ç”¨pandaså‘é‡è¿ç®—æ›¿ä»£é€è¡Œéå†
3. **å¹¶è¡Œå¤„ç†**: å¤šé¡¹ç›®ç”¨ `concurrent.futures` å¹¶è¡Œå¤„ç†
4. **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜å·²è¯»å–çš„DataFrameï¼Œé¿å…é‡å¤è¯»å–

**ä¼˜åŒ–ç¤ºä¾‹**:
```python
# åŸå§‹é€è¡Œéå†
for idx, cell_value in df['Håˆ—'].items():
    if "25C1" in str(cell_value):
        result_rows.add(idx)

# ä¼˜åŒ–ä¸ºçŸ¢é‡åŒ–
result_rows = set(df[df['Håˆ—'].astype(str).str.contains('25C1', na=False)].index)
```

### 10.5 å¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜1: æ–‡ä»¶è¯†åˆ«å¤±è´¥**
- æ£€æŸ¥æ–‡ä»¶åæ ¼å¼æ˜¯å¦ç¬¦åˆæ­£åˆ™è§„åˆ™
- æŸ¥çœ‹ç›‘æ§å™¨ä¸­çš„"æœªæ‰¾åˆ°ä»»ä½•ç¬¦åˆæ ¼å¼çš„æ–‡ä»¶X"è­¦å‘Š

**é—®é¢˜2: å¯¼å‡ºç»“æœä¸ºç©º**
- ç¡®è®¤æ—¥æœŸç­›é€‰é€»è¾‘æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥4æ­¥ç­›é€‰çš„ä¸­é—´ç»“æœæ•°é‡
- éªŒè¯è§’è‰²æƒé™è¿‡æ»¤æ˜¯å¦è¿‡äºä¸¥æ ¼

**é—®é¢˜3: æ ¼å¼ä¸¢å¤±**
- ç¡®è®¤åŸæ–‡ä»¶ä¸ºxlsxæ ¼å¼ï¼ˆxlsæ ¼å¼ä¸æ”¯æŒæ ¼å¼ä¿æŒï¼‰
- æ£€æŸ¥openpyxlç‰ˆæœ¬æ˜¯å¦å…¼å®¹

**é—®é¢˜4: å®šæ—¶å™¨ä¸è§¦å‘**
- ç¡®è®¤ `config.yaml` ä¸­ `enabled: true`
- æ£€æŸ¥ `require_24h` æ˜¯å¦éœ€è¦ç­‰å¾…24å°æ—¶
- éªŒè¯ç³»ç»Ÿæ—¶é—´æ˜¯å¦åœ¨è§¦å‘çª—å£å†…ï¼ˆÂ±grace_minutesï¼‰

### 10.6 æ—¥å¿—è°ƒè¯•æŠ€å·§

**å¯ç”¨è¯¦ç»†æ—¥å¿—**:
1. æ‰“å¼€ç›‘æ§å™¨çª—å£
2. å…³é—­ç´§å‡‘æ¨¡å¼ï¼ˆä¿®æ”¹ `Monitor.py` ä¸­ `compact_mode = False`ï¼‰
3. æŸ¥çœ‹æ‰€æœ‰æ­¥éª¤çº§æ—¥å¿—

**ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶**:
1. åœ¨ç›‘æ§å™¨çª—å£ç‚¹å‡»"ä¿å­˜æ—¥å¿—"æŒ‰é’®
2. æˆ–ç›´æ¥è¯»å–ç›‘æ§å™¨çš„ `messages` åˆ—è¡¨

---

## é™„å½•

### A. ä»£ç è¡Œæ•°ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | ä¸»è¦åŠŸèƒ½ |
|-----|------|---------|
| base.py | 3335 | GUIä¸»ç¨‹åºã€æµç¨‹æ§åˆ¶ |
| main.py | 3435 | æ•°æ®å¤„ç†æ ¸å¿ƒé€»è¾‘ |
| main2.py | 236 | ç»“æœæ±‡æ€»ç”Ÿæˆ |
| Monitor.py | 422 | å¤„ç†ç›‘æ§å™¨ |
| **æ€»è®¡** | **7428è¡Œ** | **æ ¸å¿ƒä»£ç ** |

### B. ç¬¬ä¸‰æ–¹åº“è®¸å¯è¯

- pandas: BSD 3-Clause License
- openpyxl: MIT License
- xlrd: BSD License
- pystray: GPLv3
- Pillow: HPND License
- PyInstaller: GPLv2 with exception

### C. ç‰ˆæœ¬å†å²

- **v1.0** (åˆå§‹ç‰ˆæœ¬): å•æ–‡ä»¶å•é¡¹ç›®å¤„ç†
- **v1.5**: æ–°å¢æ‰¹é‡æ–‡ä»¶è¯†åˆ«
- **v2.0** (å½“å‰ç‰ˆæœ¬):
  - å¤šé¡¹ç›®å¹¶è¡Œå¤„ç†
  - è§’è‰²æƒé™ç³»ç»Ÿ
  - å®šæ—¶è‡ªåŠ¨åŒ–
  - ç›‘æ§å™¨ç´§å‡‘æ¨¡å¼
  - åŒæ—¥æœŸç­›é€‰é€»è¾‘
  - 6ç§æ–‡ä»¶ç±»å‹æ”¯æŒ

### D. è”ç³»æ–¹å¼

- **å¼€å‘è€…**: ç‹ä»»è¶…
- **å•ä½**: å»ºç­‘ç»“æ„æ‰€
- **æŠ€æœ¯æ”¯æŒ**: é€šè¿‡Gitä»“åº“Issuesåé¦ˆ

---

**æ–‡æ¡£ç»“æŸ**

> æœ¬æ–‡æ¡£ç”±AIåŠ©æ‰‹åŸºäº3æ¬¡è¿­ä»£æ·±åº¦ä»£ç åˆ†æç”Ÿæˆï¼Œæ€»è®¡åˆ†æä»£ç 7428è¡Œï¼Œè¦†ç›–ç‡100%ã€‚
> æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025-10-21

