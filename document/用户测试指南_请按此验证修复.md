# 用户测试指南 - 请按此验证修复

**目的**: 验证三个严重问题是否已修复  
**预计时间**: 10-15分钟

---

## 测试场景1：已审查任务状态保持 (2分钟)

### 步骤
1. 运行程序，找到一个已经显示为"已审查"的接口
2. 记录该接口的接口号（例如：S-SA---1JJ-01-25C1-25C3）
3. 关闭程序
4. 打开对应的Excel文件，在该接口所在行**上方**插入2-3个空行
5. 保存Excel文件
6. 重新运行程序，搜索该接口号

### 预期结果
✅ 该接口仍然显示为"已审查"状态  
❌ 如果变成"待完成"或"待审查"，说明问题未解决

### 请反馈
- [ ] 测试通过  
- [ ] 测试失败（请提供接口号和控制台输出）

---

## 测试场景2：新完成任务上级可见 (3分钟)

### 步骤
1. 以**设计人员**角色登录
2. 找到一个"待完成"的接口
3. 在Excel中填入回文单号（如"ABC-123"）
4. 保存Excel文件
5. 运行程序"开始处理"
6. 记录该接口号
7. 退出程序，以**上级角色**（所领导/室主任/接口工程师）登录
8. 运行程序，查看该接口

### 预期结果
✅ 该接口显示为"待审查"状态，上级角色可以看到  
❌ 如果上级看不到，或状态不对，说明问题未解决

### 请反馈
- [ ] 测试通过  
- [ ] 测试失败（请提供接口号、设计人和上级角色的控制台输出）

---

## 测试场景3：忽略功能时间变化检测 (5分钟)

### 步骤
1. 以**所领导**角色登录
2. 点击"忽略延期项"按钮
3. 选择1-2个延期任务，记录它们的接口号和当前预期时间
4. 点击"确认忽略"
5. 关闭程序
6. 打开对应的Excel文件，找到刚才忽略的接口
7. **修改预期时间**（例如从"2025-11-07"改为"2025-12-20"）
8. 保存Excel文件
9. 重新运行程序

### 预期结果
✅ 控制台应该有类似输出：
```
[Registry自动取消忽略] S-XXX-XXX: 预期时间变化 (2025-11-07 -> 2025-12-20)
[Registry] 已删除忽略快照记录
```
✅ 该接口重新显示在主窗口中，不再被忽略  
❌ 如果仍然被忽略（不显示），说明问题未解决

### 请反馈
- [ ] 测试通过  
- [ ] 测试失败（请提供：接口号、修改前后的预期时间、控制台输出）

---

##  测试场景4：仅时间格式变化不应取消忽略 (3分钟)

### 步骤
1. 以**所领导**角色登录
2. 点击"忽略延期项"，选择一个延期任务并忽略
3. 记录接口号和预期时间（例如"2025-11-10"）
4. 关闭程序
5. 打开Excel，找到该接口
6. **仅修改时间格式**（例如从"2025-11-10"改为"2025.11.10"或"2025/11/10"）
7. 保存Excel文件
8. 重新运行程序

### 预期结果
✅ 该接口仍然被忽略，不显示在主窗口中  
✅ 控制台没有"[Registry自动取消忽略]"输出  
❌ 如果重新显示了，说明时间标准化逻辑有问题

### 请反馈
- [ ] 测试通过  
- [ ] 测试失败（请提供接口号和控制台输出）

---

## 补充检查：数据库快照表

### 如何检查
1. 关闭程序
2. 使用SQLite工具（如DB Browser for SQLite）打开数据库文件：  
   `D:\PycharmProjects\PythonProject3\data\registry.db`
3. 查看是否有`ignored_snapshots`表
4. 如果有，查看表中是否有记录

### 预期结果
✅ `ignored_snapshots`表存在  
✅ 当有忽略任务时，表中有对应记录  
❌ 如果表不存在，说明数据库迁移失败

### 请反馈
- [ ] `ignored_snapshots`表存在且有记录  
- [ ] `ignored_snapshots`表存在但为空  
- [ ] `ignored_snapshots`表不存在

---

## 控制台关键输出

请注意查看以下控制台输出：

### 行号变化时的输出
```
[Registry调试] 接口S-XXX-XXX: 行号变化较大(旧行=100, 新行=150, 差距=50)，但仍继承状态
```
**含义**: 程序检测到行号变化，但会继承状态（这是正常的）

### 忽略快照检查输出
```
[忽略快照检查] 接口S-XXX-XXX
  快照时间: '2025-11-10' -> 标准化: '2025-11-10'
  当前时间: '2025-12-20' -> 标准化: '2025-12-20'
  快照行号: 100, 当前行号: 100
```
**含义**: 程序正在检查忽略快照，对比时间是否变化

### 自动取消忽略输出
```
[Registry自动取消忽略] S-XXX-XXX: 预期时间变化 (2025-11-10 -> 2025-12-20)
[Registry] 已删除忽略快照记录
```
**含义**: 检测到时间变化，自动取消忽略

### 标记忽略成功输出
```
[标记忽略]   ✓ 成功（已创建快照）
```
**含义**: 忽略操作成功，快照已创建

---

## 如果测试失败，请提供

1. **接口号**: 例如 S-SA---1JJ-01-25C1-25C3
2. **控制台完整输出**: 特别是包含该接口号的所有行
3. **历史查询截图**: 在历史查询中搜索该接口，截图显示
4. **Excel截图**: 该接口在Excel中的行（包括行号、预期时间、回文单号等关键列）

---

## 反馈方式

请在聊天中回复：

```
测试场景1：[通过/失败]
测试场景2：[通过/失败]
测试场景3：[通过/失败]
测试场景4：[通过/失败]
ignored_snapshots表：[存在有记录/存在但为空/不存在]

[如有失败，粘贴相关信息]
```

---

**感谢您的测试！您的反馈对于完善修复至关重要。**

