# æ•°æ®åº“è¿ç§»é€»è¾‘ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2025-11-09  
**é—®é¢˜ç±»å‹**: æ•°æ®åº“å­—æ®µç¼ºå¤±ã€è¿ç§»é€»è¾‘ä¸å®Œæ•´  
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜ï¼ˆå¯¼è‡´ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œï¼‰

---

## ğŸ”´ é—®é¢˜æè¿°

### ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜

1. **æ¸…ç©ºæ¥å£æ•°æ®åç¨‹åºå¡æ­»**
   - ç”¨æˆ·æ¸…ç©ºäº†4ä¸ªæ¥å£çš„å®Œæˆåˆ—ã€å›æ–‡å•å·åˆ—ã€å†™å…¥äººåˆ—
   - ç‚¹å‡»"åˆ·æ–°æ–‡ä»¶åˆ—è¡¨"åç¨‹åºå¡æ­»åœ¨é¢„åŠ è½½é˜¶æ®µ
   - é‡å¯åç‚¹å‡»"å¼€å§‹å¤„ç†"æŠ¥é”™

2. **æ•°æ®åº“å­—æ®µç¼ºå¤±é”™è¯¯**
```
sqlite3.OperationalError: table tasks has no column named response_number
```

3. **æ¸…ç©ºæ•°æ®çš„æ¥å£æ²¡æœ‰æ˜¾ç¤º**
   - è™½ç„¶ç¨‹åºè¯†åˆ«åˆ°å®Œæˆåˆ—è¢«æ¸…ç©º
   - ä½†è¿™äº›æ¥å£æ²¡æœ‰åœ¨ä¸»æ˜¾ç¤ºçª—å£æ˜¾ç¤º

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### åŸå› 1ï¼šè¿ç§»æ£€æŸ¥é€»è¾‘ä¸å®Œæ•´

**é—®é¢˜ä»£ç **ï¼ˆ`registry/migrate.py` ç¬¬105-117è¡Œï¼‰:
```python
def migrate_if_needed(db_path: str) -> None:
    ...
    conn = sqlite3.connect(db_path)
    try:
        # âŒ åªæ£€æŸ¥ä¸¤ä¸ªå­—æ®µï¼Œæ²¡æœ‰æ£€æŸ¥ response_number
        if not check_column_exists(conn, "tasks", "display_status") or \
           not check_column_exists(conn, "tasks", "business_id"):
            print("[Registry] æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬æ•°æ®åº“ï¼Œå¼€å§‹è‡ªåŠ¨è¿ç§»...")
            conn.close()
            migrate_database(db_path)
```

**é—®é¢˜**ï¼š
- è¿ç§»æ£€æŸ¥åªéªŒè¯ `display_status` å’Œ `business_id` å­—æ®µ
- å¦‚æœè¿™ä¸¤ä¸ªå­—æ®µå·²å­˜åœ¨ï¼Œå³ä½¿ç¼ºå°‘ `response_number`ï¼Œä¹Ÿä¸ä¼šè§¦å‘è¿ç§»
- å¯¼è‡´æ—§æ•°æ®åº“æ— æ³•è·å¾—æ–°å­—æ®µ

---

### åŸå› 2ï¼šæ•°æ®åº“å­—æ®µç¼ºå¤±å¯¼è‡´æ‰¹é‡upsertå¤±è´¥

**æ‰§è¡Œæµç¨‹**:
```
1. ç”¨æˆ·æ¸…ç©ºæ¥å£çš„å®Œæˆåˆ—æ•°æ®
   â†“
2. ç‚¹å‡»"å¼€å§‹å¤„ç†"
   â†“
3. Registryè¯†åˆ«åˆ°å®Œæˆåˆ—è¢«æ¸…ç©ºï¼ˆâœ… æ­£ç¡®ï¼‰
   [Registry] æ¥å£S-SA---1JT-01-25C1-25E6: å®Œæˆåˆ—è¢«æ¸…ç©ºï¼Œé‡ç½®çŠ¶æ€
   â†“
4. å°è¯•æ‰§è¡Œ batch_upsert_tasks
   â†“
5. SQLåŒ…å« response_number å­—æ®µï¼ˆâŒ æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼‰
   â†“
6. sqlite3.OperationalError: table tasks has no column named response_number
   â†“
7. æ•´ä¸ªæ‰¹é‡upsertå¤±è´¥ï¼Œäº‹åŠ¡å›æ»š
   â†“
8. æ¥å£çŠ¶æ€æ²¡æœ‰è¢«é‡ç½®ï¼Œä»ä¿ç•™åœ¨æ•°æ®åº“ä¸­çš„æ—§çŠ¶æ€
   â†“
9. ç”±äºçŠ¶æ€æ˜¯ confirmedï¼Œè¢«è¿‡æ»¤æ‰ï¼Œä¸åœ¨ä¸»çª—å£æ˜¾ç¤º
```

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šå®Œå–„è¿ç§»æ£€æŸ¥é€»è¾‘

**ä¿®æ”¹æ–‡ä»¶**: `registry/migrate.py`  
**ä¿®æ”¹ä½ç½®**: `migrate_if_needed` å‡½æ•°ï¼ˆç¬¬92-124è¡Œï¼‰

**ä¿®å¤åä»£ç **:
```python
def migrate_if_needed(db_path: str) -> None:
    """
    æ™ºèƒ½è¿ç§»ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦è¿ç§»
    
    å‚æ•°:
        db_path: æ•°æ®åº“è·¯å¾„
    """
    if not os.path.exists(db_path):
        # æ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæœ€æ–°ç‰ˆæœ¬ï¼Œæ— éœ€è¿ç§»
        return
    
    conn = sqlite3.connect(db_path)
    try:
        # âœ… æ£€æŸ¥æ‰€æœ‰å…³é”®å­—æ®µ
        missing_fields = []
        required_fields = ["display_status", "business_id", "response_number"]
        
        for field in required_fields:
            if not check_column_exists(conn, "tasks", field):
                missing_fields.append(field)
        
        if missing_fields:
            print(f"[Registry] æ£€æµ‹åˆ°æ•°æ®åº“ç¼ºå°‘å­—æ®µ: {', '.join(missing_fields)}ï¼Œå¼€å§‹è‡ªåŠ¨è¿ç§»...")
            conn.close()
            migrate_database(db_path)
        # else: ç‰ˆæœ¬æ£€æŸ¥é€šè¿‡ï¼Œä¸è¾“å‡ºï¼ˆé¿å…é¢‘ç¹æ—¥å¿—ï¼‰
    except Exception as e:
        print(f"[Registry] ç‰ˆæœ¬æ£€æŸ¥å¤±è´¥: {e}")
    finally:
        try:
            conn.close()
        except:
            pass
```

**æ”¹è¿›ç‚¹**:
1. âœ… æ£€æŸ¥æ‰€æœ‰å…³é”®å­—æ®µï¼ŒåŒ…æ‹¬æ–°å¢çš„ `response_number`
2. âœ… æ˜ç¡®åˆ—å‡ºç¼ºå¤±çš„å­—æ®µåç§°
3. âœ… æ›´æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
4. âœ… æ›´å®¹æ˜“æ‰©å±•ï¼ˆæœªæ¥æ·»åŠ æ–°å­—æ®µåªéœ€ä¿®æ”¹ `required_fields` åˆ—è¡¨ï¼‰

---

## ğŸ¯ éªŒè¯æ¸…ç©ºæ¥å£é€»è¾‘çš„æ­£ç¡®æ€§

### Registryæ¨¡å—çš„æ¸…ç©ºé€»è¾‘ï¼ˆ`registry/service.py` ç¬¬624-638è¡Œï¼‰

```python
# ã€å…³é”®ã€‘ä¼˜å…ˆæ£€æŸ¥å®Œæˆåˆ—æ˜¯å¦è¢«æ¸…ç©ºï¼ˆåŒ…æ‹¬å·²ç¡®è®¤çš„ä»»åŠ¡ï¼‰
if not new_completed_val and old_task['completed_at']:
    # å®Œæˆåˆ—è¢«åˆ é™¤ï¼Œå¼ºåˆ¶é‡ç½®ï¼ˆå³ä½¿æ˜¯å·²ç¡®è®¤çš„ä»»åŠ¡ä¹Ÿè¦é‡ç½®ï¼‰
    print(f"[Registry] æ¥å£{key['interface_id']}: å®Œæˆåˆ—è¢«æ¸…ç©ºï¼Œé‡ç½®çŠ¶æ€ï¼ˆold_status={old_task['status']}ï¼‰")
    fields['display_status'] = 'å¾…å®Œæˆ' if old_task['responsible_person'] else 'è¯·æŒ‡æ´¾'
    fields['status'] = Status.OPEN
    # æ¸…é™¤å®Œæˆç›¸å…³å­—æ®µ
    fields['completed_at'] = None
    fields['confirmed_at'] = None
    fields['confirmed_by'] = None
    # ä¿ç•™æŒ‡æ´¾ä¿¡æ¯
    if old_task['assigned_by']:
        fields['assigned_by'] = old_task['assigned_by']
        fields['assigned_at'] = old_task['assigned_at']
        fields['responsible_person'] = old_task['responsible_person']
```

**é€»è¾‘éªŒè¯**ï¼šâœ… **å®Œå…¨æ­£ç¡®**

è¯¥é€»è¾‘èƒ½å¤Ÿæ­£ç¡®å¤„ç†ä»¥ä¸‹åœºæ™¯ï¼š
1. âœ… æ£€æµ‹å®Œæˆåˆ—è¢«æ¸…ç©ºï¼ˆ`not new_completed_val and old_task['completed_at']`ï¼‰
2. âœ… å°†çŠ¶æ€é‡ç½®ä¸º `Status.OPEN`
3. âœ… è®¾ç½®æ­£ç¡®çš„ `display_status`ï¼ˆæœ‰è´£ä»»äººæ˜¾ç¤º"å¾…å®Œæˆ"ï¼Œæ— è´£ä»»äººæ˜¾ç¤º"è¯·æŒ‡æ´¾"ï¼‰
4. âœ… æ¸…ç©ºæ‰€æœ‰å®Œæˆç›¸å…³å­—æ®µï¼ˆ`completed_at`ã€`confirmed_at`ã€`confirmed_by`ï¼‰
5. âœ… ä¿ç•™æŒ‡æ´¾ä¿¡æ¯ï¼ˆé¿å…é‡å¤æŒ‡æ´¾ï¼‰
6. âœ… å¯¹å·²ç¡®è®¤çš„ä»»åŠ¡ä¹Ÿèƒ½æ­£ç¡®é‡ç½®

**ä¹‹å‰å¤±è´¥çš„åŸå› **ï¼š
- ä¸æ˜¯é€»è¾‘é”™è¯¯
- è€Œæ˜¯æ•°æ®åº“å­—æ®µç¼ºå¤±å¯¼è‡´æ•´ä¸ª upsert äº‹åŠ¡å¤±è´¥
- ä¿®å¤æ•°æ®åº“å­—æ®µåï¼Œæ­¤é€»è¾‘å°†æ­£å¸¸å·¥ä½œ

---

## ğŸ“‹ å®Œæ•´æ‰§è¡Œæµç¨‹ï¼ˆä¿®å¤åï¼‰

### åœºæ™¯ï¼šç”¨æˆ·æ¸…ç©ºå·²ç¡®è®¤æ¥å£çš„å®Œæˆåˆ—æ•°æ®

```
1. ç”¨æˆ·åœ¨Excelä¸­æ¸…ç©ºå®Œæˆåˆ—ã€å›æ–‡å•å·åˆ—ã€å†™å…¥äººåˆ—
   â†“
2. ç‚¹å‡»"åˆ·æ–°æ–‡ä»¶åˆ—è¡¨"
   â†“
3. ç¨‹åºé‡æ–°è¯»å–Excelæ–‡ä»¶
   â†“
4. ç‚¹å‡»"å¼€å§‹å¤„ç†"
   â†“
5. è°ƒç”¨ on_process_done â†’ batch_upsert_tasks
   â†“
6. æ£€æµ‹åˆ°å®Œæˆåˆ—è¢«æ¸…ç©ºï¼ˆ_completed_col_value ä¸ºç©ºï¼‰
   [Registry] æ¥å£S-SA---1JT-01-25C1-25E6: å®Œæˆåˆ—è¢«æ¸…ç©ºï¼Œé‡ç½®çŠ¶æ€ï¼ˆold_status=confirmedï¼‰
   â†“
7. é‡ç½®æ¥å£çŠ¶æ€ï¼š
   - status = 'open'
   - display_status = 'å¾…å®Œæˆ' æˆ– 'è¯·æŒ‡æ´¾'
   - completed_at = NULL
   - confirmed_at = NULL
   - confirmed_by = NULL
   â†“
8. æ‰§è¡Œ batch_upsert_tasksï¼ˆâœ… æ•°æ®åº“å·²æœ‰ response_number å­—æ®µï¼‰
   â†“
9. SQLæˆåŠŸæ‰§è¡Œï¼ŒçŠ¶æ€å†™å…¥æ•°æ®åº“
   â†“
10. query_tasks_with_status æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡
   â†“
11. æŸ¥è¯¢æ¡ä»¶ï¼šdisplay_status IS NOT NULL AND display_status != '' 
                AND status != 'confirmed' AND status != 'archived'
   â†“
12. æ¥å£çŠ¶æ€ä¸º 'open'ï¼Œdisplay_status ä¸º 'å¾…å®Œæˆ'ï¼ˆâœ… ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ï¼‰
   â†“
13. æ¥å£åœ¨ä¸»çª—å£æ­£ç¡®æ˜¾ç¤º
```

---

## ğŸš€ ç”¨æˆ·æ“ä½œæŒ‡å—

### æ­¥éª¤1ï¼šé‡å¯ç¨‹åºï¼ˆè‡ªåŠ¨è¿ç§»ï¼‰

**æ“ä½œ**:
```
1. å…³é—­å½“å‰è¿è¡Œçš„ç¨‹åº
2. é‡æ–°å¯åŠ¨ç¨‹åº
```

**é¢„æœŸè¾“å‡º**ï¼ˆæ§åˆ¶å°ï¼‰:
```
[Registry] æ£€æµ‹åˆ°æ•°æ®åº“ç¼ºå°‘å­—æ®µ: response_numberï¼Œå¼€å§‹è‡ªåŠ¨è¿ç§»...
[Migrate] Checking database...
  [OK] Added column: response_number
[Migrate] Done! Added 1 columns
```

å¦‚æœçœ‹åˆ°ä»¥ä¸Šè¾“å‡ºï¼Œè¯´æ˜è¿ç§»æˆåŠŸï¼

---

### æ­¥éª¤2ï¼šé‡æ–°æµ‹è¯•æ¸…ç©ºæ¥å£åŠŸèƒ½

**æ“ä½œ**:
```
1. æ‰“å¼€æºExcelæ–‡ä»¶
2. æ‰¾åˆ°ä¹‹å‰æ¸…ç©ºæ•°æ®çš„4ä¸ªæ¥å£
3. ç¡®è®¤ä»¥ä¸‹åˆ—å·²æ¸…ç©ºï¼š
   - å®Œæˆæ—¶é—´åˆ—ï¼ˆMåˆ—/Nåˆ—/Våˆ—ç­‰ï¼Œè§†æ–‡ä»¶ç±»å‹è€Œå®šï¼‰
   - å›æ–‡å•å·åˆ—ï¼ˆSåˆ—/Påˆ—/Uåˆ—ç­‰ï¼‰
   - å†™å…¥äººåˆ—ï¼ˆVåˆ—/ALåˆ—/ATåˆ—ç­‰ï¼‰
4. ä¿å­˜Excelæ–‡ä»¶
5. åœ¨ç¨‹åºä¸­ç‚¹å‡»"åˆ·æ–°æ–‡ä»¶åˆ—è¡¨"
6. ç‚¹å‡»"å¼€å§‹å¤„ç†"
```

**é¢„æœŸç»“æœ**:
```
âœ… æ§åˆ¶å°è¾“å‡ºï¼š
   [Registry] æ¥å£XXX: å®Œæˆåˆ—è¢«æ¸…ç©ºï¼Œé‡ç½®çŠ¶æ€ï¼ˆold_status=confirmedï¼‰

âœ… ä¸»æ˜¾ç¤ºçª—å£ï¼š
   - è¿™4ä¸ªæ¥å£åº”è¯¥æ­£å¸¸æ˜¾ç¤º
   - çŠ¶æ€æ˜¾ç¤ºä¸º"å¾…å®Œæˆ"æˆ–"è¯·æŒ‡æ´¾"

âœ… æ¥å£å¯ä»¥é‡æ–°å¤„ç†ï¼š
   - å¯ä»¥é‡æ–°æŒ‡æ´¾
   - å¯ä»¥é‡æ–°å†™å…¥å›æ–‡å•å·
   - å¯ä»¥é‡æ–°ç¡®è®¤
```

---

### æ­¥éª¤3ï¼šéªŒè¯å†å²è®°å½•

**æ“ä½œ**:
```
1. ç‚¹å‡»"å†å²æŸ¥è¯¢"æŒ‰é’®
2. è¾“å…¥å…¶ä¸­ä¸€ä¸ªæ¥å£çš„é¡¹ç›®å·å’Œæ¥å£å·
3. ç‚¹å‡»"æŸ¥è¯¢"
```

**é¢„æœŸç»“æœ**:
```
âœ… å†å²è®°å½•åº”è¯¥æ˜¾ç¤ºï¼š
   - æœ€åˆçš„ç¡®è®¤è®°å½•ï¼ˆstatus = 'å·²ç¡®è®¤'ï¼‰
   - é‡æ–°æ‰“å¼€çš„è®°å½•ï¼ˆstatus = 'å¾…å®Œæˆ'ï¼Œconfirmed_at ä¸ºç©ºï¼‰
   - å›æ–‡å•å·åˆ—æ­£å¸¸æ˜¾ç¤ºï¼ˆä¹‹å‰å†™å…¥çš„å›æ–‡å•å·åº”è¯¥è¿˜åœ¨ï¼‰
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

| æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ | çŠ¶æ€ |
|--------|------|---------|------|
| è‡ªåŠ¨è¿ç§» | é‡å¯ç¨‹åº | æ§åˆ¶å°æ˜¾ç¤º"Added column: response_number" | â³ å¾…æµ‹è¯• |
| æ¸…ç©ºæ¥å£æ˜¾ç¤º | æ¸…ç©ºå®Œæˆåˆ—åç‚¹å‡»"å¼€å§‹å¤„ç†" | æ¥å£åœ¨ä¸»çª—å£æ˜¾ç¤º | â³ å¾…æµ‹è¯• |
| æ¥å£çŠ¶æ€é‡ç½® | æŸ¥çœ‹æ¸…ç©ºæ¥å£çš„çŠ¶æ€ | æ˜¾ç¤º"å¾…å®Œæˆ"æˆ–"è¯·æŒ‡æ´¾" | â³ å¾…æµ‹è¯• |
| å†å²è®°å½• | æŸ¥è¯¢æ¸…ç©ºæ¥å£çš„å†å² | æ˜¾ç¤ºé‡ç½®è®°å½•å’Œå›æ–‡å•å· | â³ å¾…æµ‹è¯• |
| é‡æ–°å¤„ç† | å¯¹æ¸…ç©ºæ¥å£é‡æ–°æŒ‡æ´¾å’Œå†™å…¥ | å¯ä»¥æ­£å¸¸æ“ä½œ | â³ å¾…æµ‹è¯• |
| å†™å…¥å›æ–‡å•å· | æ–°å†™å…¥å›æ–‡å•å· | æ­£å¸¸å†™å…¥å¹¶è®°å½•åˆ°æ•°æ®åº“ | â³ å¾…æµ‹è¯• |

---

## âš ï¸ å¦‚æœè‡ªåŠ¨è¿ç§»å¤±è´¥

å¦‚æœé‡å¯ç¨‹åºå**æ²¡æœ‰**çœ‹åˆ°è¿ç§»æ—¥å¿—ï¼Œæˆ–è€…ä»ç„¶æŠ¥é”™ `table tasks has no column named response_number`ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ‰‹åŠ¨æ“ä½œï¼š

### æ–¹æ¡ˆAï¼šåˆ é™¤æ—§æ•°æ®åº“ï¼ˆç®€å•ï¼Œä½†ä¼šä¸¢å¤±å†å²è®°å½•ï¼‰

**âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œä¼šåˆ é™¤æ‰€æœ‰å†å²æ•°æ®ï¼**

```
1. å¯¼èˆªåˆ°ï¼šD:\Programs\æ¥å£ç­›é€‰\æµ‹è¯•æ–‡ä»¶\.registry\
2. å¤‡ä»½ registry.db æ–‡ä»¶ï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
3. åˆ é™¤ registry.db æ–‡ä»¶
4. é‡å¯ç¨‹åºï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºåŒ…å«æ‰€æœ‰å­—æ®µçš„æ–°æ•°æ®åº“ï¼‰
```

### æ–¹æ¡ˆBï¼šæ‰‹åŠ¨è¿è¡Œè¿ç§»è„šæœ¬ï¼ˆæ¨èï¼Œä¿ç•™å†å²ï¼‰

**æ­¥éª¤**:
```powershell
# 1. æ‰“å¼€PowerShellæˆ–å‘½ä»¤æç¤ºç¬¦
# 2. åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd D:\PycharmProjects\PythonProject3

# 3. æ‰‹åŠ¨è¿è¡Œè¿ç§»
python -c "from registry.migrate import migrate_database; migrate_database(r'D:\Programs\æ¥å£ç­›é€‰\æµ‹è¯•æ–‡ä»¶\.registry\registry.db')"
```

**é¢„æœŸè¾“å‡º**:
```
[Migrate] Checking database...
  [OK] Added column: response_number
[Migrate] Done! Added 1 columns
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|---------|------|
| `registry/migrate.py` | å®Œå–„è¿ç§»æ£€æŸ¥é€»è¾‘ï¼Œå¢åŠ  response_number å­—æ®µæ£€æŸ¥ | ç¬¬92-124è¡Œ |

**æ€»è®¡**: 1ä¸ªæ–‡ä»¶ï¼Œä¿®æ”¹çº¦30è¡Œ

---

## ğŸ“ ç»éªŒæ•™è®­

### 1. è¿ç§»æ£€æŸ¥å¿…é¡»å…¨é¢

**é—®é¢˜**:
- åªæ£€æŸ¥éƒ¨åˆ†å­—æ®µï¼Œå¯¼è‡´æ–°å¢å­—æ®µæ— æ³•è‡ªåŠ¨æ·»åŠ 

**è§£å†³**:
- ç»´æŠ¤ä¸€ä¸ª `required_fields` åˆ—è¡¨
- æ£€æŸ¥æ‰€æœ‰å¿…éœ€å­—æ®µ
- æ˜ç¡®åˆ—å‡ºç¼ºå¤±å­—æ®µ

### 2. æ•°æ®åº“Schemaå˜æ›´éœ€è¦å®Œæ•´çš„è¿ç§»ç­–ç•¥

**æœ€ä½³å®è·µ**:
```python
# âœ… æ¨èï¼šå®Œæ•´çš„å­—æ®µæ£€æŸ¥
required_fields = ["field1", "field2", "field3"]
for field in required_fields:
    if not check_column_exists(conn, "tasks", field):
        missing_fields.append(field)

# âŒ ä¸æ¨èï¼šç¡¬ç¼–ç æ£€æŸ¥
if not check_column_exists(conn, "tasks", "field1"):
    migrate()
```

### 3. äº‹åŠ¡å¤±è´¥ä¼šå¯¼è‡´è¿é”é—®é¢˜

**é—®é¢˜åˆ†æ**:
- Registryé€»è¾‘æ­£ç¡®è¯†åˆ«åˆ°å®Œæˆåˆ—æ¸…ç©º
- ä½†æ•°æ®åº“å­—æ®µç¼ºå¤±å¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥
- æ¥å£çŠ¶æ€æ²¡æœ‰æˆåŠŸé‡ç½®
- å¯¼è‡´ç”¨æˆ·ä»¥ä¸ºæ˜¯é€»è¾‘é”™è¯¯

**æ•™è®­**:
- ç¡®ä¿æ•°æ®åº“Schemaä¸ä»£ç åŒæ­¥
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- å®Œå–„çš„è¿ç§»æœºåˆ¶

---

## âœ… ä¿®å¤çŠ¶æ€

| é¡¹ç›® | çŠ¶æ€ |
|------|------|
| è¿ç§»é€»è¾‘ä¿®å¤ | âœ… å·²å®Œæˆ |
| æ¸…ç©ºæ¥å£é€»è¾‘éªŒè¯ | âœ… å·²éªŒè¯ï¼ˆé€»è¾‘æ­£ç¡®ï¼‰ |
| æ–‡æ¡£ç”Ÿæˆ | âœ… å·²å®Œæˆ |
| ç”¨æˆ·æµ‹è¯• | â³ å¾…è¿›è¡Œ |

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-11-09  
**ä¿®å¤çŠ¶æ€**: âœ… ä»£ç å·²ä¿®å¤ï¼Œå¾…ç”¨æˆ·æµ‹è¯•éªŒè¯

