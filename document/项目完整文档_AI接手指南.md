# æ¥å£ç­›é€‰ç¨‹åº - å®Œæ•´é¡¹ç›®æ–‡æ¡£ä¸AIæ¥æ‰‹æŒ‡å—

> **ç‰ˆæœ¬**: 3.0  
> **æœ€åæ›´æ–°**: 2025-10-30  
> **ç›®æ ‡**: è®©æ–°çš„AIåŠ©æ‰‹èƒ½å¤Ÿæ— ç¼æ¥æ‰‹æ­¤é¡¹ç›®ï¼Œç†è§£æ‰€æœ‰è®¾è®¡å†³ç­–ã€ä»£ç é£æ ¼å’Œä¸šåŠ¡é€»è¾‘

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒä¸šåŠ¡é€»è¾‘](#æ ¸å¿ƒä¸šåŠ¡é€»è¾‘)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [ä»£ç ç»“æ„è¯¦è§£](#ä»£ç ç»“æ„è¯¦è§£)
5. [å…³é”®æŠ€æœ¯å®ç°](#å…³é”®æŠ€æœ¯å®ç°)
6. [ç¼–ç é£æ ¼è§„èŒƒ](#ç¼–ç é£æ ¼è§„èŒƒ)
7. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
8. [é‡è¦å†å²å†³ç­–](#é‡è¦å†å²å†³ç­–)
9. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
10. [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®èƒŒæ™¯

è¿™æ˜¯ä¸€ä¸ª**æ¥å£æ•°æ®ç­›é€‰ä¸å¯¼å‡ºå·¥å…·**ï¼Œä¸»è¦ç”¨äºå»ºç­‘è®¾è®¡é™¢çš„æ¥å£ç®¡ç†å·¥ä½œã€‚ç¨‹åºä»å¤šä¸ªExcelæ–‡ä»¶ä¸­è¯»å–æ¥å£æ•°æ®ï¼Œæ ¹æ®ä¸åŒè§’è‰²ï¼ˆæ‰€é¢†å¯¼ã€å®¤ä¸»ä»»ã€è®¾è®¡äººå‘˜ã€ç®¡ç†å‘˜ã€æ¥å£å·¥ç¨‹å¸ˆï¼‰çš„æƒé™å’Œéœ€æ±‚ï¼Œç­›é€‰å‡ºç›¸å…³çš„å¾…å¤„ç†æ¥å£ï¼Œå¹¶æ”¯æŒå¯¼å‡ºä¸ºTXTæ ¼å¼æŠ¥å‘Šã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **å¤šè§’è‰²æƒé™ç®¡ç†**: 5ç§è§’è‰²ï¼Œæ¯ç§è§’è‰²æœ‰ä¸åŒçš„æ•°æ®å¯è§èŒƒå›´å’Œæ—¶é—´çª—å£
2. **6ç±»æ–‡ä»¶å¤„ç†**: 
   - æ–‡ä»¶1-5: æ¥å£æ•°æ®æ–‡ä»¶ï¼ˆå†…éƒ¨/å¤–éƒ¨ Ã— æ‰“å¼€/å›å¤ + ä¸‰ç»´æèµ„ï¼‰
   - æ–‡ä»¶6: æ”¶å‘æ–‡å‡½ï¼ˆç‰¹æ®Šå¤„ç†é€»è¾‘ï¼‰
3. **æ™ºèƒ½æ—¥æœŸç­›é€‰**: å·¥ä½œæ—¥è®¡ç®—ã€è·¨å¹´æ—¥æœŸè§£æã€æœˆåº¦èŒƒå›´
4. **ç»“æœç¼“å­˜**: æ–‡ä»¶å“ˆå¸Œæ£€æµ‹å˜åŒ–ï¼Œé¿å…é‡å¤å¤„ç†
5. **ç”¨æˆ·çŠ¶æ€éš”ç¦»**: æ¯ä¸ªç”¨æˆ·çš„å‹¾é€‰çŠ¶æ€ç‹¬ç«‹ä¿å­˜
6. **è‡ªåŠ¨è¿è¡Œæ¨¡å¼**: æ”¯æŒå¼€æœºè‡ªå¯åŠ¨ã€å®šæ—¶åˆ·æ–°
7. **ç³»ç»Ÿæ‰˜ç›˜**: æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜ï¼Œåå°è¿è¡Œ

### æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.8ï¼ˆå…¼å®¹Win7+ï¼‰
- **GUI**: Tkinter
- **æ•°æ®å¤„ç†**: Pandas 1.1.5, NumPy 1.19.5
- **Excelè¯»å–**: openpyxl 3.0.10, xlrd 1.2.0
- **ç³»ç»Ÿæ‰˜ç›˜**: pystray 0.19.4, Pillow 8.4.0
- **æ‰“åŒ…**: PyInstaller
- **æµ‹è¯•**: pytest

### éƒ¨ç½²ç¯å¢ƒ

- **æœ€ä½ç³»ç»Ÿ**: Windows 7 SP1
- **æ¨èç³»ç»Ÿ**: Windows 10/11
- **å†…å­˜**: æœ€ä½2GBï¼Œæ¨è4GB+
- **ç£ç›˜ç©ºé—´**: ç¨‹åºçº¦150MBï¼Œç¼“å­˜åŠ¨æ€å¢é•¿

---

## æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### 1. è§’è‰²ä¸æƒé™ä½“ç³»

| è§’è‰² | ç§‘å®¤é™åˆ¶ | æ—¶é—´çª—å£ | æ–‡ä»¶è®¿é—® | å¯¼å‡ºæ¨¡å¼ | ç‰¹æ®Šè¯´æ˜ |
|------|---------|---------|---------|---------|---------|
| **æ‰€é¢†å¯¼** | âŒ æ— ï¼ˆå…¨éƒ¨é—¨ï¼‰ | 2å·¥ä½œæ—¥ | æ–‡ä»¶1-6 | ç®€æ´ï¼ˆè‡ªåŠ¨ï¼‰ | æ–‡ä»¶6æ— æ—¶é—´é™åˆ¶ |
| **ä¸€å®¤ä¸»ä»»** | âœ… ä¸€å®¤ | 7å·¥ä½œæ—¥ | æ–‡ä»¶1-6 | å®Œæ•´ | - |
| **äºŒå®¤ä¸»ä»»** | âœ… äºŒå®¤ | 7å·¥ä½œæ—¥ | æ–‡ä»¶1-6 | å®Œæ•´ | - |
| **å»ºç­‘æ€»å›¾å®¤ä¸»ä»»** | âœ… å»ºç­‘æ€»å›¾å®¤ | 7å·¥ä½œæ—¥ | æ–‡ä»¶1-6 | å®Œæ•´ | - |
| **ç®¡ç†å‘˜** | âŒ æ—  | æ— é™åˆ¶ | æ–‡ä»¶1-6 | å¯é€‰ç®€æ´ | æ–‡ä»¶6æ— æ—¶é—´é™åˆ¶ |
| **è®¾è®¡äººå‘˜** | âœ… æŒ‰å§“å | æœˆåº¦èŒƒå›´ | æ–‡ä»¶1-5 | å®Œæ•´ | æ— æ–‡ä»¶6æƒé™ |
| **æ¥å£å·¥ç¨‹å¸ˆ** | âŒ æ—  | æ— é™åˆ¶ | æ–‡ä»¶1-5 | å®Œæ•´ | æŒ‰é¡¹ç›®å·ç­›é€‰ |

### 2. æ–‡ä»¶å¤„ç†é€»è¾‘

#### æ–‡ä»¶1-5ï¼ˆæ¥å£æ•°æ®æ–‡ä»¶ï¼‰

**æ–‡ä»¶è¯†åˆ«è§„åˆ™**:
- **æ–‡ä»¶1**: `{é¡¹ç›®å·}æŒ‰é¡¹ç›®å¯¼å‡ºIDIæ‰‹å†Œ{æ—¥æœŸ}` æˆ– `{é¡¹ç›®å·}{ä»»æ„æ–‡å­—}IDIæ‰‹å†Œ{æ—¥æœŸ}`
- **æ–‡ä»¶2**: `{é¡¹ç›®å·}æ¥å£ç§»äº¤è¡¨{æ—¥æœŸ}` æˆ– `{é¡¹ç›®å·}{ä»»æ„æ–‡å­—}æ¥å£ç§»äº¤è¡¨{æ—¥æœŸ}`
- **æ–‡ä»¶3**: `{é¡¹ç›®å·}æ¥å£ç­”å¤è¡¨{æ—¥æœŸ}` æˆ– `{é¡¹ç›®å·}{ä»»æ„æ–‡å­—}æ¥å£ç­”å¤è¡¨{æ—¥æœŸ}`
- **æ–‡ä»¶4**: `{é¡¹ç›®å·}å¤–éƒ¨å•ä½æ‰“å¼€æ¥å£{æ—¥æœŸ}` æˆ– `{é¡¹ç›®å·}{ä»»æ„æ–‡å­—}å¤–éƒ¨å•ä½æ‰“å¼€æ¥å£{æ—¥æœŸ}`
- **æ–‡ä»¶5**: `{é¡¹ç›®å·}ä¸‰ç»´æèµ„{æ—¥æœŸ}` æˆ– `{é¡¹ç›®å·}{ä»»æ„æ–‡å­—}ä¸‰ç»´æèµ„{æ—¥æœŸ}`

å…¶ä¸­ `{é¡¹ç›®å·}` å¿…é¡»æ˜¯4ä½æ•°å­—ï¼ˆå¦‚2016ã€2026ã€2306ï¼‰ã€‚

**å…±åŒå¤„ç†é€»è¾‘**:
1. æå–è´£ä»»äººï¼ˆXåˆ—/ç¬¬24åˆ—ï¼‰
2. æå–æ¥å£æ—¶é—´ï¼ˆå„æ–‡ä»¶åˆ—ä½ç½®ä¸åŒï¼‰
3. æ ¹æ®è§’è‰²ç­›é€‰è´£ä»»äºº
4. æ ¹æ®è§’è‰²åº”ç”¨æ—¶é—´çª—å£
5. ç”Ÿæˆ `é¡¹ç›®å·`ã€`æ¥å£å·`ã€`æ¥å£æ—¶é—´` åˆ—
6. æ·»åŠ  `çŠ¶æ€` åˆ—ï¼ˆâš ï¸è¡¨ç¤ºå»¶æœŸï¼‰

**æ—¥æœŸåˆ—ä½ç½®**:
- **æ–‡ä»¶1**: Kåˆ—ï¼ˆç´¢å¼•10ï¼‰
- **æ–‡ä»¶2**: Måˆ—ï¼ˆç´¢å¼•12ï¼‰
- **æ–‡ä»¶3**: Måˆ—ä¼˜å…ˆï¼ŒMä¸ºç©ºæ—¶ç”¨Låˆ—ï¼ˆç´¢å¼•12/11ï¼‰
- **æ–‡ä»¶4**: Såˆ—ï¼ˆç´¢å¼•18ï¼‰
- **æ–‡ä»¶5**: Låˆ—ï¼ˆç´¢å¼•11ï¼‰

#### æ–‡ä»¶6ï¼ˆæ”¶å‘æ–‡å‡½ï¼‰

**æ–‡ä»¶è¯†åˆ«è§„åˆ™**:
- æ–‡ä»¶ååŒ…å« `"æ”¶å‘æ–‡"` æˆ– `"å‘æ–‡æ¸…å•"` å…³é”®è¯

**ç­›é€‰æ¡ä»¶**:
- **Våˆ—**ï¼ˆç´¢å¼•21ï¼‰: å¿…é¡»åŒ…å« `"æ²³åŒ—åˆ†å…¬å¸.å»ºç­‘ç»“æ„æ‰€"`
- **Iåˆ—**ï¼ˆç´¢å¼•8ï¼‰: æ—¥æœŸ â‰¤ ä»Šå¤©+14å¤©ï¼ˆåŒ…å«è¿‡å»æ‰€æœ‰æ—¥æœŸï¼‰
  - **ä¾‹å¤–**: ç®¡ç†å‘˜å’Œæ‰€é¢†å¯¼è·³è¿‡Iåˆ—æ—¶é—´ç­›é€‰
- **Måˆ—**ï¼ˆç´¢å¼•12ï¼‰: å¿…é¡»ä¸º `"å°šæœªå›å¤"` æˆ– `"è¶…æœŸæœªå›å¤"`

**ç‰¹æ®Šå¤„ç†**:
- ç®¡ç†å‘˜å’Œæ‰€é¢†å¯¼: **ä¸å—Iåˆ—æ—¶é—´é™åˆ¶**ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰å†å²å’Œæœªæ¥æ•°æ®
- å…¶ä»–è§’è‰²: å—Iåˆ—æ—¶é—´ç­›é€‰
- ä¿ç•™åŸå§‹æ‰€æœ‰åˆ—ï¼Œä¸åšåˆ—è£å‰ª

### 3. æ—¶é—´çª—å£è®¡ç®—

#### å·¥ä½œæ—¥è®¡ç®—ï¼ˆç”¨äºæ‰€é¢†å¯¼ã€å®¤ä¸»ä»»ï¼‰

**æ ¸å¿ƒå‡½æ•°**: `date_utils.get_workday_difference(target_date, reference_date)`

```python
def get_workday_difference(target_date: date, reference_date: date) -> int:
    """
    è®¡ç®—ç›®æ ‡æ—¥æœŸä¸å‚è€ƒæ—¥æœŸä¹‹é—´çš„å·¥ä½œæ—¥å·®å¼‚
    - æ­£æ•°: target_date åœ¨ reference_date ä¹‹å
    - è´Ÿæ•°: target_date åœ¨ reference_date ä¹‹å‰ï¼ˆå·²å»¶æœŸï¼‰
    - æ’é™¤å‘¨å…­ã€å‘¨æ—¥
    """
```

**åº”ç”¨åœºæ™¯**:
- **æ‰€é¢†å¯¼**: ä¿ç•™å·¥ä½œæ—¥å·® â‰¤ 2 çš„æ•°æ®ï¼ˆæ‰€æœ‰å·²å»¶æœŸ + æœªæ¥2ä¸ªå·¥ä½œæ—¥ï¼‰
- **å®¤ä¸»ä»»**: ä¿ç•™å·¥ä½œæ—¥å·® â‰¤ 7 çš„æ•°æ®ï¼ˆæ‰€æœ‰å·²å»¶æœŸ + æœªæ¥7ä¸ªå·¥ä½œæ—¥ï¼‰

#### è·¨å¹´æ—¥æœŸè§£æ

**æ ¸å¿ƒå‡½æ•°**: `date_utils.parse_mmdd_to_date(date_str, reference_date)`

**æ™ºèƒ½é€»è¾‘**ï¼ˆ180å¤©é˜ˆå€¼ï¼‰:
```
å‡è®¾ä»Šå¤©æ˜¯2025-10-28:
- "09.15" â†’ ä»Šå¹´9æœˆ15æ—¥ï¼ˆå·²å»¶æœŸï¼Œç›¸å·®<180å¤©ï¼‰
- "10.20" â†’ ä»Šå¹´10æœˆ20æ—¥ï¼ˆå·²å»¶æœŸï¼‰
- "11.05" â†’ ä»Šå¹´11æœˆ5æ—¥ï¼ˆæœªæ¥æ—¥æœŸï¼‰
- "01.15" â†’ æ˜å¹´1æœˆ15æ—¥ï¼ˆç›¸å·®>180å¤©ï¼Œè§†ä¸ºè·¨å¹´æœªæ¥ï¼‰
```

**å…³é”®ä»£ç **:
```python
if parsed_date < reference_date:
    days_past = (reference_date - parsed_date).days
    if days_past > 180:
        # ç›¸å·®è¶…è¿‡180å¤©ï¼Œåˆ¤æ–­ä¸º"æ˜å¹´çš„æ—¥æœŸ"
        try:
            return date(reference_date.year + 1, month, day)
        except ValueError:
            return None
    else:
        # ç›¸å·®ä¸è¶…è¿‡180å¤©ï¼Œåˆ¤æ–­ä¸º"ä»Šå¹´çš„å·²å»¶æœŸæ•°æ®"
        return parsed_date
```

#### æœˆåº¦èŒƒå›´ï¼ˆç”¨äºè®¾è®¡äººå‘˜ï¼‰

**é€»è¾‘**:
- æ¯æœˆ1~19å·: ç­›é€‰å½“å¹´1æœˆ1æ—¥ ~ å½“æœˆæœ«
- æ¯æœˆ20~31å·: ç­›é€‰å½“å¹´1æœˆ1æ—¥ ~ æ¬¡æœˆæœ«

**ç›®çš„**: è®©è®¾è®¡äººå‘˜æå‰çœ‹åˆ°ä¸‹æœˆçš„æ•°æ®

### 4. å¯¼å‡ºé€»è¾‘

#### ç®€æ´æ¨¡å¼ vs å®Œæ•´æ¨¡å¼

| æ¨¡å¼ | æ¥å£å·æ˜¾ç¤º | é€‚ç”¨è§’è‰² | è§¦å‘æ¡ä»¶ |
|------|-----------|---------|---------|
| **ç®€æ´** | åªæ˜¾ç¤ºä¸ªæ•° | æ‰€é¢†å¯¼ï¼ˆè‡ªåŠ¨ï¼‰ã€ç®¡ç†å‘˜ï¼ˆæ‰‹åŠ¨ï¼‰ | `ç®€æ´æ¨¡å¼`å‹¾é€‰æ¡† æˆ– è§’è‰²ä¸ºæ‰€é¢†å¯¼ |
| **å®Œæ•´** | åˆ—å‡ºæ‰€æœ‰æ¥å£å· | å…¶ä»–æ‰€æœ‰è§’è‰² | é»˜è®¤ |

**ç¤ºä¾‹**:
```
ç®€æ´æ¨¡å¼:
  â€¢ å†…éƒ¨éœ€æ‰“å¼€æ¥å£: å…±5ä¸ª

å®Œæ•´æ¨¡å¼:
  â€¢ å†…éƒ¨éœ€æ‰“å¼€æ¥å£: å…±5ä¸ª
    INT-001, INT-002, INT-003, INT-004, INT-005
```

#### å¯¼å‡ºæ–‡ä»¶å‘½å

æ ¼å¼: `{é¡¹ç›®å·}_{ç”¨æˆ·å§“å}_{æ—¥æœŸæ—¶é—´}.txt`

ä¾‹å¦‚: `2016_å¼ ä¸‰_20251028_153045.txt`

### 5. ç¼“å­˜æœºåˆ¶

#### æ–‡ä»¶å“ˆå¸Œç¼“å­˜

**ç›®çš„**: æ£€æµ‹æ–‡ä»¶æ˜¯å¦å˜åŒ–ï¼Œé¿å…é‡å¤å¤„ç†

**å®ç°**:
```python
# file_manager.py
def generate_file_identity(self, file_path):
    """
    åŸºäº: æ–‡ä»¶å + æ–‡ä»¶å¤§å° + ä¿®æ”¹æ—¶é—´
    ç”ŸæˆMD5å“ˆå¸Œ
    """
```

**è§¦å‘æ¸…ç©º**:
- æ–‡ä»¶å†…å®¹å˜åŒ–ï¼ˆä¿®æ”¹æ—¶é—´æˆ–å¤§å°æ”¹å˜ï¼‰
- æ‰‹åŠ¨ç‚¹å‡»"åˆ·æ–°æ–‡ä»¶"

#### ç»“æœç¼“å­˜

**ç»“æ„**: `result_cache/{file_hash}_{project_id}_{file_type}.pkl`

**ç¼“å­˜å†…å®¹**: å¤„ç†åçš„DataFrameå¯¹è±¡ï¼ˆpickleåºåˆ—åŒ–ï¼‰

**ç”Ÿå‘½å‘¨æœŸ**: æ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨å¤±æ•ˆ

#### ç”¨æˆ·å‹¾é€‰çŠ¶æ€ç¼“å­˜

**ç»“æ„** (file_cache.json):
```json
{
  "file_identities": {
    "æ–‡ä»¶è·¯å¾„": "æ–‡ä»¶å“ˆå¸Œ"
  },
  "completed_rows": {
    "ç”¨æˆ·å§“å": {
      "æ–‡ä»¶è·¯å¾„": {
        "è¡Œå·": true
      }
    }
  }
}
```

**å…³é”®ç‚¹**:
- **æŒ‰ç”¨æˆ·éš”ç¦»**: å¼ ä¸‰çš„å‹¾é€‰ä¸å½±å“æå››
- **è‡ªåŠ¨è¿ç§»**: æ—§æ ¼å¼ï¼ˆæ— ç”¨æˆ·åˆ†ç»„ï¼‰è‡ªåŠ¨è¿ç§»åˆ°"é»˜è®¤ç”¨æˆ·"

---

## æ¶æ„è®¾è®¡

### æ¨¡å—èŒè´£åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              base.py (ä¸»ç¨‹åº)                â”‚
â”‚  - GUIç”Ÿå‘½å‘¨æœŸç®¡ç†                           â”‚
â”‚  - è§’è‰²æƒé™æ§åˆ¶                              â”‚
â”‚  - æ–‡ä»¶è¯»å–åè°ƒ                              â”‚
â”‚  - ç»“æœå±•ç¤ºä¸å¯¼å‡º                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚       â”‚       â”‚          â”‚          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ main.py â”‚ â”‚windowâ”‚ â”‚  file_  â”‚ â”‚  date_  â”‚ â”‚ Monitor â”‚
â”‚         â”‚ â”‚.py   â”‚ â”‚ manager â”‚ â”‚  utils  â”‚ â”‚  .py    â”‚
â”‚ Excel   â”‚ â”‚      â”‚ â”‚  .py    â”‚ â”‚  .py    â”‚ â”‚         â”‚
â”‚ æ•°æ®    â”‚ â”‚ GUI  â”‚ â”‚         â”‚ â”‚         â”‚ â”‚ æ—¥å¿—    â”‚
â”‚ å¤„ç†    â”‚ â”‚ æ˜¾ç¤º â”‚ â”‚ ç¼“å­˜    â”‚ â”‚ æ—¥æœŸ    â”‚ â”‚ ç›‘æ§    â”‚
â”‚ é€»è¾‘    â”‚ â”‚      â”‚ â”‚ ç®¡ç†    â”‚ â”‚ å·¥å…·    â”‚ â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **èŒè´£å•ä¸€**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½åŸŸ
2. **é«˜å†…èšä½è€¦åˆ**: æ¨¡å—é—´é€šè¿‡æ¸…æ™°çš„æ¥å£äº¤äº’
3. **å‘åå…¼å®¹**: ä¿ç•™æ—§ä»£ç ç»“æ„ï¼Œæ–°åŠŸèƒ½é€šè¿‡æ‰©å±•å®ç°
4. **æµ‹è¯•ä¼˜å…ˆ**: å…³é”®é€»è¾‘å¿…é¡»æœ‰æµ‹è¯•è¦†ç›–
5. **ç”¨æˆ·ä½“éªŒ**: ç•Œé¢å‹å¥½ã€æ“ä½œç®€å•ã€é”™è¯¯æç¤ºæ¸…æ™°

### å…³é”®äº¤äº’æµç¨‹

#### å¯åŠ¨æµç¨‹
```
1. åŠ è½½é…ç½® (config.json)
2. åˆå§‹åŒ–FileIdentityManager (ç¼“å­˜ç®¡ç†å™¨)
3. åˆ›å»ºTkinteræ ¹çª—å£
4. åˆ›å»ºWindowManager (ç•Œé¢ç®¡ç†)
5. è®¾ç½® window_manager.app = self (å…³é”®ï¼)
6. åŠ è½½ç”¨æˆ·é…ç½® (è§’è‰²ã€å§“å)
7. æ‰«ææ–‡ä»¶å¤¹
8. å¦‚æœæ˜¯è‡ªåŠ¨æ¨¡å¼: å¯åŠ¨å®šæ—¶ä»»åŠ¡
```

#### å¤„ç†æµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡»"å¼€å§‹ç­›é€‰" æˆ– è‡ªåŠ¨è§¦å‘
2. base.py: start_processing()
   - å¹¶å‘è¯»å–æ‰€æœ‰Excelæ–‡ä»¶ (concurrent_read_excel_files)
   - è¯†åˆ«æ–‡ä»¶ç±»å‹ (find_all_target_files1~6)
3. å¯¹æ¯ä¸ªæ–‡ä»¶+é¡¹ç›®ç»„åˆ:
   - æ£€æŸ¥ç¼“å­˜ (_process_with_cache)
   - å¦‚æœç¼“å­˜æœªå‘½ä¸­: è°ƒç”¨main.pyçš„å¤„ç†å‡½æ•°
     - process_target_file1~5 æˆ– process_target_file6
   - åº”ç”¨è§’è‰²è¿‡æ»¤ (apply_role_based_filter)
   - æ’é™¤å·²å®Œæˆé¡¹ (_exclude_completed_rows)
4. åˆå¹¶ç»“æœåˆ°6ä¸ªé€‰é¡¹å¡
5. æ˜¾ç¤ºåˆ°GUI (window.py: display_excel_data)
```

#### å¯¼å‡ºæµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡»"å¯¼å‡ºç»“æœ"
2. base.py: export_results()
3. åˆ¤æ–­ç”¨æˆ·è§’è‰²:
   - å¦‚æœæ˜¯æ‰€é¢†å¯¼: è‡ªåŠ¨ç®€æ´æ¨¡å¼
   - å¦åˆ™: è¯»å–"ç®€æ´æ¨¡å¼"å‹¾é€‰æ¡†
4. éå†6ä¸ªé€‰é¡¹å¡çš„æ•°æ®:
   - å¦‚æœç®€æ´æ¨¡å¼: åªå†™ä¸ªæ•°
   - å¦‚æœå®Œæ•´æ¨¡å¼: åˆ—å‡ºæ‰€æœ‰æ¥å£å·
5. ç”ŸæˆTXTæ–‡ä»¶
6. å¼¹çª—æç¤ºæˆ–é™é»˜å®Œæˆï¼ˆå–å†³äºé…ç½®ï¼‰
```

---

## ä»£ç ç»“æ„è¯¦è§£

### base.py (ä¸»ç¨‹åºï¼Œ4501è¡Œ)

**æ ¸å¿ƒç±»**: `ExcelProcessorApp`

**å…³é”®æ–¹æ³•**:

```python
class ExcelProcessorApp:
    def __init__(self):
        """åˆå§‹åŒ–ä¸»ç¨‹åº"""
        
    def setup_window(self):
        """è®¾ç½®çª—å£"""
        # ã€é‡è¦ã€‘åœ¨åˆ›å»ºWindowManageråå¿…é¡»è®¾ç½®appå¼•ç”¨
        self.window_manager = WindowManager(self.root, callbacks)
        self.window_manager.app = self  # â† å…³é”®è¡Œï¼
        
    def scan_folder(self):
        """æ‰«ææ–‡ä»¶å¤¹ï¼Œè¯†åˆ«æ‰€æœ‰Excelæ–‡ä»¶"""
        
    def start_processing(self):
        """å¼€å§‹å¤„ç†ï¼ˆä¸»å…¥å£ï¼‰"""
        # 1. å¹¶å‘è¯»å–Excel
        # 2. åˆ†ç±»è¯†åˆ«æ–‡ä»¶
        # 3. è°ƒç”¨å¤„ç†å‡½æ•°
        # 4. åº”ç”¨è§’è‰²è¿‡æ»¤
        # 5. æ˜¾ç¤ºç»“æœ
        
    def _process_with_cache(self, file_path, project_id, file_type, process_func, current_datetime, *args):
        """å¤„ç†å•ä¸ªæ–‡ä»¶ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        # æ£€æŸ¥ç¼“å­˜ â†’ è°ƒç”¨å¤„ç†å‡½æ•° â†’ ä¿å­˜ç¼“å­˜
        
    def apply_role_based_filter(self, df, role, user_name, file_type=None):
        """åº”ç”¨è§’è‰²è¿‡æ»¤"""
        # æ ¸å¿ƒæƒé™æ§åˆ¶é€»è¾‘
        
    def _filter_by_single_role(self, safe_df, role, user_name, file_type=None):
        """å•è§’è‰²è¿‡æ»¤é€»è¾‘"""
        # ã€é‡è¦ã€‘æ‰€é¢†å¯¼çš„2å·¥ä½œæ—¥æ—¶é—´çª—å£åœ¨è¿™é‡Œå®ç°
        
    def apply_auto_role_date_window(self, df, user_role):
        """è‡ªåŠ¨æ¨¡å¼ä¸‹åº”ç”¨è§’è‰²æ—¶é—´çª—å£ï¼ˆç”¨äºå¯¼å‡ºï¼‰"""
        # ã€é‡è¦ã€‘å®¤ä¸»ä»»çš„7å·¥ä½œæ—¥æ—¶é—´çª—å£åœ¨è¿™é‡Œå®ç°
        
    def _exclude_completed_rows(self, df, source_file):
        """æ’é™¤å·²å®Œæˆçš„è¡Œ"""
        # ã€é‡è¦ã€‘è°ƒç”¨æ—¶å¿…é¡»ä¼ å…¥user_name
        user_name = getattr(self, 'user_name', '').strip()
        completed_rows = self.file_manager.get_completed_rows(source_file, user_name)
        
    def display_excel_data_with_original_rows(self, viewer, df, label_text, excel_row_numbers):
        """æ˜¾ç¤ºæ•°æ®åˆ°Treeview"""
        # å§”æ‰˜ç»™window_manager
        
    def export_results(self):
        """å¯¼å‡ºç»“æœ"""
        # åˆ¤æ–­ç®€æ´æ¨¡å¼ â†’ ç”ŸæˆTXT â†’ ä¿å­˜æ–‡ä»¶
```

**å…³é”®é…ç½®**:
```python
# é»˜è®¤è§’è‰²å¤©æ•°é…ç½®ï¼ˆç”¨äºè‡ªåŠ¨æ¨¡å¼å’Œå¯¼å‡ºï¼‰
self.role_export_days = {
    "ä¸€å®¤ä¸»ä»»": 7,          # 7ä¸ªå·¥ä½œæ—¥
    "äºŒå®¤ä¸»ä»»": 7,          # 7ä¸ªå·¥ä½œæ—¥
    "å»ºç­‘æ€»å›¾å®¤ä¸»ä»»": 7,    # 7ä¸ªå·¥ä½œæ—¥
    "æ‰€é¢†å¯¼": 2,            # 2ä¸ªå·¥ä½œæ—¥
    "ç®¡ç†å‘˜": None,         # æ— é™åˆ¶
    "è®¾è®¡äººå‘˜": None,       # æŒ‰æœˆåº¦èŒƒå›´
}
```

### main.py (Excelå¤„ç†é€»è¾‘ï¼Œ3455è¡Œ)

**å…¨å±€å¼€å…³**:
```python
# æ—¥æœŸç­›é€‰é€»è¾‘å¼€å…³ï¼ˆå½±å“è®¾è®¡äººå‘˜çš„æœˆåº¦èŒƒå›´ï¼‰
USE_OLD_DATE_LOGIC = False  # False=æ–°é€»è¾‘ï¼ˆæ¨èï¼‰
```

**æ–‡ä»¶è¯†åˆ«å‡½æ•°**:
```python
def find_all_target_files1(excel_files):
    """è¯†åˆ«æ‰€æœ‰å¾…å¤„ç†æ–‡ä»¶1ï¼ˆIDIæ‰‹å†Œï¼‰"""
    
def find_all_target_files2(excel_files):
    """è¯†åˆ«æ‰€æœ‰å¾…å¤„ç†æ–‡ä»¶2ï¼ˆæ¥å£ç§»äº¤è¡¨ï¼‰"""
    
# ... ä¾æ­¤ç±»æ¨åˆ° find_all_target_files6
```

**æ–‡ä»¶å¤„ç†å‡½æ•°**:
```python
def process_target_file1(file_path, current_datetime):
    """å¤„ç†å¾…å¤„ç†æ–‡ä»¶1"""
    # è¿”å›: DataFrame with columns ['é¡¹ç›®å·', 'æ¥å£å·', 'æ¥å£æ—¶é—´', 'è´£ä»»äºº', ...]
    
def process_target_file6(file_path, current_datetime, skip_date_filter=False):
    """å¤„ç†å¾…å¤„ç†æ–‡ä»¶6ï¼ˆæ”¶å‘æ–‡å‡½ï¼‰"""
    # skip_date_filter: ç®¡ç†å‘˜/æ‰€é¢†å¯¼è·³è¿‡Iåˆ—æ—¶é—´ç­›é€‰
```

**æ¡ä»¶ç­›é€‰å‡½æ•°**ï¼ˆæ–‡ä»¶6ç¤ºä¾‹ï¼‰:
```python
def execute6_process1(df):
    """Våˆ—åŒ…å«'æ²³åŒ—åˆ†å…¬å¸.å»ºç­‘ç»“æ„æ‰€'"""
    
def execute6_process3(df, current_datetime):
    """Iåˆ—æ—¥æœŸ â‰¤ ä»Šå¤©+14å¤©"""
    
def execute6_process4(df):
    """Måˆ—ä¸º'å°šæœªå›å¤'æˆ–'è¶…æœŸæœªå›å¤'"""
```

### window.py (GUIæ˜¾ç¤ºï¼Œ1323è¡Œ)

**æ ¸å¿ƒç±»**: `WindowManager`

**å…³é”®å±æ€§**:
```python
self.app = None  # ã€é‡è¦ã€‘å¿…é¡»åœ¨base.pyä¸­è®¾ç½®ï¼Œç”¨äºè·å–user_name
self.viewers = {}  # 6ä¸ªé€‰é¡¹å¡çš„Treeviewå¼•ç”¨
```

**å…³é”®æ–¹æ³•**:
```python
def display_excel_data(self, viewer, df, label_text, source_file, file_manager, excel_row_numbers=None):
    """æ˜¾ç¤ºæ•°æ®åˆ°Treeviewï¼ˆä¸»æ˜¾ç¤ºé€»è¾‘ï¼‰"""
    # ã€é‡è¦ã€‘å¿…é¡»é€šè¿‡self.appè·å–user_name
    user_name = getattr(self.app, 'user_name', '').strip()
    
    # åˆ—é¡ºåº: çŠ¶æ€ | é¡¹ç›®å· | æ¥å£å· | æ¥å£æ—¶é—´ | æ˜¯å¦å·²å®Œæˆ
    
def _calculate_single_column_width(self, series, column_name, min_width=50, max_width=400):
    """è®¡ç®—å•åˆ—å®½åº¦ï¼ˆæ™ºèƒ½å¤„ç†ä¸­æ–‡å­—ç¬¦ï¼‰"""
    
def _sort_by_column(self, viewer, col, file_manager, source_file, excel_row_numbers):
    """åˆ—æ’åºï¼ˆç‚¹å‡»åˆ—å¤´è§¦å‘ï¼‰"""
    
def _generate_sort_key(self, item_values, col_index, columns):
    """ç”Ÿæˆæ’åºé”®ï¼ˆæ™ºèƒ½è¯†åˆ«æ•°æ®ç±»å‹ï¼‰"""
    # æ¥å£æ—¶é—´: ç©ºå€¼æ’æœ€å
    # é¡¹ç›®å·: æ•°å­—æ’åº
    # æ˜¯å¦å·²å®Œæˆ: â˜‘åœ¨å‰ã€â˜åœ¨å
    # çŠ¶æ€: âš ï¸åœ¨å‰
```

**å›ºå®šåˆ—å®½é…ç½®**:
```python
fixed_widths = {
    'çŠ¶æ€': 50,
    'é¡¹ç›®å·': 75,
    'æ¥å£å·': 240,
    'æ¥å£æ—¶é—´': 85,
    'æ˜¯å¦å·²å®Œæˆ': 95,
}
```

### file_manager.py (ç¼“å­˜ç®¡ç†ï¼Œ547è¡Œ)

**æ ¸å¿ƒç±»**: `FileIdentityManager`

**ç¼“å­˜ç»“æ„**:
```python
self.file_identities = {}  # {file_path: hash}
self.completed_rows = {}   # {user_name: {file_path: {row_index: True}}}
```

**å…³é”®æ–¹æ³•**:
```python
def generate_file_identity(self, file_path):
    """ç”Ÿæˆæ–‡ä»¶å“ˆå¸Œï¼ˆæ–‡ä»¶å+å¤§å°+ä¿®æ”¹æ—¶é—´ï¼‰"""
    
def set_row_completed(self, file_path, row_index, user_name, completed=True):
    """è®¾ç½®è¡Œå‹¾é€‰çŠ¶æ€ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰"""
    
def is_row_completed(self, file_path, row_index, user_name):
    """æ£€æŸ¥è¡Œæ˜¯å¦å·²å‹¾é€‰ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰"""
    
def get_completed_rows(self, file_path, user_name):
    """è·å–æŸç”¨æˆ·åœ¨æŸæ–‡ä»¶ä¸­çš„æ‰€æœ‰å‹¾é€‰è¡Œ"""
    
def has_file_changed(self, file_path):
    """æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å˜åŒ–"""
    
def get_cached_result(self, file_path, project_id, file_type):
    """è·å–ç¼“å­˜çš„å¤„ç†ç»“æœ"""
    
def save_cached_result(self, file_path, project_id, file_type, result):
    """ä¿å­˜å¤„ç†ç»“æœåˆ°ç¼“å­˜"""
```

### date_utils.py (æ—¥æœŸå·¥å…·ï¼Œ276è¡Œ)

**æ ¸å¿ƒå‡½æ•°**:
```python
def is_date_overdue(date_str: str, reference_date: Optional[date] = None) -> bool:
    """åˆ¤æ–­æ—¥æœŸæ˜¯å¦å·²å»¶æœŸï¼ˆç”¨äºçŠ¶æ€åˆ—çš„âš ï¸æ˜¾ç¤ºï¼‰"""
    
def count_workdays(start_date: date, end_date: date) -> int:
    """è®¡ç®—ä¸¤æ—¥æœŸé—´çš„å·¥ä½œæ—¥æ•°"""
    
def get_workday_difference(target_date: date, reference_date: date) -> int:
    """è®¡ç®—å·¥ä½œæ—¥å·®å¼‚ï¼ˆæ­£æ•°=æœªæ¥ï¼Œè´Ÿæ•°=å·²å»¶æœŸï¼‰"""
    
def parse_mmdd_to_date(date_str: str, reference_date: Optional[date] = None) -> Optional[date]:
    """è§£æmm.ddæ ¼å¼æ—¥æœŸï¼ˆæ™ºèƒ½å¤„ç†è·¨å¹´ï¼‰"""
    # ã€æ ¸å¿ƒã€‘180å¤©é˜ˆå€¼é€»è¾‘
    
def get_date_warn_tag(date_str: str, reference_date: Optional[date] = None, use_workdays: bool = True) -> str:
    """ç”Ÿæˆæ—¥æœŸè­¦å‘Šæ ‡ç­¾"""
    # è¿”å›: "å·²å»¶è¯¯ï¼ï¼" | "ä¸‹ç­å‰å¿…é¡»å®Œæˆ" | "æ³¨æ„æ—¶é—´" | ""
```

### Monitor.py (æ—¥å¿—ç›‘æ§ï¼Œ422è¡Œ)

**æ ¸å¿ƒç±»**: `ProcessMonitor`

**å…¨å±€å•ä¾‹**:
```python
_monitor_instance = None

def log_info(message):
    """è®°å½•ä¿¡æ¯æ—¥å¿—"""
    
def log_success(message):
    """è®°å½•æˆåŠŸæ—¥å¿—"""
    
def log_warning(message):
    """è®°å½•è­¦å‘Šæ—¥å¿—"""
    
def log_error(message):
    """è®°å½•é”™è¯¯æ—¥å¿—"""
```

**ä½¿ç”¨æ–¹å¼**:
```python
import Monitor
Monitor.log_info("å¼€å§‹å¤„ç†æ–‡ä»¶")
Monitor.log_success("å¤„ç†å®Œæˆ")
Monitor.log_error(f"å¤„ç†å¤±è´¥: {error}")
```

---

## å…³é”®æŠ€æœ¯å®ç°

### 1. å¹¶å‘è¯»å–Excelæ–‡ä»¶

**ä½ç½®**: `base.py: concurrent_read_excel_files()`

**æŠ€æœ¯**:
```python
from concurrent.futures import ThreadPoolExecutor

def concurrent_read_excel_files(file_paths, max_workers=4):
    with ThreadPoolExecutor(max_workers=max_workers) as executor:
        futures = {
            executor.submit(optimized_read_excel, fp, project_id): (fp, project_id)
            for fp, project_id in file_paths
        }
        # ...
```

**æ€§èƒ½æå‡**: å¤šæ–‡ä»¶è¯»å–é€Ÿåº¦æå‡3-4å€

### 2. ä¼˜åŒ–Excelè¯»å–

**ä½ç½®**: `base.py: optimized_read_excel()`

**æŠ€æœ¯**:
```python
from openpyxl import load_workbook

def optimized_read_excel(file_path):
    wb = load_workbook(file_path, read_only=True, data_only=True)
    ws = wb.active
    data = ws.values
    columns = next(data)
    df = pd.DataFrame(data, columns=columns)
    wb.close()
    return df
```

**æ€§èƒ½æå‡**: é€Ÿåº¦æå‡30-50%ï¼Œå†…å­˜å‡å°‘40-60%

### 3. Treeviewå‹¾é€‰æ¡†å®ç°

**ä½ç½®**: `window.py: display_excel_data()`

**æŠ€æœ¯**:
```python
# ä½¿ç”¨Unicodeå­—ç¬¦æ¨¡æ‹Ÿå‹¾é€‰æ¡†
CHECKBOX_UNCHECKED = "â˜"
CHECKBOX_CHECKED = "â˜‘"

# TreeviewåŒå‡»äº‹ä»¶
viewer.bind("<Double-1>", lambda event: self._toggle_checkbox(...))

def _toggle_checkbox(self, event, viewer, file_manager, source_file, excel_row_numbers):
    # åˆ‡æ¢å‹¾é€‰çŠ¶æ€
    # ä¿å­˜åˆ°file_managerï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰
```

### 4. æ™ºèƒ½åˆ—å®½è®¡ç®—

**ä½ç½®**: `window.py: _calculate_single_column_width()`

**æŠ€æœ¯**:
```python
def _calculate_single_column_width(self, series, column_name):
    # ä¸­æ–‡å­—ç¬¦å®½åº¦æƒé‡ * 1.8
    # è‹±æ–‡/æ•°å­—å­—ç¬¦å®½åº¦æƒé‡ * 1.0
    # è®¡ç®—æœ€å¤§å®½åº¦ï¼Œé™åˆ¶åœ¨min_width ~ max_width
```

### 5. è·¨å¹´æ—¥æœŸè§£æ

**ä½ç½®**: `date_utils.py: parse_mmdd_to_date()`

**æ ¸å¿ƒç®—æ³•**:
```python
# 180å¤©é˜ˆå€¼æ³•
if parsed_date < reference_date:
    days_past = (reference_date - reference_date).days
    if days_past > 180:
        # è§†ä¸ºæ˜å¹´
        return date(reference_date.year + 1, month, day)
    else:
        # è§†ä¸ºä»Šå¹´å·²å»¶æœŸ
        return parsed_date
```

**ç¤ºä¾‹**ï¼ˆå‡è®¾ä»Šå¤©10-28ï¼‰:
- `"09.15"` â†’ 2025-09-15ï¼ˆä»Šå¹´å·²å»¶æœŸï¼Œ43å¤©<180ï¼‰
- `"01.15"` â†’ 2026-01-15ï¼ˆæ˜å¹´æœªæ¥ï¼Œ286å¤©>180ï¼‰

### 6. ç³»ç»Ÿæ‰˜ç›˜å®ç°

**ä½ç½®**: `base.py: setup_system_tray()`

**æŠ€æœ¯**:
```python
import pystray
from PIL import Image

def setup_system_tray(self):
    icon_path = get_resource_path("ico_bin/tubiao.ico")
    image = Image.open(icon_path)
    
    menu = pystray.Menu(
        pystray.MenuItem("æ˜¾ç¤ºä¸»çª—å£", self.show_window),
        pystray.MenuItem("é€€å‡ºç¨‹åº", self.quit_app)
    )
    
    self.tray_icon = pystray.Icon("name", image, "æ¥å£ç­›é€‰", menu)
    threading.Thread(target=self.tray_icon.run, daemon=True).start()
```

### 7. å¼€æœºè‡ªå¯åŠ¨

**ä½ç½®**: `base.py: set_auto_startup()`

**æŠ€æœ¯**:
```python
import winreg

def set_auto_startup(self, enable):
    key = winreg.OpenKey(
        winreg.HKEY_CURRENT_USER,
        r"Software\Microsoft\Windows\CurrentVersion\Run",
        0, winreg.KEY_SET_VALUE
    )
    
    if enable:
        exe_path = sys.executable if getattr(sys, 'frozen', False) else sys.argv[0]
        command = f'"{exe_path}" --auto'
        winreg.SetValueEx(key, "æ¥å£ç­›é€‰ç¨‹åº", 0, winreg.REG_SZ, command)
    else:
        winreg.DeleteValue(key, "æ¥å£ç­›é€‰ç¨‹åº")
    
    winreg.CloseKey(key)
```

---

## ç¼–ç é£æ ¼è§„èŒƒ

### 1. æ–‡ä»¶å¤´éƒ¨

**æ‰€æœ‰Pythonæ–‡ä»¶å¿…é¡»åŒ…å«**:
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ¨¡å—è¯´æ˜ï¼ˆç®€æ´æè¿°æ¨¡å—èŒè´£ï¼‰
"""
```

### 2. å‘½åè§„èŒƒ

| ç±»å‹ | è§„èŒƒ | ç¤ºä¾‹ |
|------|------|------|
| **ç±»å** | PascalCaseï¼ˆå¤§é©¼å³°ï¼‰ | `ExcelProcessorApp`, `WindowManager` |
| **å‡½æ•°/æ–¹æ³•** | snake_caseï¼ˆä¸‹åˆ’çº¿ï¼‰ | `start_processing`, `apply_filter` |
| **ç§æœ‰æ–¹æ³•** | å‰ç¼€`_` | `_filter_by_single_role`, `_load_cache` |
| **å¸¸é‡** | UPPER_SNAKE_CASE | `USE_OLD_DATE_LOGIC`, `CHECKBOX_CHECKED` |
| **å˜é‡** | snake_case | `user_name`, `file_path`, `current_datetime` |

### 3. æ³¨é‡Šè§„èŒƒ

**å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²**:
```python
def process_target_file1(file_path, current_datetime):
    """
    å¤„ç†å¾…å¤„ç†æ–‡ä»¶1ï¼ˆIDIæ‰‹å†Œï¼‰
    
    å‚æ•°:
        file_path (str): Excelæ–‡ä»¶è·¯å¾„
        current_datetime (datetime): å½“å‰æ—¥æœŸæ—¶é—´
    
    è¿”å›:
        pandas.DataFrame: å¤„ç†åçš„æ•°æ®ï¼ŒåŒ…å«åˆ—ï¼š
            - é¡¹ç›®å·: 4ä½æ•°å­—å­—ç¬¦ä¸²
            - æ¥å£å·: æ¥å£ç¼–å·
            - æ¥å£æ—¶é—´: mm.ddæ ¼å¼æ—¥æœŸ
            - è´£ä»»äºº: è´£ä»»äººå§“å
            - [å…¶ä»–åŸå§‹åˆ—...]
    
    å¼‚å¸¸:
        ValueError: æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®
        FileNotFoundError: æ–‡ä»¶ä¸å­˜åœ¨
    """
```

**è¡Œå†…æ³¨é‡Š**:
```python
# ã€é‡è¦ã€‘è¿™æ˜¯å…³é”®é€»è¾‘ï¼Œä¸è¦ä¿®æ”¹
user_name = getattr(self, 'user_name', '').strip()

# åˆ¤æ–­æ˜¯å¦ä½¿ç”¨å·¥ä½œæ—¥è®¡ç®—ï¼ˆæ‰€é¢†å¯¼ã€å®¤ä¸»ä»»ä½¿ç”¨å·¥ä½œæ—¥ï¼‰
use_workdays = (user_role in ["æ‰€é¢†å¯¼", "ä¸€å®¤ä¸»ä»»", "äºŒå®¤ä¸»ä»»", "å»ºç­‘æ€»å›¾å®¤ä¸»ä»»"])
```

**æ ‡ç­¾æ³¨é‡Š**:
- `# ã€é‡è¦ã€‘`: å…³é”®é€»è¾‘ï¼Œä¿®æ”¹éœ€è°¨æ…
- `# ã€ä¿®å¤ã€‘`: Bugä¿®å¤ç›¸å…³ä»£ç 
- `# ã€ä¼˜åŒ–ã€‘`: æ€§èƒ½ä¼˜åŒ–ç›¸å…³ä»£ç 
- `# ã€ä¸´æ—¶ã€‘`: ä¸´æ—¶æ–¹æ¡ˆï¼Œæœªæ¥éœ€è¦æ”¹è¿›
- `# TODO:`: å¾…åŠäº‹é¡¹
- `# FIXME:`: å·²çŸ¥é—®é¢˜ï¼Œéœ€è¦ä¿®å¤

### 4. ä»£ç æ ¼å¼

**ç¼©è¿›**: 4ä¸ªç©ºæ ¼ï¼ˆä¸ä½¿ç”¨Tabï¼‰

**è¡Œé•¿åº¦**: å»ºè®®ä¸è¶…è¿‡100å­—ç¬¦ï¼Œç¡¬é™åˆ¶120å­—ç¬¦

**ç©ºè¡Œ**:
```python
# ç±»å®šä¹‰å‰å2ä¸ªç©ºè¡Œ
class MyClass:
    pass


# å‡½æ•°å®šä¹‰å‰å2ä¸ªç©ºè¡Œ
def my_function():
    pass


# ç±»å†…æ–¹æ³•ä¹‹é—´1ä¸ªç©ºè¡Œ
class MyClass:
    def method1(self):
        pass
    
    def method2(self):
        pass
```

**å¯¼å…¥é¡ºåº**:
```python
# 1. æ ‡å‡†åº“
import os
import sys
from datetime import date, timedelta

# 2. ç¬¬ä¸‰æ–¹åº“
import pandas as pd
import numpy as np
from openpyxl import load_workbook

# 3. æœ¬åœ°æ¨¡å—
from window import WindowManager
from date_utils import parse_mmdd_to_date
```

### 5. é”™è¯¯å¤„ç†

**æ˜ç¡®æ•è·å¼‚å¸¸**:
```python
# âœ… æ¨è
try:
    df = pd.read_excel(file_path)
except FileNotFoundError:
    Monitor.log_error(f"æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")
    return None
except pd.errors.ParserError:
    Monitor.log_error(f"æ–‡ä»¶æ ¼å¼é”™è¯¯: {file_path}")
    return None

# âŒ é¿å…
try:
    df = pd.read_excel(file_path)
except:
    return None
```

**è®°å½•æ—¥å¿—**:
```python
try:
    result = process_file(file_path)
    Monitor.log_success(f"å¤„ç†æˆåŠŸ: {file_path}")
    return result
except Exception as e:
    Monitor.log_error(f"å¤„ç†å¤±è´¥: {file_path}, é”™è¯¯: {str(e)}")
    raise
```

### 6. å˜é‡å‘½åçº¦å®š

**DataFrame**: ä½¿ç”¨ `df` å‰ç¼€
```python
df_file1 = process_target_file1(...)
df_filtered = apply_filter(df_file1)
```

**å¸ƒå°”å˜é‡**: ä½¿ç”¨ `is_`, `has_`, `should_` å‰ç¼€
```python
is_admin = "ç®¡ç†å‘˜" in user_roles
has_changed = file_manager.has_file_changed(file_path)
should_skip = skip_date_filter
```

**Tkinterå˜é‡**: ä½¿ç”¨ `_var` åç¼€
```python
self.path_var = tk.StringVar()
self.process_tab1_var = tk.BooleanVar()
```

---

## æµ‹è¯•ç­–ç•¥

### æµ‹è¯•æ¡†æ¶

ä½¿ç”¨ **pytest** è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚

### æµ‹è¯•æ–‡ä»¶ç»„ç»‡

```
tests/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ conftest.py                      # pytesté…ç½®å’Œfixture
â”œâ”€â”€ test_date_utils.py               # æ—¥æœŸå·¥å…·æµ‹è¯•
â”œâ”€â”€ test_file_manager.py             # ç¼“å­˜ç®¡ç†æµ‹è¯•
â”œâ”€â”€ test_institute_leader.py         # æ‰€é¢†å¯¼è§’è‰²æµ‹è¯•
â”œâ”€â”€ test_admin_file6_logic.py        # ç®¡ç†å‘˜æ–‡ä»¶6é€»è¾‘æµ‹è¯•
â”œâ”€â”€ test_cross_year_date_parsing.py  # è·¨å¹´æ—¥æœŸè§£ææµ‹è¯•
â”œâ”€â”€ test_user_checkbox_isolation.py  # ç”¨æˆ·å‹¾é€‰éš”ç¦»æµ‹è¯•
â”œâ”€â”€ test_interface_time_display.py   # æ¥å£æ—¶é—´åˆ—æ˜¾ç¤ºæµ‹è¯•
â”œâ”€â”€ test_leader_display_filter.py    # æ‰€é¢†å¯¼æ˜¾ç¤ºè¿‡æ»¤æµ‹è¯•
â”œâ”€â”€ test_file6_logic.py              # æ–‡ä»¶6å¤„ç†é€»è¾‘æµ‹è¯•
â”œâ”€â”€ test_multi_role.py               # å¤šè§’è‰²æµ‹è¯•
â””â”€â”€ ... (å…¶ä»–æµ‹è¯•æ–‡ä»¶)
```

### æµ‹è¯•å‘½åè§„èŒƒ

**æµ‹è¯•ç±»**: `Test{åŠŸèƒ½åç§°}`
```python
class TestInstituteLeader:
    """æ‰€é¢†å¯¼åŠŸèƒ½æµ‹è¯•"""
```

**æµ‹è¯•æ–¹æ³•**: `test_{å…·ä½“æµ‹è¯•åœºæ™¯}`
```python
def test_institute_leader_sees_all_departments(self):
    """æ‰€é¢†å¯¼åº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰ç§‘å®¤çš„æ•°æ®"""
    
def test_institute_leader_uses_workday_calculation(self):
    """æ‰€é¢†å¯¼åº”è¯¥ä½¿ç”¨å·¥ä½œæ—¥è®¡ç®—"""
```

### å…³é”®æµ‹è¯•ç”¨ä¾‹

#### 1. æ—¥æœŸå·¥å…·æµ‹è¯•
```python
# tests/test_date_utils.py
def test_workday_difference_exclude_weekends():
    """æµ‹è¯•å·¥ä½œæ—¥è®¡ç®—æ’é™¤å‘¨æœ«"""
    # 2025-10-27(å‘¨ä¸€) åˆ° 2025-10-31(å‘¨äº”) = 5ä¸ªå·¥ä½œæ—¥
    
def test_parse_mmdd_handles_cross_year():
    """æµ‹è¯•è·¨å¹´æ—¥æœŸè§£æ"""
    # 10-28æ—¶, "01.15" åº”è§£æä¸ºæ˜å¹´
    # 10-28æ—¶, "09.15" åº”è§£æä¸ºä»Šå¹´ï¼ˆå·²å»¶æœŸï¼‰
```

#### 2. è§’è‰²æƒé™æµ‹è¯•
```python
# tests/test_institute_leader.py
def test_institute_leader_2_workday_window():
    """æ‰€é¢†å¯¼åº”è¯¥åªçœ‹åˆ°2ä¸ªå·¥ä½œæ—¥å†…çš„æ•°æ®"""
    
def test_director_7_workday_window():
    """å®¤ä¸»ä»»åº”è¯¥åªçœ‹åˆ°7ä¸ªå·¥ä½œæ—¥å†…çš„æ•°æ®"""
```

#### 3. ç¼“å­˜éš”ç¦»æµ‹è¯•
```python
# tests/test_user_checkbox_isolation.py
def test_user_checkbox_isolation():
    """æµ‹è¯•ç”¨æˆ·å‹¾é€‰çŠ¶æ€éš”ç¦»"""
    # ç”¨æˆ·Açš„å‹¾é€‰ä¸åº”å½±å“ç”¨æˆ·B
```

#### 4. æ–‡ä»¶å¤„ç†æµ‹è¯•
```python
# tests/test_file6_logic.py
def test_file6_includes_past_dates():
    """æ–‡ä»¶6åº”åŒ…å«è¿‡å»çš„æ—¥æœŸ"""
    
def test_admin_skips_date_filter_for_file6():
    """ç®¡ç†å‘˜å¤„ç†æ–‡ä»¶6æ—¶åº”è·³è¿‡æ—¥æœŸç­›é€‰"""
```

### è¿è¡Œæµ‹è¯•

**è¿è¡Œæ‰€æœ‰æµ‹è¯•**:
```bash
pytest
```

**è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶**:
```bash
pytest tests/test_date_utils.py -v
```

**è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•**:
```bash
pytest tests/test_date_utils.py::test_workday_difference_exclude_weekends -v
```

**æŸ¥çœ‹è¦†ç›–ç‡**:
```bash
pytest --cov=. --cov-report=html
```

### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- **æ ¸å¿ƒé€»è¾‘**: > 90%
- **å·¥å…·å‡½æ•°**: 100%
- **GUIä»£ç **: > 60% (éš¾ä»¥æµ‹è¯•ï¼Œé‡ç‚¹æµ‹è¯•ä¸šåŠ¡é€»è¾‘)

---

## é‡è¦å†å²å†³ç­–

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨Tkinterè€Œä¸æ˜¯PyQtï¼Ÿ

**åŸå› **:
- **å…¼å®¹æ€§**: Tkinteræ˜¯Pythonæ ‡å‡†åº“ï¼Œæ— éœ€é¢å¤–å®‰è£…
- **è½»é‡çº§**: æ‰“åŒ…åä½“ç§¯æ›´å°ï¼ˆçº¦150MB vs PyQtçš„300MB+ï¼‰
- **Win7æ”¯æŒ**: PyQt5åœ¨Win7ä¸Šå…¼å®¹æ€§å·®
- **å­¦ä¹ æ›²çº¿**: å›¢é˜Ÿæ›´ç†Ÿæ‚‰Tkinter

**æƒè¡¡**: Tkinterç•Œé¢è¾ƒä¸ºç®€é™‹ï¼Œä½†æ»¡è¶³ä¸šåŠ¡éœ€æ±‚

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨pickleç¼“å­˜è€Œä¸æ˜¯JSONï¼Ÿ

**åŸå› **:
- **æ€§èƒ½**: pickleåºåˆ—åŒ–DataFrameæ¯”JSONå¿«10å€+
- **å®Œæ•´æ€§**: pickleä¿ç•™DataFrameçš„æ‰€æœ‰å…ƒæ•°æ®ï¼ˆdtypes, indexç­‰ï¼‰
- **ç®€æ´**: æ— éœ€è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘

**æƒè¡¡**: pickleä¸å¯è¯»ï¼Œä½†ç¼“å­˜æ–‡ä»¶æœ¬æ¥å°±ä¸éœ€è¦äººå·¥æŸ¥çœ‹

### 3. ä¸ºä»€ä¹ˆ180å¤©ä½œä¸ºè·¨å¹´æ—¥æœŸåˆ¤æ–­é˜ˆå€¼ï¼Ÿ

**å†³ç­–è¿‡ç¨‹**:
- æœ€åˆå°è¯•90å¤©: 7-8æœˆä»½çš„å»¶æœŸæ•°æ®è¢«é”™è¯¯è¯†åˆ«ä¸ºæ˜å¹´
- æ”¹ä¸º120å¤©: 6æœˆä»½çš„å»¶æœŸæ•°æ®ä»æœ‰é—®é¢˜
- æœ€ç»ˆå®šä¸º180å¤©ï¼ˆ6ä¸ªæœˆï¼‰: 
  - è¦†ç›–åŠå¹´å†…çš„å»¶æœŸæ•°æ®
  - åˆç†åŒºåˆ†"å·²å»¶æœŸ"vs"æ˜å¹´æœªæ¥"
  - å®é™…æµ‹è¯•è¡¨ç°è‰¯å¥½

### 4. ä¸ºä»€ä¹ˆæ‰€é¢†å¯¼å’Œç®¡ç†å‘˜åœ¨æ–‡ä»¶6æ— æ—¶é—´é™åˆ¶ï¼Ÿ

**ä¸šåŠ¡éœ€æ±‚**:
- **æ‰€é¢†å¯¼**: éœ€è¦å…¨å±€è§†è§’ï¼ŒæŸ¥çœ‹æ‰€æœ‰å†å²é—ç•™é—®é¢˜
- **ç®¡ç†å‘˜**: è´Ÿè´£æ•°æ®ç»´æŠ¤ï¼Œéœ€è¦çœ‹åˆ°æ‰€æœ‰æ•°æ®
- **å…¶ä»–è§’è‰²**: åªéœ€å…³æ³¨è¿‘æœŸä»»åŠ¡ï¼Œé¿å…ä¿¡æ¯è¿‡è½½

### 5. ä¸ºä»€ä¹ˆä½¿ç”¨æ–‡ä»¶å“ˆå¸Œè€Œä¸æ˜¯æ–‡ä»¶è·¯å¾„ä½œä¸ºç¼“å­˜é”®ï¼Ÿ

**åŸå› **:
- **å‡†ç¡®æ€§**: æ–‡ä»¶å†…å®¹å˜åŒ–æ—¶è‡ªåŠ¨å¤±æ•ˆç¼“å­˜
- **å®‰å…¨æ€§**: é¿å…ç¼“å­˜æ±¡æŸ“ï¼ˆæ–‡ä»¶è¦†ç›–åä»ç”¨æ—§ç¼“å­˜ï¼‰
- **çµæ´»æ€§**: æ”¯æŒæ–‡ä»¶ç§»åŠ¨ã€é‡å‘½å

**å®ç°**: `æ–‡ä»¶å + æ–‡ä»¶å¤§å° + ä¿®æ”¹æ—¶é—´` çš„MD5å“ˆå¸Œ

### 6. ä¸ºä»€ä¹ˆå‹¾é€‰çŠ¶æ€æŒ‰ç”¨æˆ·éš”ç¦»ï¼Ÿ

**é—®é¢˜å‘ç°**: 2025-10-30ç”¨æˆ·åé¦ˆåˆ‡æ¢ç”¨æˆ·åå‹¾é€‰çŠ¶æ€æœªæ¸…ç©º

**åŸå› **: å¤šäººå…±ç”¨åŒä¸€å°ç”µè„‘ï¼Œå‹¾é€‰çŠ¶æ€åº”è¯¥ç‹¬ç«‹

**è§£å†³æ–¹æ¡ˆ**: ç¼“å­˜ç»“æ„æ”¹ä¸º `{user_name: {file: {row: True}}}`

**å…¼å®¹æ€§**: è‡ªåŠ¨è¿ç§»æ—§æ•°æ®åˆ°"é»˜è®¤ç”¨æˆ·"

### 7. ä¸ºä»€ä¹ˆå¹¶å‘è¯»å–Excelï¼Ÿ

**æ€§èƒ½é—®é¢˜**: 
- å•æ–‡ä»¶è¯»å–: 0.5-2ç§’
- 10ä¸ªæ–‡ä»¶é¡ºåºè¯»å–: 5-20ç§’ï¼ˆç”¨æˆ·ä½“éªŒå·®ï¼‰

**è§£å†³æ–¹æ¡ˆ**: ThreadPoolExecutorå¹¶å‘è¯»å–ï¼ˆ4çº¿ç¨‹ï¼‰

**æ•ˆæœ**: 10ä¸ªæ–‡ä»¶è¯»å–æ—¶é—´é™ä½åˆ°2-5ç§’

### 8. ä¸ºä»€ä¹ˆ"æ¥å£æ—¶é—´"åˆ—æ”¾åœ¨"æ¥å£å·"ä¹‹åï¼Ÿ

**UIè®¾è®¡è€ƒè™‘**:
- **é€»è¾‘é¡ºåº**: çŠ¶æ€ â†’ é¡¹ç›®å· â†’ æ¥å£å· â†’ æ—¶é—´ â†’ å®ŒæˆçŠ¶æ€
- **è§†è§‰å¹³è¡¡**: å›ºå®šå®½åº¦åˆ—åœ¨å‰ï¼ŒåŠ¨æ€å®½åº¦åˆ—åœ¨å
- **ç”¨æˆ·ä¹ æƒ¯**: æ—¶é—´ä¿¡æ¯é€šå¸¸åœ¨å³ä¾§

---

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: ç¨‹åºå¯åŠ¨æŠ¥é”™ `AttributeError: 'WindowManager' object has no attribute 'app'`

**åŸå› **: å¿˜è®°è®¾ç½® `window_manager.app = self`

**è§£å†³**:
```python
# base.py: setup_window()
self.window_manager = WindowManager(self.root, callbacks)
self.window_manager.app = self  # â† å¿…é¡»æ·»åŠ è¿™è¡Œï¼
self.window_manager.setup(config_data, process_vars, project_vars)
```

### é—®é¢˜2: æ–‡ä»¶6æ²¡æœ‰æ•°æ®æ˜¾ç¤º

**å¯èƒ½åŸå› **:
1. Våˆ—ä¸åŒ…å«"æ²³åŒ—åˆ†å…¬å¸.å»ºç­‘ç»“æ„æ‰€"
2. Måˆ—ä¸æ˜¯"å°šæœªå›å¤"æˆ–"è¶…æœŸæœªå›å¤"
3. Iåˆ—æ—¥æœŸè¶…è¿‡ä»Šå¤©+14å¤©ï¼ˆéç®¡ç†å‘˜/æ‰€é¢†å¯¼ï¼‰

**è°ƒè¯•æ–¹æ³•**:
```python
# åœ¨main.pyä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
Monitor.log_info(f"æ–‡ä»¶6å¤„ç†1(Våˆ—æœºæ„åŒ¹é…): {len(p1)} è¡Œ")
Monitor.log_info(f"æ–‡ä»¶6å¤„ç†3(Iåˆ—æœªæ¥14å¤©å†…): {len(p3)} è¡Œ")
Monitor.log_info(f"æ–‡ä»¶6å¤„ç†4(Måˆ—=å°šæœªå›å¤æˆ–è¶…æœŸæœªå›å¤): {len(p4)} è¡Œ")
Monitor.log_info(f"æœ€ç»ˆç»“æœ: {len(final_rows)} è¡Œ")
```

### é—®é¢˜3: è·¨å¹´æ—¥æœŸè§£æé”™è¯¯

**ç—‡çŠ¶**: 1æœˆä»½çš„æ•°æ®åœ¨10æœˆä»½æ—¶è¢«å½“ä½œä»Šå¹´å·²å»¶æœŸ

**åŸå› **: 180å¤©é˜ˆå€¼é€»è¾‘é—®é¢˜

**æ£€æŸ¥**:
```python
from date_utils import parse_mmdd_to_date
from datetime import date

ref_date = date(2025, 10, 28)
parsed = parse_mmdd_to_date("01.15", ref_date)
print(parsed)  # åº”è¯¥æ˜¯ 2026-01-15
```

**ä¿®å¤**: ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ `parse_mmdd_to_date` å‡½æ•°

### é—®é¢˜4: ç¼“å­˜æœªå¤±æ•ˆ

**ç—‡çŠ¶**: ä¿®æ”¹äº†Excelæ–‡ä»¶ï¼Œä½†ç¨‹åºæ˜¾ç¤ºçš„æ˜¯æ—§æ•°æ®

**åŸå› **: 
1. åªä¿®æ”¹äº†å†…å®¹ï¼Œæœªä¿å­˜ï¼ˆä¿®æ”¹æ—¶é—´æœªå˜ï¼‰
2. ç¼“å­˜æ–‡ä»¶æŸå

**è§£å†³**:
```python
# æ‰‹åŠ¨æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
file_manager.clear_all_cache()

# æˆ–åˆ é™¤ç¼“å­˜æ–‡ä»¶
import os
os.remove("file_cache.json")
# åˆ é™¤result_cacheç›®å½•ä¸‹çš„æ‰€æœ‰.pklæ–‡ä»¶
```

### é—®é¢˜5: å‹¾é€‰æ¡†çŠ¶æ€æ··ä¹±

**ç—‡çŠ¶**: ç”¨æˆ·Açš„å‹¾é€‰å‡ºç°åœ¨ç”¨æˆ·Bçš„ç•Œé¢ä¸Š

**åŸå› **: ç‰ˆæœ¬è¾ƒæ—§ï¼Œæœªå®ç°ç”¨æˆ·éš”ç¦»

**è§£å†³**: æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆ2025-10-30åï¼‰ï¼ŒåŒ…å«ç”¨æˆ·éš”ç¦»åŠŸèƒ½

### é—®é¢˜6: å·¥ä½œæ—¥è®¡ç®—é”™è¯¯

**ç—‡çŠ¶**: å‘¨ä¸€åˆ°å‘¨äº”ç®—å‡ºçš„å·¥ä½œæ—¥æ•°ä¸æ˜¯5

**æ£€æŸ¥**:
```python
from date_utils import get_workday_difference
from datetime import date

# å‘¨ä¸€åˆ°å‘¨äº”
start = date(2025, 10, 27)  # å‘¨ä¸€
end = date(2025, 10, 31)    # å‘¨äº”
diff = get_workday_difference(end, start)
print(diff)  # åº”è¯¥æ˜¯ 4ï¼ˆä¸åŒ…å«èµ·å§‹æ—¥ï¼‰

# å¦‚æœåŒ…å«èµ·å§‹æ—¥ï¼Œä½¿ç”¨count_workdays
from date_utils import count_workdays
count = count_workdays(start, end)
print(count)  # åº”è¯¥æ˜¯ 5
```

### é—®é¢˜7: å¯¼å‡ºTXTæ–‡ä»¶ä¸ºç©º

**å¯èƒ½åŸå› **:
1. æ‰€æœ‰é€‰é¡¹å¡éƒ½æ²¡æœ‰å‹¾é€‰
2. æ•°æ®è¢«è§’è‰²è¿‡æ»¤æ‰äº†
3. æ‰€æœ‰æ•°æ®è¢«æ ‡è®°ä¸º"å·²å®Œæˆ"

**è°ƒè¯•**:
```python
# æ£€æŸ¥æ¯ä¸ªé€‰é¡¹å¡çš„æ•°æ®
for i in range(1, 7):
    tab_viewer = self.window_manager.viewers[f'tab{i}']
    row_count = len(tab_viewer.get_children())
    Monitor.log_info(f"é€‰é¡¹å¡{i}æ•°æ®è¡Œæ•°: {row_count}")
```

### é—®é¢˜8: ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡ä¸æ˜¾ç¤º

**åŸå› **: æœªå®‰è£…pystrayæˆ–PIL

**è§£å†³**:
```bash
pip install pystray==0.19.4
pip install Pillow==8.4.0
```

**éªŒè¯**:
```python
try:
    import pystray
    from PIL import Image
    print("ç³»ç»Ÿæ‰˜ç›˜åŠŸèƒ½å¯ç”¨")
except ImportError as e:
    print(f"ç³»ç»Ÿæ‰˜ç›˜åŠŸèƒ½ä¸å¯ç”¨: {e}")
```

---

## å¼€å‘ç¯å¢ƒé…ç½®

### 1. Pythonç¯å¢ƒ

**ç‰ˆæœ¬**: Python 3.8.x (å…¼å®¹Win7+)

**å®‰è£…**:
```bash
# ä¸‹è½½Python 3.8.10ï¼ˆæœ€åä¸€ä¸ªæ”¯æŒWin7çš„ç‰ˆæœ¬ï¼‰
https://www.python.org/downloads/release/python-3810/

# å®‰è£…æ—¶å‹¾é€‰ "Add Python to PATH"
```

### 2. ä¾èµ–å®‰è£…

**ç”Ÿäº§ç¯å¢ƒä¾èµ–**:
```bash
pip install -r requirements.txt
```

**å¼€å‘ç¯å¢ƒä¾èµ–**:
```bash
pip install -r requirements-dev.txt
```

**requirements.txt å†…å®¹**:
```
pandas==1.1.5
numpy==1.19.5
openpyxl==3.0.10
xlrd==1.2.0
pystray==0.19.4
Pillow==8.4.0
```

**requirements-dev.txt å†…å®¹**:
```
# æµ‹è¯•
pytest==7.1.3
pytest-cov==4.0.0

# ä»£ç è´¨é‡
flake8==5.0.4
black==22.10.0

# æ‰“åŒ…
pyinstaller==4.10
```

### 3. IDEé…ç½®ï¼ˆPyCharmæ¨èï¼‰

**é¡¹ç›®ç»“æ„**:
```
PythonProject3/
â”œâ”€â”€ .venv/              # è™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ tests/              # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ base.py             # ä¸»ç¨‹åº
â”œâ”€â”€ main.py             # å¤„ç†é€»è¾‘
â”œâ”€â”€ window.py           # GUI
â”œâ”€â”€ file_manager.py     # ç¼“å­˜
â”œâ”€â”€ date_utils.py       # æ—¥æœŸå·¥å…·
â”œâ”€â”€ Monitor.py          # æ—¥å¿—
â”œâ”€â”€ config.json         # é…ç½®
â”œâ”€â”€ requirements.txt
â””â”€â”€ excel_processor.spec  # æ‰“åŒ…é…ç½®
```

**è¿è¡Œé…ç½®**:
```
Script path: base.py
Parameters: (ç•™ç©º) æˆ– --auto (è‡ªåŠ¨æ¨¡å¼)
Working directory: é¡¹ç›®æ ¹ç›®å½•
```

### 4. æ‰“åŒ…ä¸ºEXE

**å‘½ä»¤**:
```bash
pyinstaller -y excel_processor.spec
```

**excel_processor.spec å…³é”®é…ç½®**:
```python
a = Analysis(
    ['base.py'],
    pathex=[],
    binaries=[],
    datas=[
        ('ico_bin', 'ico_bin'),
        ('excel_bin', 'excel_bin'),
        ('config.json', '.'),
    ],
    hiddenimports=[
        'pandas',
        'numpy',
        'openpyxl',
        'pystray',
        'PIL',
    ],
    # ...
)
```

**è¾“å‡ºä½ç½®**: `dist/æ¥å£ç­›é€‰/æ¥å£ç­›é€‰.exe`

### 5. Gité…ç½®

**.gitignore**:
```
# Python
__pycache__/
*.py[cod]
*.so
.Python
.venv/

# IDE
.idea/
.vscode/
*.swp

# é¡¹ç›®ç‰¹å®š
file_cache.json
result_cache/
dist/
build/
*.spec (å¦‚æœä¸æƒ³å…±äº«æ‰“åŒ…é…ç½®)

# æµ‹è¯•
.pytest_cache/
.coverage
htmlcov/

# æ—¥å¿—
*.log
```

---

## å¿«é€Ÿä¸Šæ‰‹æŒ‡å—ï¼ˆç»™æ–°AIï¼‰

### ç†è§£é¡¹ç›®çš„5ä¸ªæ­¥éª¤

1. **é˜…è¯»æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ç« èŠ‚** (5åˆ†é’Ÿ)
   - ç†è§£5ç§è§’è‰²çš„æƒé™å·®å¼‚
   - ç†è§£6ç±»æ–‡ä»¶çš„å¤„ç†é€»è¾‘
   - ç†è§£æ—¶é—´çª—å£çš„è®¡ç®—è§„åˆ™

2. **æŸ¥çœ‹æ¶æ„è®¾è®¡å’Œæ¨¡å—èŒè´£** (10åˆ†é’Ÿ)
   - æ˜ç¡®æ¯ä¸ªæ–‡ä»¶çš„èŒè´£
   - ç†è§£æ¨¡å—é—´çš„äº¤äº’æµç¨‹
   - è®°ä½å…³é”®çš„è®¾è®¡åŸåˆ™

3. **æµè§ˆä»£ç ç»“æ„è¯¦è§£** (20åˆ†é’Ÿ)
   - å¿«é€Ÿæµè§ˆæ¯ä¸ªæ ¸å¿ƒç±»å’Œæ–¹æ³•
   - é‡ç‚¹å…³æ³¨æ ‡è®°ä¸ºã€é‡è¦ã€‘çš„ä»£ç 
   - ç†è§£ç¼“å­˜æœºåˆ¶å’Œç”¨æˆ·éš”ç¦»

4. **å­¦ä¹ ç¼–ç é£æ ¼è§„èŒƒ** (10åˆ†é’Ÿ)
   - ç†Ÿæ‚‰å‘½åè§„èŒƒ
   - äº†è§£æ³¨é‡Šé£æ ¼
   - æŒæ¡é”™è¯¯å¤„ç†æ¨¡å¼

5. **è¿è¡Œæµ‹è¯•éªŒè¯ç†è§£** (15åˆ†é’Ÿ)
   ```bash
   # è¿è¡Œæ‰€æœ‰æµ‹è¯•
   pytest -v
   
   # è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
   pytest tests/test_date_utils.py -v
   ```

### æ¥æ‰‹é¡¹ç›®çš„æ£€æŸ¥æ¸…å•

- [ ] å·²é˜…è¯»å®Œæ•´æ–‡æ¡£
- [ ] å·²é…ç½®å¼€å‘ç¯å¢ƒ
- [ ] å·²è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå…¨éƒ¨é€šè¿‡ï¼‰
- [ ] å·²ç†è§£5ç§è§’è‰²çš„å·®å¼‚
- [ ] å·²ç†è§£6ç±»æ–‡ä»¶çš„å¤„ç†é€»è¾‘
- [ ] å·²ç†è§£è·¨å¹´æ—¥æœŸè§£æï¼ˆ180å¤©é˜ˆå€¼ï¼‰
- [ ] å·²ç†è§£ç”¨æˆ·å‹¾é€‰çŠ¶æ€éš”ç¦»
- [ ] å·²ç†è§£ç¼“å­˜æœºåˆ¶
- [ ] å·²çŸ¥é“ `window_manager.app = self` çš„é‡è¦æ€§
- [ ] å·²äº†è§£å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹ä»£ç å‰å¿…è¯»

1. **è¿è¡Œæµ‹è¯•**: ç¡®ä¿ç°æœ‰æµ‹è¯•å…¨éƒ¨é€šè¿‡
2. **ç†è§£å½±å“èŒƒå›´**: ç¡®è®¤ä¿®æ”¹ä¼šå½±å“å“ªäº›è§’è‰²/æ–‡ä»¶
3. **æ·»åŠ æµ‹è¯•**: ä¸ºæ–°åŠŸèƒ½ç¼–å†™æµ‹è¯•ç”¨ä¾‹
4. **éµå¾ªé£æ ¼**: ä¿æŒä¸ç°æœ‰ä»£ç ä¸€è‡´çš„é£æ ¼
5. **æ·»åŠ æ³¨é‡Š**: å…³é”®é€»è¾‘å¿…é¡»æ³¨é‡Šè¯´æ˜
6. **è®°å½•æ—¥å¿—**: ä½¿ç”¨ `Monitor.log_*()` è®°å½•å…³é”®æ“ä½œ
7. **éªŒè¯æµ‹è¯•**: ä¿®æ”¹åè¿è¡Œæ‰€æœ‰æµ‹è¯•
8. **æ‰‹åŠ¨æµ‹è¯•**: åœ¨GUIä¸­éªŒè¯ä¿®æ”¹æ•ˆæœ
9. **æ›´æ–°æ–‡æ¡£**: å¦‚æœæœ‰é‡å¤§ä¿®æ”¹ï¼Œæ›´æ–°æ­¤æ–‡æ¡£

### å¸¸è§ä¿®æ”¹åœºæ™¯

**åœºæ™¯1: æ·»åŠ æ–°è§’è‰²**
```python
# 1. åœ¨base.pyçš„è§’è‰²é…ç½®ä¸­æ·»åŠ 
self.role_export_days["æ–°è§’è‰²"] = 5  # 5ä¸ªå·¥ä½œæ—¥

# 2. åœ¨_filter_by_single_roleä¸­æ·»åŠ é€»è¾‘
if role == 'æ–°è§’è‰²':
    # ç­›é€‰é€»è¾‘
    pass

# 3. æ·»åŠ æµ‹è¯•
# tests/test_new_role.py
def test_new_role_filter():
    # ...
```

**åœºæ™¯2: ä¿®æ”¹æ—¶é—´çª—å£**
```python
# ä¿®æ”¹ base.py çš„ role_export_days é…ç½®
self.role_export_days = {
    "ä¸€å®¤ä¸»ä»»": 10,  # ä»7æ”¹ä¸º10
    # ...
}

# ç›¸åº”åœ°ä¿®æ”¹æµ‹è¯•
def test_director_10_workday_window():
    # ...
```

**åœºæ™¯3: æ·»åŠ æ–°æ–‡ä»¶ç±»å‹**
```python
# 1. main.py: æ·»åŠ è¯†åˆ«å‡½æ•°
def find_all_target_files7(excel_files):
    """è¯†åˆ«å¾…å¤„ç†æ–‡ä»¶7"""
    pass

# 2. main.py: æ·»åŠ å¤„ç†å‡½æ•°
def process_target_file7(file_path, current_datetime):
    """å¤„ç†å¾…å¤„ç†æ–‡ä»¶7"""
    pass

# 3. base.py: åœ¨start_processingä¸­è°ƒç”¨
file7_list = main.find_all_target_files7(df_dict)
# å¤„ç†é€»è¾‘...

# 4. window.py: æ·»åŠ ç¬¬7ä¸ªé€‰é¡¹å¡
# ...

# 5. æ·»åŠ æµ‹è¯•
# tests/test_file7_logic.py
```

---

## é™„å½•

### A. é…ç½®æ–‡ä»¶æ ¼å¼

**config.json**:
```json
{
  "folder_path": "D:/Programs/ç­›é€‰ç¨‹åº/ç®€æ˜“æµ‹è¯•æ–‡ä»¶",
  "auto_startup": false,
  "minimize_to_tray": true,
  "dont_ask_again": false
}
```

### B. ç¼“å­˜æ–‡ä»¶æ ¼å¼

**file_cache.json**:
```json
{
  "file_identities": {
    "D:/path/to/file.xlsx": "abc123def456..."
  },
  "completed_rows": {
    "å¼ ä¸‰": {
      "D:/path/to/file.xlsx": {
        "5": true,
        "12": true
      }
    },
    "æå››": {
      "D:/path/to/file.xlsx": {
        "8": true
      }
    }
  }
}
```

### C. å¯¼å‡ºTXTæ ¼å¼

**å®Œæ•´æ¨¡å¼**:
```
æ¥å£ç­›é€‰ç»“æœæŠ¥å‘Š
================

å¤„ç†æ—¶é—´: 2025-10-28 15:30:45
ç”¨æˆ·: å¼ ä¸‰
è§’è‰²: ä¸€å®¤ä¸»ä»»

ä¸€ã€å†…éƒ¨éœ€æ‰“å¼€æ¥å£ (å…±5ä¸ª):
  INT-001, INT-002, INT-003, INT-004, INT-005

äºŒã€å†…éƒ¨éœ€å›å¤æ¥å£ (å…±3ä¸ª):
  REPLY-001, REPLY-002, REPLY-003

...
```

**ç®€æ´æ¨¡å¼**:
```
æ¥å£ç­›é€‰ç»“æœæŠ¥å‘Š
================

å¤„ç†æ—¶é—´: 2025-10-28 15:30:45
ç”¨æˆ·: æ‰€é¢†å¯¼
è§’è‰²: æ‰€é¢†å¯¼

ä¸€ã€å†…éƒ¨éœ€æ‰“å¼€æ¥å£: å…±5ä¸ª

äºŒã€å†…éƒ¨éœ€å›å¤æ¥å£: å…±3ä¸ª

...
```

### D. å…³é”®å¿«æ·é”®

- **F5**: åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
- **Ctrl+S**: å¼€å§‹ç­›é€‰ï¼ˆå¦‚æœç„¦ç‚¹åœ¨ä¸»çª—å£ï¼‰
- **Ctrl+E**: å¯¼å‡ºç»“æœï¼ˆå¦‚æœç„¦ç‚¹åœ¨ä¸»çª—å£ï¼‰
- **åŒå‡»Treeviewè¡Œ**: åˆ‡æ¢å‹¾é€‰æ¡†çŠ¶æ€
- **ç‚¹å‡»åˆ—å¤´**: åˆ—æ’åºï¼ˆå‡åº/é™åºåˆ‡æ¢ï¼‰

### E. æ€§èƒ½åŸºå‡†

**æµ‹è¯•ç¯å¢ƒ**: Win10, i5-8250U, 8GB RAM, SSD

| æ“ä½œ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| å¯åŠ¨ç¨‹åº | < 2s | åŒ…å«åŠ è½½ç¼“å­˜ |
| æ‰«ææ–‡ä»¶å¤¹(10ä¸ªExcel) | < 0.5s | ä»…æ‰«ææ–‡ä»¶å |
| å¹¶å‘è¯»å–(10ä¸ªExcel) | 2-5s | ä½¿ç”¨ä¼˜åŒ–è¯»å– |
| å¤„ç†å•ä¸ªæ–‡ä»¶1 | < 0.3s | åŒ…å«ç­›é€‰å’Œè§’è‰²è¿‡æ»¤ |
| å¤„ç†å•ä¸ªæ–‡ä»¶6 | < 0.2s | è¾ƒå°‘çš„åˆ—å’Œè¡Œ |
| å®Œæ•´å¤„ç†æµç¨‹ | 5-10s | 10ä¸ªæ–‡ä»¶ï¼Œ6ç§ç±»å‹ |
| å¯¼å‡ºTXT | < 0.5s | ç®€æ´æ¨¡å¼æ›´å¿« |

### F. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¸»è¦å˜æ›´ |
|------|------|---------|
| **3.0** | 2025-10-30 | â€¢ ç”¨æˆ·å‹¾é€‰çŠ¶æ€éš”ç¦»<br>â€¢ è·¨å¹´æ—¥æœŸè§£æä¿®å¤<br>â€¢ å…¨åˆ—æ’åºåŠŸèƒ½<br>â€¢ æ‰€é¢†å¯¼æ˜¾ç¤ºé€»è¾‘ä¿®æ­£ |
| **2.5** | 2025-10-28 | â€¢ æ–°å¢æ¥å£æ—¶é—´åˆ—<br>â€¢ æ™ºèƒ½åˆ—å®½è®¡ç®—<br>â€¢ ç®¡ç†å‘˜æ–‡ä»¶6æ— æ—¶é—´é™åˆ¶ |
| **2.0** | 2025-10-27 | â€¢ æ–°å¢æ‰€é¢†å¯¼è§’è‰²<br>â€¢ å·¥ä½œæ—¥è®¡ç®—æ‰©å±•åˆ°å®¤ä¸»ä»»<br>â€¢ ç®€æ´å¯¼å‡ºæ¨¡å¼ |
| **1.5** | 2025-09 | â€¢ ç»“æœç¼“å­˜æœºåˆ¶<br>â€¢ å¹¶å‘è¯»å–ä¼˜åŒ– |
| **1.0** | 2025-08 | â€¢ åˆå§‹ç‰ˆæœ¬<br>â€¢ åŸºç¡€ç­›é€‰å’Œå¯¼å‡ºåŠŸèƒ½ |

### G. è”ç³»æ–¹å¼ä¸æ”¯æŒ

**å¼€å‘å›¢é˜Ÿ**: [æ‚¨çš„å›¢é˜Ÿåç§°]  
**ç»´æŠ¤å‘¨æœŸ**: é•¿æœŸç»´æŠ¤  
**æ›´æ–°é¢‘ç‡**: æ ¹æ®éœ€æ±‚ä¸å®šæœŸæ›´æ–°  

**é‡åˆ°é—®é¢˜æ—¶**:
1. æŸ¥çœ‹"å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"ç« èŠ‚
2. æ£€æŸ¥æµ‹è¯•æ˜¯å¦å…¨éƒ¨é€šè¿‡
3. æŸ¥çœ‹Monitoræ—¥å¿—çª—å£çš„é”™è¯¯ä¿¡æ¯
4. è”ç³»åŸå¼€å‘å›¢é˜Ÿ

---

## ç»“è¯­

è¿™ä»½æ–‡æ¡£æ—¨åœ¨è®©æ–°çš„AIåŠ©æ‰‹èƒ½å¤Ÿ**å¿«é€Ÿã€å®Œæ•´ã€å‡†ç¡®**åœ°æ¥æ‰‹è¿™ä¸ªé¡¹ç›®ã€‚å¦‚æœæ‚¨åœ¨æ¥æ‰‹è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•ç–‘é—®æˆ–æ–‡æ¡£ä¸­æœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œè¯·ç«‹å³æå‡ºï¼Œæˆ‘ä¼šè¡¥å……å®Œå–„ã€‚

**æ ¸å¿ƒåŸåˆ™**: 
- **ä¿æŒå…¼å®¹**: ä¿®æ”¹æ—¶è€ƒè™‘å‘åå…¼å®¹æ€§
- **æµ‹è¯•é©±åŠ¨**: å…ˆå†™æµ‹è¯•ï¼Œå†å†™ä»£ç 
- **ä»£ç æ¸…æ™°**: å®å¯å¤šå†™æ³¨é‡Šï¼Œä¸è¦å†™"èªæ˜"çš„ä»£ç 
- **ç”¨æˆ·è‡³ä¸Š**: ç•Œé¢å‹å¥½ã€æ“ä½œç®€å•ã€é”™è¯¯æ¸…æ™°

**æœ€é‡è¦çš„ä¸€å¥è¯**: 
> æ‰€æœ‰çš„è®¾è®¡å†³ç­–éƒ½æ˜¯ä¸ºäº†**5ç§è§’è‰²èƒ½å¤Ÿé«˜æ•ˆã€å‡†ç¡®åœ°æ‰¾åˆ°è‡ªå·±éœ€è¦å¤„ç†çš„æ¥å£**ã€‚

ç¥æ‚¨æ¥æ‰‹é¡ºåˆ©ï¼ğŸ‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**ç”Ÿæˆæ—¶é—´**: 2025-10-30  
**æ–‡æ¡£ä½œè€…**: Claude (Sonnet 4.5)  
**æ–‡æ¡£çŠ¶æ€**: å®Œæ•´ç‰ˆï¼Œå¯ç›´æ¥ä½¿ç”¨

