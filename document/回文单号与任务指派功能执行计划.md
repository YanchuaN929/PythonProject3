# å›æ–‡å•å·ä¸ä»»åŠ¡æŒ‡æ´¾åŠŸèƒ½ - åˆ†æ­¥æ‰§è¡Œè®¡åˆ’

> **ç‰ˆæœ¬**: 1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-10-30  
> **é€‚ç”¨å¯¹è±¡**: æ–°AIåŠ©æ‰‹  
> **ç›®æ ‡**: æŒ‰ç…§æœ¬è®¡åˆ’é€æ­¥å®æ–½ï¼Œç¡®ä¿åŠŸèƒ½å®Œæ•´ä¸”æ— ç ´åæ€§

---

## ğŸ“‹ æ‰§è¡Œå‰æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹æ‰§è¡Œå‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹å†…å®¹ï¼š

- [ ] å·²é˜…è¯» `é¡¹ç›®å®Œæ•´æ–‡æ¡£_AIæ¥æ‰‹æŒ‡å—.md`
- [ ] å·²é˜…è¯» `å›æ–‡å•å·ä¸ä»»åŠ¡æŒ‡æ´¾åŠŸèƒ½éœ€æ±‚æ–‡æ¡£.md`
- [ ] å·²è¿è¡Œæ‰€æœ‰ç°æœ‰æµ‹è¯•ï¼ˆ247ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰
- [ ] å·²å¤‡ä»½å…³é”®æ–‡ä»¶ï¼ˆ`base.py`, `window.py`, `main.py`ï¼‰
- [ ] å·²ç†è§£ç°æœ‰ä»£ç æ¶æ„å’Œè®¾è®¡åŸåˆ™
- [ ] å·²å‡†å¤‡å¥½æµ‹è¯•Excelæ–‡ä»¶

---

## ğŸ¯ æ‰§è¡ŒåŸåˆ™

1. **å°æ­¥å¿«è·‘**: æ¯ä¸ªé˜¶æ®µå®Œæˆåç«‹å³æµ‹è¯•
2. **æµ‹è¯•å…ˆè¡Œ**: å…ˆå†™æµ‹è¯•ç”¨ä¾‹ï¼Œå†å†™åŠŸèƒ½ä»£ç 
3. **å‘åå…¼å®¹**: ç¡®ä¿ç°æœ‰åŠŸèƒ½é›¶ç ´å
4. **å……åˆ†æ³¨é‡Š**: å…³é”®é€»è¾‘å¿…é¡»æ³¨é‡Šè¯´æ˜
5. **æŒç»­éªŒè¯**: æ¯é˜¶æ®µè¿è¡Œå…¨é‡æµ‹è¯•

---

## ğŸ“Š æ‰§è¡Œé˜¶æ®µæ€»è§ˆ

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡å·¥ä½œé‡ | é£é™©ç­‰çº§ |
|------|------|-----------|---------|
| **é˜¶æ®µ1** | è´£ä»»äººåˆ—æ˜¾ç¤º | 2å°æ—¶ | ä½ |
| **é˜¶æ®µ2** | å›æ–‡å•å·è¾“å…¥æ¨¡å— | 4å°æ—¶ | ä¸­ |
| **é˜¶æ®µ3** | ä»»åŠ¡æŒ‡æ´¾æ¨¡å— | 6å°æ—¶ | é«˜ |
| **é˜¶æ®µ4** | æŒ‡æ´¾è¿½è¸ªåŠŸèƒ½ | 3å°æ—¶ | ä¸­ |
| **é˜¶æ®µ5** | ç¼“å­˜é€‚é…ä¸é›†æˆ | 2å°æ—¶ | ä¸­ |
| **é˜¶æ®µ6** | æ‰“åŒ…ä¸éªŒæ”¶ | 2å°æ—¶ | ä½ |
| **æ€»è®¡** | - | **19å°æ—¶** | - |

---

## é˜¶æ®µ1: è´£ä»»äººåˆ—æ˜¾ç¤º

### ç›®æ ‡
åœ¨ä¸»æ˜¾ç¤ºçª—å£æ–°å¢"è´£ä»»äºº"åˆ—ï¼Œæ˜¾ç¤ºå„æ–‡ä»¶çš„è´£ä»»äººä¿¡æ¯ã€‚

### å‰ç½®æ¡ä»¶
- å·²ç†è§£ `main.py` ä¸­å„æ–‡ä»¶çš„è´£ä»»äººåˆ—è¯»å–é€»è¾‘
- å·²ç†è§£ `window.py` çš„åˆ—æ˜¾ç¤ºæœºåˆ¶

### æ‰§è¡Œæ­¥éª¤

#### æ­¥éª¤1.1: éªŒè¯è´£ä»»äººæ•°æ®æ˜¯å¦å·²æå–ï¼ˆ5åˆ†é’Ÿï¼‰

**æ£€æŸ¥ç‚¹**:
```bash
# æ£€æŸ¥å„æ–‡ä»¶çš„process_target_fileXå‡½æ•°æ˜¯å¦å·²æå–è´£ä»»äºº
grep -n "è´£ä»»äºº" main.py
```

**é¢„æœŸç»“æœ**:
- æ–‡ä»¶1: ç¬¬454-465è¡Œï¼Œä»Råˆ—(17)æå–
- æ–‡ä»¶3: ç¬¬1496-1507è¡Œï¼Œä»APåˆ—(41)æå–
- æ–‡ä»¶4: ç¬¬2257-2268è¡Œï¼Œä»AHåˆ—(33)æå–
- æ–‡ä»¶5: ç¬¬2846-2857è¡Œï¼Œä»Kåˆ—(10)æå–
- æ–‡ä»¶6: ç¬¬3230-3243è¡Œï¼Œä»Xåˆ—(23)æå–
- æ–‡ä»¶2: **æ— è´£ä»»äººåˆ—**

**æ“ä½œ**: å¦‚æœå·²å­˜åœ¨ï¼Œè·³åˆ°æ­¥éª¤1.3ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œæ‰§è¡Œæ­¥éª¤1.2

#### æ­¥éª¤1.2: ä¸ºæ–‡ä»¶2æ·»åŠ "è´£ä»»äºº"åˆ—ï¼ˆ10åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `main.py`

**ä½ç½®**: `process_target_file2()` å‡½æ•°æœ«å°¾ï¼ˆçº¦ç¬¬1084è¡Œï¼‰

**ä»£ç **:
```python
# æ–°å¢"è´£ä»»äºº"åˆ—ï¼ˆæ–‡ä»¶2æ— è´£ä»»äººåˆ—ï¼Œç»Ÿä¸€æ˜¾ç¤º"æ— "ï¼‰
try:
    result_df['è´£ä»»äºº'] = "æ— "
except Exception:
    result_df['è´£ä»»äºº'] = ""
```

**æµ‹è¯•**:
```bash
python -c "
from main import process_target_file2
from datetime import datetime
# ä½¿ç”¨æµ‹è¯•æ–‡ä»¶
result = process_target_file2('æµ‹è¯•æ–‡ä»¶è·¯å¾„', datetime.now())
print('è´£ä»»äºº' in result.columns)
print(result['è´£ä»»äºº'].unique())
"
```

#### æ­¥éª¤1.3: ä¿®æ”¹window.pyæ˜¾ç¤ºé€»è¾‘ï¼ˆ30åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `window.py`

**ä½ç½®**: `_create_optimized_display()` æ–¹æ³•

**å½“å‰åˆ—é¡ºåº**:
```python
columns = ['çŠ¶æ€', 'é¡¹ç›®å·', 'æ¥å£å·', 'æ¥å£æ—¶é—´', 'æ˜¯å¦å·²å®Œæˆ']
```

**ä¿®æ”¹ä¸º**:
```python
columns = ['çŠ¶æ€', 'é¡¹ç›®å·', 'æ¥å£å·', 'æ¥å£æ—¶é—´', 'è´£ä»»äºº', 'æ˜¯å¦å·²å®Œæˆ']
```

**è¯¦ç»†ä¿®æ”¹**:

1. æ‰¾åˆ° `_create_optimized_display()` æ–¹æ³•ï¼ˆçº¦ç¬¬714è¡Œï¼‰
2. ä¿®æ”¹åˆ—é€‰æ‹©é€»è¾‘ï¼š

```python
def _create_optimized_display(self, df, tab_name, completed_rows=None):
    """
    åˆ›å»ºä¼˜åŒ–çš„æ˜¾ç¤ºDataFrameï¼ˆä»…æ˜¾ç¤ºå…³é”®åˆ—ï¼‰
    """
    if df.empty:
        return df
    
    # å®šä¹‰æ˜¾ç¤ºåˆ—ï¼ˆæ·»åŠ è´£ä»»äººåˆ—ï¼‰
    display_columns = []
    
    # 1. çŠ¶æ€åˆ—ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if 'çŠ¶æ€' in df.columns:
        display_columns.append('çŠ¶æ€')
    
    # 2. é¡¹ç›®å·åˆ—ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if 'é¡¹ç›®å·' in df.columns:
        display_columns.append('é¡¹ç›®å·')
    
    # 3. æ¥å£å·åˆ—ï¼ˆå¿…é¡»ï¼‰
    interface_col = None
    for col in ['A', 'E', 'C', 'R', 'æ¥å£å·']:
        if col in df.columns:
            interface_col = col
            break
    
    if interface_col:
        display_columns.append(interface_col)
        # é‡å‘½åä¸ºç»Ÿä¸€çš„"æ¥å£å·"
        if interface_col != 'æ¥å£å·':
            df = df.rename(columns={interface_col: 'æ¥å£å·'})
    
    # 4. æ¥å£æ—¶é—´åˆ—ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if 'æ¥å£æ—¶é—´' in df.columns:
        display_columns.append('æ¥å£æ—¶é—´')
    
    # 5. è´£ä»»äººåˆ—ï¼ˆæ–°å¢ï¼Œå¦‚æœå­˜åœ¨ï¼‰
    if 'è´£ä»»äºº' in df.columns:
        display_columns.append('è´£ä»»äºº')
    
    # 6. æ˜¯å¦å·²å®Œæˆåˆ—ï¼ˆå§‹ç»ˆæ·»åŠ ï¼‰
    display_columns.append('æ˜¯å¦å·²å®Œæˆ')
    
    # ... åç»­é€»è¾‘ ...
```

3. ä¿®æ”¹å›ºå®šåˆ—å®½é…ç½®ï¼ˆçº¦ç¬¬538è¡Œï¼‰:

```python
fixed_column_widths = {
    'çŠ¶æ€': 50,
    'é¡¹ç›®å·': 75,
    'æ¥å£å·': 240,
    'æ¥å£æ—¶é—´': 85,
    'è´£ä»»äºº': 100,      # æ–°å¢
    'æ˜¯å¦å·²å®Œæˆ': 95
}
```

4. ä¿®æ”¹åˆ—å¯¹é½æ–¹å¼ï¼ˆçº¦ç¬¬570è¡Œï¼‰:

```python
column_alignment = {
    'çŠ¶æ€': 'center',
    'é¡¹ç›®å·': 'center',
    'æ¥å£å·': 'w',
    'æ¥å£æ—¶é—´': 'center',
    'è´£ä»»äºº': 'center',  # æ–°å¢
    'æ˜¯å¦å·²å®Œæˆ': 'center'
}
```

#### æ­¥éª¤1.4: å¤„ç†ç©ºå€¼æ˜¾ç¤ºï¼ˆ10åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `window.py`

**ä½ç½®**: `display_excel_data()` æ–¹æ³•ä¸­ï¼Œæ¥å£æ—¶é—´å¤„ç†å

**æ·»åŠ ä»£ç **:
```python
# ã€æ–°å¢ã€‘å¤„ç†"è´£ä»»äºº"åˆ—ï¼šç©ºå€¼æ˜¾ç¤ºä¸º"æ— "
if "è´£ä»»äºº" in display_df.columns:
    responsible_values = []
    for idx in range(len(display_df)):
        try:
            responsible_value = display_df.iloc[idx]["è´£ä»»äºº"]
            # ç©ºå€¼å¤„ç†
            if pd.isna(responsible_value) or str(responsible_value).strip() == '':
                resp_str = 'æ— '
            else:
                resp_str = str(responsible_value).strip()
            responsible_values.append(resp_str)
        except Exception:
            responsible_values.append('æ— ')
    
    display_df["è´£ä»»äºº"] = responsible_values
```

#### æ­¥éª¤1.5: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆ30åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `tests/test_responsible_person_display.py`

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
è´£ä»»äººåˆ—æ˜¾ç¤ºåŠŸèƒ½æµ‹è¯•
"""

import pytest
import pandas as pd
from main import (
    process_target_file1,
    process_target_file2,
    process_target_file3,
    process_target_file4,
    process_target_file5,
    process_target_file6
)
from datetime import datetime


class TestResponsiblePersonColumn:
    """æµ‹è¯•è´£ä»»äººåˆ—çš„å­˜åœ¨æ€§å’Œæ•°æ®æ­£ç¡®æ€§"""
    
    def test_file1_has_responsible_column(self):
        """æµ‹è¯•æ–‡ä»¶1æœ‰è´£ä»»äººåˆ—"""
        # åˆ›å»ºæµ‹è¯•DataFrame
        test_data = {
            'H': ['25C1'] * 5,
            'M': [''] * 5,
            'R': ['ç‹ä»»è¶…', 'æå››', '', None, 'å¼ ä¸‰æå››'],  # Råˆ—ï¼šè´£ä»»äºº
        }
        df = pd.DataFrame(test_data)
        
        # æ¨¡æ‹Ÿprocess_target_file1çš„è´£ä»»äººæå–é€»è¾‘
        import re
        zh_pattern = re.compile(r"[\u4e00-\u9fa5]+")
        owners = []
        for idx in range(len(df)):
            cell_val = df.iloc[idx, 2]  # Råˆ—
            s = str(cell_val) if cell_val is not None else ""
            found = zh_pattern.findall(s)
            owners.append("".join(found))
        
        assert owners[0] == "ç‹ä»»è¶…"
        assert owners[1] == "æå››"
        assert owners[2] == ""
        assert owners[3] == ""
        assert owners[4] == "å¼ ä¸‰æå››"
    
    def test_file2_has_responsible_column_as_none(self):
        """æµ‹è¯•æ–‡ä»¶2çš„è´£ä»»äººåˆ—æ˜¾ç¤ºä¸º'æ— '"""
        # æ–‡ä»¶2æ— è´£ä»»äººåˆ—
        responsible_value = "æ— "
        assert responsible_value == "æ— "
    
    def test_file3_has_responsible_column(self):
        """æµ‹è¯•æ–‡ä»¶3æœ‰è´£ä»»äººåˆ—ï¼ˆAPåˆ—ï¼‰"""
        # APåˆ—ç´¢å¼•ä¸º41
        pass  # ç±»ä¼¼æ–‡ä»¶1çš„æµ‹è¯•é€»è¾‘
    
    def test_file4_has_responsible_column(self):
        """æµ‹è¯•æ–‡ä»¶4æœ‰è´£ä»»äººåˆ—ï¼ˆAHåˆ—ï¼‰"""
        # AHåˆ—ç´¢å¼•ä¸º33
        pass
    
    def test_file5_has_responsible_column(self):
        """æµ‹è¯•æ–‡ä»¶5æœ‰è´£ä»»äººåˆ—ï¼ˆKåˆ—ï¼‰"""
        # Kåˆ—ç´¢å¼•ä¸º10
        pass
    
    def test_file6_has_responsible_column_with_multiple_persons(self):
        """æµ‹è¯•æ–‡ä»¶6æœ‰è´£ä»»äººåˆ—ï¼ˆXåˆ—ï¼Œå¤šäººç”¨é€—å·åˆ†éš”ï¼‰"""
        # Xåˆ—ç´¢å¼•ä¸º23
        test_value = "ç‹ä»»è¶…,æå››,å¼ ä¸‰"
        persons = test_value.split(',')
        assert len(persons) == 3
        assert "ç‹ä»»è¶…" in persons


class TestResponsiblePersonDisplay:
    """æµ‹è¯•è´£ä»»äººåˆ—åœ¨GUIä¸­çš„æ˜¾ç¤º"""
    
    def test_responsible_column_in_display(self):
        """æµ‹è¯•è´£ä»»äººåˆ—åœ¨æ˜¾ç¤ºåˆ—è¡¨ä¸­"""
        display_columns = ['çŠ¶æ€', 'é¡¹ç›®å·', 'æ¥å£å·', 'æ¥å£æ—¶é—´', 'è´£ä»»äºº', 'æ˜¯å¦å·²å®Œæˆ']
        assert 'è´£ä»»äºº' in display_columns
        # ç¡®è®¤ä½ç½®åœ¨"æ¥å£æ—¶é—´"ä¹‹å
        responsible_index = display_columns.index('è´£ä»»äºº')
        time_index = display_columns.index('æ¥å£æ—¶é—´')
        assert responsible_index == time_index + 1
    
    def test_empty_responsible_shows_none(self):
        """æµ‹è¯•ç©ºè´£ä»»äººæ˜¾ç¤ºä¸º'æ— '"""
        test_values = [None, '', '  ', float('nan')]
        for val in test_values:
            if pd.isna(val) or str(val).strip() == '':
                result = 'æ— '
            else:
                result = str(val).strip()
            assert result == 'æ— '
    
    def test_responsible_column_width(self):
        """æµ‹è¯•è´£ä»»äººåˆ—å®½åº¦è®¾ç½®"""
        fixed_widths = {
            'çŠ¶æ€': 50,
            'é¡¹ç›®å·': 75,
            'æ¥å£å·': 240,
            'æ¥å£æ—¶é—´': 85,
            'è´£ä»»äºº': 100,
            'æ˜¯å¦å·²å®Œæˆ': 95
        }
        assert fixed_widths['è´£ä»»äºº'] == 100
```

**è¿è¡Œæµ‹è¯•**:
```bash
pytest tests/test_responsible_person_display.py -v
```

#### æ­¥éª¤1.6: éªŒè¯ç°æœ‰æµ‹è¯•ï¼ˆ10åˆ†é’Ÿï¼‰

**è¿è¡Œå…¨é‡æµ‹è¯•**:
```bash
pytest -v
```

**é¢„æœŸç»“æœ**: 247ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆå¯èƒ½éœ€è¦ä¿®å¤å°‘é‡åˆ—é¡ºåºç›¸å…³çš„æµ‹è¯•ï¼‰

**å¦‚æœæœ‰å¤±è´¥**: æ£€æŸ¥æ˜¯å¦æ˜¯åˆ—é¡ºåºå˜åŒ–å¯¼è‡´ï¼Œä¿®å¤ç›¸å…³æµ‹è¯•ç”¨ä¾‹

#### æ­¥éª¤1.7: æ‰‹åŠ¨éªŒè¯ï¼ˆ15åˆ†é’Ÿï¼‰

1. å¯åŠ¨ç¨‹åº: `python base.py`
2. é€‰æ‹©æµ‹è¯•æ–‡ä»¶å¤¹
3. ç‚¹å‡»"å¼€å§‹ç­›é€‰"
4. æ£€æŸ¥6ä¸ªé€‰é¡¹å¡çš„è´£ä»»äººåˆ—ï¼š
   - åˆ—æ˜¯å¦å­˜åœ¨ï¼Ÿ
   - åˆ—ä½ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
   - æ•°æ®æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºï¼Ÿ
   - ç©ºå€¼æ˜¯å¦æ˜¾ç¤º"æ— "ï¼Ÿ
   - åˆ—å®½æ˜¯å¦åˆé€‚ï¼Ÿ

#### é˜¶æ®µ1å®Œæˆæ ‡å¿—
- [ ] æ‰€æœ‰6ä¸ªæ–‡ä»¶ç±»å‹éƒ½æœ‰è´£ä»»äººåˆ—
- [ ] è´£ä»»äººåˆ—æ˜¾ç¤ºåœ¨æ­£ç¡®ä½ç½®
- [ ] ç©ºå€¼æ˜¾ç¤ºä¸º"æ— "
- [ ] åˆ—å®½è®¾ç½®åˆç†
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨éªŒè¯é€šè¿‡

---

## é˜¶æ®µ2: å›æ–‡å•å·è¾“å…¥æ¨¡å—

### ç›®æ ‡
åˆ›å»º `input_handler.py` æ¨¡å—ï¼Œå®ç°ç‚¹å‡»æ¥å£å·è¾“å…¥å›æ–‡å•å·åŠŸèƒ½ã€‚

### å‰ç½®æ¡ä»¶
- é˜¶æ®µ1å·²å®Œæˆ
- å·²ç†è§£æ–‡ä»¶3çš„Måˆ—/Låˆ—åˆ¤æ–­é€»è¾‘

### æ‰§è¡Œæ­¥éª¤

#### æ­¥éª¤2.1: åˆ›å»ºinput_handler.pyï¼ˆ1å°æ—¶ï¼‰

**æ–‡ä»¶**: `input_handler.py`

**å®Œæ•´ä»£ç ç»“æ„**:
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å›æ–‡å•å·è¾“å…¥å¤„ç†æ¨¡å—
"""

import tkinter as tk
from tkinter import ttk, messagebox
import pandas as pd
from openpyxl import load_workbook
from datetime import date
import os


class InterfaceInputDialog(tk.Toplevel):
    """å›æ–‡å•å·è¾“å…¥å¼¹çª—"""
    
    def __init__(self, parent, interface_id, file_type, file_path, row_index, 
                 user_name, project_id, source_column=None):
        """
        å‚æ•°:
            parent: çˆ¶çª—å£
            interface_id: æ¥å£å·
            file_type: æ–‡ä»¶ç±»å‹(1-6)
            file_path: åŸå§‹Excelæ–‡ä»¶è·¯å¾„
            row_index: Excelè¡Œå·
            user_name: å½“å‰ç”¨æˆ·å§“å
            project_id: é¡¹ç›®å·
            source_column: æ–‡ä»¶3ä¸“ç”¨ï¼Œ'M'æˆ–'L'ï¼Œè¡¨ç¤ºç­›é€‰æ¥æº
        """
        super().__init__(parent)
        
        self.interface_id = interface_id
        self.file_type = file_type
        self.file_path = file_path
        self.row_index = row_index
        self.user_name = user_name
        self.project_id = project_id
        self.source_column = source_column
        
        self.setup_ui()
    
    def setup_ui(self):
        """è®¾ç½®ç•Œé¢"""
        self.title("å›æ–‡å•å·è¾“å…¥")
        self.geometry("400x200")
        self.resizable(False, False)
        
        # å±…ä¸­æ˜¾ç¤º
        self.transient(self.master)
        self.grab_set()
        
        # æ ‡é¢˜
        title_label = ttk.Label(self, text=f"æ¥å£å·: {self.interface_id}", 
                                font=('Arial', 12, 'bold'))
        title_label.pack(pady=10)
        
        # è¾“å…¥æ¡†
        input_frame = ttk.Frame(self)
        input_frame.pack(pady=10, padx=20, fill='x')
        
        ttk.Label(input_frame, text="å›æ–‡å•å·:").pack(side='left', padx=5)
        
        self.entry = ttk.Entry(input_frame, width=30)
        self.entry.pack(side='left', padx=5, fill='x', expand=True)
        self.entry.focus_set()
        
        # æŒ‰é’®
        button_frame = ttk.Frame(self)
        button_frame.pack(pady=20)
        
        ttk.Button(button_frame, text="ç¡®è®¤", command=self.on_confirm).pack(side='left', padx=10)
        ttk.Button(button_frame, text="å–æ¶ˆ", command=self.destroy).pack(side='left', padx=10)
        
        # ç»‘å®šEnteré”®
        self.entry.bind('<Return>', lambda e: self.on_confirm())
    
    def on_confirm(self):
        """ç¡®è®¤æŒ‰é’®å›è°ƒ"""
        response_number = self.entry.get().strip()
        
        if not response_number:
            messagebox.showwarning("è­¦å‘Š", "è¯·è¾“å…¥å›æ–‡å•å·", parent=self)
            return
        
        # å†™å…¥Excel
        try:
            success = write_response_to_excel(
                self.file_path,
                self.file_type,
                self.row_index,
                response_number,
                self.user_name,
                self.project_id,
                self.source_column
            )
            
            if success:
                messagebox.showinfo("æˆåŠŸ", "å›æ–‡å•å·å·²ä¿å­˜", parent=self)
                self.destroy()
            else:
                messagebox.showerror("å¤±è´¥", "ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•", parent=self)
        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"ä¿å­˜å¤±è´¥: {str(e)}", parent=self)


def write_response_to_excel(file_path, file_type, row_index, response_number, 
                             user_name, project_id, source_column=None):
    """
    å†™å…¥å›æ–‡å•å·åˆ°Excelæ–‡ä»¶
    
    å‚æ•°:
        file_path: Excelæ–‡ä»¶è·¯å¾„
        file_type: æ–‡ä»¶ç±»å‹(1-6)
        row_index: Excelè¡Œå·ï¼ˆä»2å¼€å§‹ï¼Œå› ä¸ºç¬¬1è¡Œæ˜¯æ ‡é¢˜ï¼‰
        response_number: å›æ–‡å•å·
        user_name: ç”¨æˆ·å§“å
        project_id: é¡¹ç›®å·
        source_column: æ–‡ä»¶3ä¸“ç”¨ï¼Œ'M'æˆ–'L'
    
    è¿”å›:
        bool: æˆåŠŸè¿”å›Trueï¼Œå¤±è´¥è¿”å›False
    """
    try:
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if not os.path.exists(file_path):
            print(f"æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")
            return False
        
        # æ–‡ä»¶é”å®šæ£€æµ‹
        try:
            # å°è¯•ä»¥ç‹¬å æ¨¡å¼æ‰“å¼€
            with open(file_path, 'r+b') as f:
                pass
        except PermissionError:
            messagebox.showerror("æ–‡ä»¶å ç”¨", "æœ‰å…¶ä»–ç”¨æˆ·å ç”¨è¯¥æ–‡ä»¶ï¼Œè¯·ç¨åå†è¯•")
            return False
        
        # ä½¿ç”¨openpyxlæ‰“å¼€
        wb = load_workbook(file_path)
        ws = wb.active
        
        # è·å–å†™å…¥åˆ—ä½ç½®
        columns = get_write_columns(file_type, row_index, ws, source_column)
        
        if not columns:
            print(f"æ— æ³•ç¡®å®šå†™å…¥åˆ—ä½ç½®: file_type={file_type}")
            return False
        
        # å†™å…¥æ•°æ®
        response_col = columns['response_col']
        time_col = columns['time_col']
        name_col = columns['name_col']
        
        ws[f"{response_col}{row_index}"] = response_number
        ws[f"{time_col}{row_index}"] = date.today().strftime('%Y-%m-%d')
        ws[f"{name_col}{row_index}"] = user_name
        
        # ä¿å­˜
        wb.save(file_path)
        wb.close()
        
        print(f"æˆåŠŸå†™å…¥: {file_path}, è¡Œ{row_index}, å›æ–‡å•å·={response_number}")
        return True
        
    except Exception as e:
        print(f"å†™å…¥å¤±è´¥: {e}")
        import traceback
        traceback.print_exc()
        return False


def get_write_columns(file_type, row_index, worksheet, source_column=None):
    """
    è·å–å„æ–‡ä»¶ç±»å‹çš„å†™å…¥åˆ—ä½ç½®
    
    å‚æ•°:
        file_type: æ–‡ä»¶ç±»å‹(1-6)
        row_index: Excelè¡Œå·
        worksheet: openpyxlå·¥ä½œè¡¨å¯¹è±¡
        source_column: æ–‡ä»¶3ä¸“ç”¨ï¼Œ'M'æˆ–'L'
    
    è¿”å›:
        dict: {'response_col': 'S', 'time_col': 'N', 'name_col': 'V'}
        æˆ– Noneï¼ˆå¦‚æœæ— æ³•ç¡®å®šï¼‰
    """
    # æ–‡ä»¶ç±»å‹1-2, 4-6çš„å›ºå®šåˆ—ä½ç½®
    column_map = {
        1: {'response_col': 'S', 'time_col': 'N', 'name_col': 'V'},
        2: {'response_col': 'P', 'time_col': 'N', 'name_col': 'AL'},
        4: {'response_col': 'U', 'time_col': 'V', 'name_col': 'AT'},
        5: {'response_col': 'V', 'time_col': 'N', 'name_col': 'W'},
        6: {'response_col': 'L', 'time_col': 'J', 'name_col': 'N'},
    }
    
    if file_type in column_map:
        return column_map[file_type]
    
    # æ–‡ä»¶3ç‰¹æ®Šé€»è¾‘ï¼šæ ¹æ®source_columnåˆ¤æ–­
    if file_type == 3:
        if source_column == 'M':
            # Måˆ—ç­›é€‰ï¼šV/T/BM
            return {'response_col': 'V', 'time_col': 'T', 'name_col': 'BM'}
        elif source_column == 'L':
            # Låˆ—ç­›é€‰ï¼šS/Q/BM
            return {'response_col': 'S', 'time_col': 'Q', 'name_col': 'BM'}
        else:
            # å¦‚æœæœªæŒ‡å®šï¼Œå°è¯•è‡ªåŠ¨åˆ¤æ–­
            return determine_file3_source_and_columns(row_index, worksheet)
    
    return None


def determine_file3_source_and_columns(row_index, worksheet):
    """
    åˆ¤æ–­æ–‡ä»¶3æŸè¡Œæ˜¯å› Måˆ—è¿˜æ˜¯Låˆ—è¢«ç­›é€‰å‡º
    
    å‚æ•°:
        row_index: Excelè¡Œå·
        worksheet: openpyxlå·¥ä½œè¡¨å¯¹è±¡
    
    è¿”å›:
        dict: å†™å…¥åˆ—ä½ç½®
    """
    try:
        # è¯»å–Måˆ—å’ŒLåˆ—çš„å€¼
        m_val = worksheet[f"M{row_index}"].value
        l_val = worksheet[f"L{row_index}"].value
        
        # è¯»å–Tåˆ—å’ŒQåˆ—çš„å€¼ï¼ˆå›å¤æ—¶é—´åˆ—ï¼‰
        t_val = worksheet[f"T{row_index}"].value
        q_val = worksheet[f"Q{row_index}"].value
        
        # ç®€åŒ–åˆ¤æ–­é€»è¾‘ï¼š
        # å¦‚æœMåˆ—æœ‰æ—¶é—´æ•°æ®ä¸”Tåˆ—ä¸ºç©ºï¼Œåˆ¤æ–­ä¸ºMåˆ—æ¥æº
        # å¦‚æœLåˆ—æœ‰æ—¶é—´æ•°æ®ä¸”Qåˆ—ä¸ºç©ºï¼Œåˆ¤æ–­ä¸ºLåˆ—æ¥æº
        # ä¼˜å…ˆMåˆ—
        
        m_has_time = m_val is not None and str(m_val).strip() != ''
        t_is_empty = t_val is None or str(t_val).strip() == ''
        
        l_has_time = l_val is not None and str(l_val).strip() != ''
        q_is_empty = q_val is None or str(q_val).strip() == ''
        
        if m_has_time and t_is_empty:
            # Måˆ—æ¥æº
            return {'response_col': 'V', 'time_col': 'T', 'name_col': 'BM'}
        elif l_has_time and q_is_empty:
            # Låˆ—æ¥æº
            return {'response_col': 'S', 'time_col': 'Q', 'name_col': 'BM'}
        else:
            # é»˜è®¤Måˆ—
            return {'response_col': 'V', 'time_col': 'T', 'name_col': 'BM'}
    
    except Exception as e:
        print(f"åˆ¤æ–­æ–‡ä»¶3æ¥æºå¤±è´¥: {e}")
        # é»˜è®¤è¿”å›Måˆ—
        return {'response_col': 'V', 'time_col': 'T', 'name_col': 'BM'}


# æµ‹è¯•ä»£ç 
if __name__ == "__main__":
    # æµ‹è¯•get_write_columns
    columns_1 = get_write_columns(1, 5, None)
    print(f"æ–‡ä»¶1å†™å…¥åˆ—: {columns_1}")
    
    columns_3_m = get_write_columns(3, 5, None, 'M')
    print(f"æ–‡ä»¶3(Måˆ—)å†™å…¥åˆ—: {columns_3_m}")
    
    columns_3_l = get_write_columns(3, 5, None, 'L')
    print(f"æ–‡ä»¶3(Låˆ—)å†™å…¥åˆ—: {columns_3_l}")
```

**æµ‹è¯•æ¨¡å—**:
```bash
python input_handler.py
```

#### æ­¥éª¤2.2: åœ¨main.pyä¸­æ·»åŠ æ¥æºæ ‡è®°ï¼ˆ30åˆ†é’Ÿï¼‰

**ç›®çš„**: ä¸ºæ–‡ä»¶3çš„æ¯è¡Œæ•°æ®æ·»åŠ  `_source_column` æ ‡è®°

**æ–‡ä»¶**: `main.py`

**ä½ç½®**: `process_target_file3()` å‡½æ•°

**ä¿®æ”¹** (çº¦ç¬¬1448-1452è¡Œ):

```python
# è½¬æ¢ä¸ºæœ€ç»ˆç»“æœDataFrame
final_indices = [i for i in final_rows if i >= 0]
excel_row_numbers = [i + 2 for i in final_indices]
result_df = df.iloc[final_indices].copy()
result_df['åŸå§‹è¡Œå·'] = excel_row_numbers

# ã€æ–°å¢ã€‘æ·»åŠ æ¥æºæ ‡è®°ï¼ˆç”¨äºå›æ–‡å•å·è¾“å…¥æ—¶åˆ¤æ–­å†™å…¥åˆ—ï¼‰
source_columns = []
for idx in final_indices:
    if idx in group1 and idx not in group2:
        source_columns.append('M')  # Måˆ—ç­›é€‰è·¯å¾„
    elif idx in group2 and idx not in group1:
        source_columns.append('L')  # Låˆ—ç­›é€‰è·¯å¾„
    else:
        source_columns.append('M')  # ä¸¤è€…éƒ½åŒ¹é…ï¼Œä¼˜å…ˆMåˆ—
result_df['_source_column'] = source_columns
```

#### æ­¥éª¤2.3: åœ¨window.pyä¸­ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆ45åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `window.py`

**ä½ç½®1**: `display_excel_data()` æ–¹æ³•æœ«å°¾ï¼ˆçº¦ç¬¬800è¡Œï¼‰

**æ·»åŠ ä»£ç **:
```python
# ã€æ–°å¢ã€‘ç»‘å®šæ¥å£å·åˆ—çš„å•å‡»äº‹ä»¶ï¼ˆç”¨äºå›æ–‡å•å·è¾“å…¥ï¼‰
def on_interface_click(event):
    # è·å–ç‚¹å‡»çš„å•å…ƒæ ¼
    region = viewer.identify_region(event.x, event.y)
    if region != "cell":
        return
    
    column_id = viewer.identify_column(event.x)
    row_id = viewer.identify_row(event.y)
    
    if not row_id:
        return
    
    # æ£€æŸ¥æ˜¯å¦ç‚¹å‡»çš„æ˜¯"æ¥å£å·"åˆ—
    columns = viewer["columns"]
    try:
        col_index = columns.index(column_id.replace('#', ''))
        col_name = columns[col_index]
    except:
        return
    
    if col_name != "æ¥å£å·":
        return
    
    # è·å–å½“å‰è¡Œæ•°æ®
    item = viewer.item(row_id)
    values = item['values']
    
    try:
        interface_id = values[columns.index("æ¥å£å·")]
        row_index_value = values[-1]  # æœ€åä¸€åˆ—æ˜¯åŸå§‹è¡Œå·
        
        # è·å–æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶è·¯å¾„
        # éœ€è¦ä»å¤–éƒ¨ä¼ å…¥æˆ–é€šè¿‡å…¶ä»–æ–¹å¼è·å–
        # è¿™é‡Œå‡è®¾æœ‰self.appçš„å¼•ç”¨
        
        # å¼¹å‡ºè¾“å…¥æ¡†
        from input_handler import InterfaceInputDialog
        
        # è·å–å¿…è¦å‚æ•°
        user_name = getattr(self.app, 'user_name', '')
        file_type = self._get_file_type_from_tab(tab_name)
        file_path = self._get_source_file_path(row_index_value, source_files)
        project_id = values[columns.index("é¡¹ç›®å·")] if "é¡¹ç›®å·" in columns else ""
        
        # æ–‡ä»¶3éœ€è¦è·å–source_column
        source_column = None
        if file_type == 3:
            # ä»åŸå§‹æ•°æ®ä¸­è·å–
            source_column = self._get_source_column(row_index_value, tab_name)
        
        # æ˜¾ç¤ºè¾“å…¥å¯¹è¯æ¡†
        dialog = InterfaceInputDialog(
            self.root,
            interface_id,
            file_type,
            file_path,
            row_index_value,
            user_name,
            project_id,
            source_column
        )
        dialog.wait_window()
        
    except Exception as e:
        print(f"ç‚¹å‡»æ¥å£å·å¤„ç†å¤±è´¥: {e}")
        import traceback
        traceback.print_exc()

viewer.bind("<Button-1>", on_interface_click)
```

**ä½ç½®2**: æ·»åŠ è¾…åŠ©æ–¹æ³•

```python
def _get_file_type_from_tab(self, tab_name):
    """æ ¹æ®é€‰é¡¹å¡åç§°è·å–æ–‡ä»¶ç±»å‹"""
    tab_map = {
        "å†…éƒ¨éœ€æ‰“å¼€æ¥å£": 1,
        "å†…éƒ¨éœ€å›å¤æ¥å£": 2,
        "å¤–éƒ¨éœ€æ‰“å¼€æ¥å£": 3,
        "å¤–éƒ¨éœ€å›å¤æ¥å£": 4,
        "ä¸‰ç»´æèµ„æ¥å£": 5,
        "æ”¶å‘æ–‡å‡½": 6
    }
    return tab_map.get(tab_name, 1)

def _get_source_file_path(self, row_index, source_files):
    """è·å–æºæ–‡ä»¶è·¯å¾„"""
    # source_filesæ˜¯ä¼ å…¥çš„æ–‡ä»¶è·¯å¾„æ˜ å°„
    if source_files and row_index in source_files:
        return source_files[row_index]
    return None

def _get_source_column(self, row_index, tab_name):
    """è·å–æ–‡ä»¶3çš„source_columnæ ‡è®°"""
    # éœ€è¦ä»åŸå§‹DataFrameä¸­è·å–
    # è¿™é‡Œéœ€è¦åœ¨display_excel_dataæ—¶ä¿å­˜ä¸€ä»½åŸå§‹æ•°æ®çš„å¼•ç”¨
    try:
        if hasattr(self, '_original_data') and tab_name in self._original_data:
            df = self._original_data[tab_name]
            row_data = df[df['åŸå§‹è¡Œå·'] == row_index]
            if not row_data.empty and '_source_column' in row_data.columns:
                return row_data.iloc[0]['_source_column']
    except:
        pass
    return 'M'  # é»˜è®¤Måˆ—
```

**ä½ç½®3**: ä¿®æ”¹ `display_excel_data()` ä¿å­˜åŸå§‹æ•°æ®

```python
def display_excel_data(self, viewer, df, tab_name, ...):
    # ... å‰é¢çš„ä»£ç  ...
    
    # ã€æ–°å¢ã€‘ä¿å­˜åŸå§‹æ•°æ®å¼•ç”¨ï¼ˆç”¨äºè·å–source_columnï¼‰
    if not hasattr(self, '_original_data'):
        self._original_data = {}
    self._original_data[tab_name] = df.copy()
    
    # ... åç»­ä»£ç  ...
```

#### æ­¥éª¤2.4: åœ¨base.pyä¸­é›†æˆæ¨¡å—ï¼ˆ15åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `base.py`

**ä½ç½®**: æ–‡ä»¶é¡¶éƒ¨å¯¼å…¥åŒº

**æ·»åŠ å¯¼å…¥**:
```python
# å¯¼å…¥å›æ–‡å•å·è¾“å…¥æ¨¡å—
try:
    import input_handler
except ImportError:
    print("è­¦å‘Š: æœªæ‰¾åˆ°input_handleræ¨¡å—")
    input_handler = None
```

**ä½ç½®**: `display_excel_data_with_original_rows()` æ–¹æ³•

**ä¼ é€’source_fileså‚æ•°**:
```python
def display_excel_data_with_original_rows(self, viewer, df, label_text, excel_row_numbers):
    """æ˜¾ç¤ºæ•°æ®åˆ°Treeview"""
    # æ„å»ºsource_filesæ˜ å°„ï¼ˆåŸå§‹è¡Œå· â†’ æ–‡ä»¶è·¯å¾„ï¼‰
    source_files = {}
    if 'source_file' in df.columns:
        for idx, row in df.iterrows():
            row_num = row.get('åŸå§‹è¡Œå·', 0)
            source_file = row.get('source_file', '')
            if row_num and source_file:
                source_files[row_num] = source_file
    
    # ä¼ é€’ç»™window_manager
    self.window_manager.display_excel_data(
        viewer, 
        df, 
        label_text, 
        excel_row_numbers=excel_row_numbers,
        source_files=source_files  # æ–°å¢å‚æ•°
    )
```

#### æ­¥éª¤2.5: æ·»åŠ source_fileåˆ—ï¼ˆ30åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `main.py`

**åœ¨æ¯ä¸ª `process_target_fileX()` å‡½æ•°ä¸­æ·»åŠ **:

```python
# åœ¨è¿”å›result_dfä¹‹å‰æ·»åŠ 
result_df['source_file'] = file_path
```

**ç¤ºä¾‹**ï¼ˆæ–‡ä»¶1ï¼Œçº¦ç¬¬467è¡Œï¼‰:
```python
    result_df['è´£ä»»äºº'] = owners
    result_df['source_file'] = file_path  # æ–°å¢
    return result_df
```

**åŒæ ·ä¿®æ”¹**: æ–‡ä»¶2/3/4/5/6çš„processå‡½æ•°

#### æ­¥éª¤2.6: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆ1å°æ—¶ï¼‰

**æ–‡ä»¶**: `tests/test_input_handler.py`

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å›æ–‡å•å·è¾“å…¥åŠŸèƒ½æµ‹è¯•
"""

import pytest
import os
import pandas as pd
from openpyxl import load_workbook
from datetime import date
from input_handler import (
    get_write_columns,
    write_response_to_excel,
    determine_file3_source_and_columns
)


class TestGetWriteColumns:
    """æµ‹è¯•è·å–å†™å…¥åˆ—ä½ç½®"""
    
    def test_file1_columns(self):
        """æµ‹è¯•æ–‡ä»¶1çš„å†™å…¥åˆ—"""
        columns = get_write_columns(1, 5, None)
        assert columns == {'response_col': 'S', 'time_col': 'N', 'name_col': 'V'}
    
    def test_file2_columns(self):
        """æµ‹è¯•æ–‡ä»¶2çš„å†™å…¥åˆ—"""
        columns = get_write_columns(2, 5, None)
        assert columns == {'response_col': 'P', 'time_col': 'N', 'name_col': 'AL'}
    
    def test_file3_m_column(self):
        """æµ‹è¯•æ–‡ä»¶3-Måˆ—çš„å†™å…¥åˆ—"""
        columns = get_write_columns(3, 5, None, 'M')
        assert columns == {'response_col': 'V', 'time_col': 'T', 'name_col': 'BM'}
    
    def test_file3_l_column(self):
        """æµ‹è¯•æ–‡ä»¶3-Låˆ—çš„å†™å…¥åˆ—"""
        columns = get_write_columns(3, 5, None, 'L')
        assert columns == {'response_col': 'S', 'time_col': 'Q', 'name_col': 'BM'}
    
    def test_file4_columns(self):
        """æµ‹è¯•æ–‡ä»¶4çš„å†™å…¥åˆ—"""
        columns = get_write_columns(4, 5, None)
        assert columns == {'response_col': 'U', 'time_col': 'V', 'name_col': 'AT'}
    
    def test_file5_columns(self):
        """æµ‹è¯•æ–‡ä»¶5çš„å†™å…¥åˆ—"""
        columns = get_write_columns(5, 5, None)
        assert columns == {'response_col': 'V', 'time_col': 'N', 'name_col': 'W'}
    
    def test_file6_columns(self):
        """æµ‹è¯•æ–‡ä»¶6çš„å†™å…¥åˆ—"""
        columns = get_write_columns(6, 5, None)
        assert columns == {'response_col': 'L', 'time_col': 'J', 'name_col': 'N'}


class TestWriteResponseToExcel:
    """æµ‹è¯•å†™å…¥ExcelåŠŸèƒ½"""
    
    @pytest.fixture
    def temp_excel_file(self, tmp_path):
        """åˆ›å»ºä¸´æ—¶Excelæ–‡ä»¶"""
        file_path = tmp_path / "test_file1.xlsx"
        
        # åˆ›å»ºæµ‹è¯•æ•°æ®
        df = pd.DataFrame({
            'A': ['æ•°æ®1', 'æ•°æ®2', 'æ•°æ®3'],
            'N': ['', '', ''],  # æ—¶é—´åˆ—
            'S': ['', '', ''],  # å›æ–‡å•å·åˆ—
            'V': ['', '', '']   # ç”¨æˆ·å§“ååˆ—
        })
        
        df.to_excel(file_path, index=False, engine='openpyxl')
        return str(file_path)
    
    def test_write_to_file1(self, temp_excel_file):
        """æµ‹è¯•å†™å…¥æ–‡ä»¶1"""
        success = write_response_to_excel(
            temp_excel_file,
            1,  # æ–‡ä»¶ç±»å‹1
            2,  # ç¬¬2è¡Œï¼ˆExcelä¸­ç¬¬2è¡Œï¼ŒDataFrameç¬¬1è¡Œï¼‰
            "HW-001",  # å›æ–‡å•å·
            "æµ‹è¯•ç”¨æˆ·",
            "2016"
        )
        
        assert success
        
        # éªŒè¯å†™å…¥å†…å®¹
        wb = load_workbook(temp_excel_file)
        ws = wb.active
        
        assert ws['S2'].value == "HW-001"
        assert ws['N2'].value == date.today().strftime('%Y-%m-%d')
        assert ws['V2'].value == "æµ‹è¯•ç”¨æˆ·"
        
        wb.close()
    
    def test_write_to_nonexistent_file(self):
        """æµ‹è¯•å†™å…¥ä¸å­˜åœ¨çš„æ–‡ä»¶"""
        success = write_response_to_excel(
            "/path/to/nonexistent/file.xlsx",
            1,
            2,
            "HW-001",
            "æµ‹è¯•ç”¨æˆ·",
            "2016"
        )
        
        assert not success


class TestFile3SourceDetermination:
    """æµ‹è¯•æ–‡ä»¶3æ¥æºåˆ¤æ–­"""
    
    @pytest.fixture
    def temp_file3(self, tmp_path):
        """åˆ›å»ºä¸´æ—¶æ–‡ä»¶3"""
        file_path = tmp_path / "test_file3.xlsx"
        
        # åˆ›å»ºæµ‹è¯•æ•°æ®
        df = pd.DataFrame({
            'L': ['2025-10-28', '', '2025-11-01'],  # Låˆ—æ—¶é—´
            'M': ['', '2025-10-30', '2025-11-02'],  # Måˆ—æ—¶é—´
            'Q': ['', '2025-10-25', ''],  # Qåˆ—å›å¤æ—¶é—´
            'T': ['2025-10-26', '', '']   # Tåˆ—å›å¤æ—¶é—´
        })
        
        df.to_excel(file_path, index=False, engine='openpyxl')
        return str(file_path)
    
    def test_determine_m_source(self, temp_file3):
        """æµ‹è¯•åˆ¤æ–­ä¸ºMåˆ—æ¥æº"""
        wb = load_workbook(temp_file3)
        ws = wb.active
        
        columns = determine_file3_source_and_columns(3, ws)
        assert columns['response_col'] == 'V'  # Måˆ—æ¥æº
        
        wb.close()
    
    def test_determine_l_source(self, temp_file3):
        """æµ‹è¯•åˆ¤æ–­ä¸ºLåˆ—æ¥æº"""
        wb = load_workbook(temp_file3)
        ws = wb.active
        
        columns = determine_file3_source_and_columns(2, ws)
        assert columns['response_col'] == 'S'  # Låˆ—æ¥æº
        
        wb.close()
```

**è¿è¡Œæµ‹è¯•**:
```bash
pytest tests/test_input_handler.py -v
```

#### æ­¥éª¤2.7: æ‰‹åŠ¨éªŒè¯ï¼ˆ30åˆ†é’Ÿï¼‰

1. å¯åŠ¨ç¨‹åº
2. è¿›è¡Œä¸€æ¬¡ç­›é€‰
3. ç‚¹å‡»ä»»æ„æ¥å£å·
4. æ£€æŸ¥å¼¹çª—æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
5. è¾“å…¥å›æ–‡å•å·å¹¶ç¡®è®¤
6. æ‰“å¼€å¯¹åº”Excelæ–‡ä»¶ï¼ŒéªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®å†™å…¥
7. æµ‹è¯•6ç§æ–‡ä»¶ç±»å‹ï¼ˆç‰¹åˆ«æ˜¯æ–‡ä»¶3çš„M/Låˆ—åˆ¤æ–­ï¼‰
8. æµ‹è¯•å¹¶å‘åœºæ™¯ï¼ˆæ‰“å¼€Excelæ–‡ä»¶åï¼Œå†æ¬¡ç‚¹å‡»æ¥å£å·ï¼‰

#### é˜¶æ®µ2å®Œæˆæ ‡å¿—
- [ ] `input_handler.py` æ¨¡å—åˆ›å»ºå®Œæˆ
- [ ] æ–‡ä»¶3æ·»åŠ äº† `_source_column` æ ‡è®°
- [ ] window.pyç»‘å®šäº†ç‚¹å‡»äº‹ä»¶
- [ ] æ‰€æœ‰æ–‡ä»¶æ·»åŠ äº† `source_file` åˆ—
- [ ] æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- [ ] æ‰‹åŠ¨éªŒè¯6ç§æ–‡ä»¶ç±»å‹éƒ½èƒ½æ­£ç¡®å†™å…¥
- [ ] å¹¶å‘å†™å…¥ä¿æŠ¤ç”Ÿæ•ˆ

---

## é˜¶æ®µ3: ä»»åŠ¡æŒ‡æ´¾æ¨¡å—

### ç›®æ ‡
åˆ›å»º `distribution.py` æ¨¡å—ï¼Œå®ç°æ¥å£å·¥ç¨‹å¸ˆå’Œå®¤ä¸»ä»»çš„ä»»åŠ¡æŒ‡æ´¾åŠŸèƒ½ã€‚

### å‰ç½®æ¡ä»¶
- é˜¶æ®µ1å’Œé˜¶æ®µ2å·²å®Œæˆ
- å·²ç†è§£è§’è‰²æƒé™è¿‡æ»¤é€»è¾‘

### æ‰§è¡Œæ­¥éª¤

#### æ­¥éª¤3.1: åˆ›å»ºdistribution.pyï¼ˆ2å°æ—¶ï¼‰

**æ–‡ä»¶**: `distribution.py`

**å®Œæ•´ä»£ç ç»“æ„**: (ä»£ç å¤ªé•¿ï¼Œè§å®Œæ•´æ–‡ä»¶)

æ ¸å¿ƒç±»å’Œå‡½æ•°ï¼š
- `AssignmentDialog`: æŒ‡æ´¾ç•Œé¢
- `check_unassigned()`: æ£€æµ‹æœªæŒ‡æ´¾ä»»åŠ¡
- `get_name_list()`: è·å–å§“ååˆ—è¡¨
- `save_assignment()`: ä¿å­˜æŒ‡æ´¾ç»“æœ

#### æ­¥éª¤3.2: åœ¨file_manager.pyæ·»åŠ è®°å¿†åŠŸèƒ½ï¼ˆ30åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `file_manager.py`

**ä½ç½®**: `FileIdentityManager` ç±»

**æ·»åŠ å±æ€§**:
```python
def __init__(self, cache_file="file_cache.json", result_cache_dir="result_cache"):
    # ... ç°æœ‰ä»£ç  ...
    
    # ã€æ–°å¢ã€‘æ¥å£è®°å¿†åŠŸèƒ½ï¼ˆæ–‡ä»¶2ä¸“ç”¨ï¼‰
    self.interface_memory = {}  # {project_id_interface_id: assigned_name}
```

**æ·»åŠ æ–¹æ³•**:
```python
def save_interface_memory(self, cache_key, assigned_name):
    """ä¿å­˜æ¥å£æŒ‡æ´¾è®°å¿†"""
    self.interface_memory[cache_key] = assigned_name
    self._save_cache()

def get_interface_memory(self, cache_key):
    """è·å–æ¥å£æŒ‡æ´¾è®°å¿†"""
    return self.interface_memory.get(cache_key, "")

def clear_interface_memory(self):
    """æ¸…ç©ºæ¥å£è®°å¿†"""
    self.interface_memory = {}
    self._save_cache()
```

**ä¿®æ”¹ç¼“å­˜åŠ è½½å’Œä¿å­˜**:
```python
def _load_cache(self):
    # ... ç°æœ‰ä»£ç  ...
    
    # åŠ è½½æ¥å£è®°å¿†
    if 'interface_memory' in data:
        self.interface_memory = data['interface_memory']

def _save_cache(self):
    data = {
        'file_identities': self.file_identities,
        'completed_rows': self.completed_rows,
        'interface_memory': self.interface_memory  # æ–°å¢
    }
    # ... ä¿å­˜ä»£ç  ...
```

#### æ­¥éª¤3.3: åœ¨base.pyé›†æˆæŒ‡æ´¾åŠŸèƒ½ï¼ˆ2å°æ—¶ï¼‰

**æ­¥éª¤3.3.1**: æ·»åŠ æ£€æµ‹é€»è¾‘

**æ–‡ä»¶**: `base.py`

**ä½ç½®**: `start_processing()` æ–¹æ³•æœ«å°¾

**æ·»åŠ ä»£ç **:
```python
# ã€æ–°å¢ã€‘æ£€æµ‹æ˜¯å¦éœ€è¦æŒ‡æ´¾ä»»åŠ¡ï¼ˆä»…æ¥å£å·¥ç¨‹å¸ˆå’Œå®¤ä¸»ä»»ï¼‰
if self._should_show_assignment_reminder():
    self._show_assignment_reminder()
```

**æ·»åŠ æ–¹æ³•**:
```python
def _should_show_assignment_reminder(self):
    """åˆ¤æ–­æ˜¯å¦éœ€è¦æ˜¾ç¤ºæŒ‡æ´¾æé†’"""
    # æ£€æŸ¥è§’è‰²
    user_roles = getattr(self, 'user_roles', [])
    
    # åªæœ‰æ¥å£å·¥ç¨‹å¸ˆå’Œå®¤ä¸»ä»»éœ€è¦æŒ‡æ´¾
    has_assignment_role = any(
        role in ['ä¸€å®¤ä¸»ä»»', 'äºŒå®¤ä¸»ä»»', 'å»ºç­‘æ€»å›¾å®¤ä¸»ä»»'] or 
        'æ¥å£å·¥ç¨‹å¸ˆ' in role
        for role in user_roles
    )
    
    if not has_assignment_role:
        return False
    
    # æ£€æŸ¥æ˜¯å¦æœ‰æœªæŒ‡æ´¾ä»»åŠ¡
    unassigned = self._check_unassigned_tasks()
    return len(unassigned) > 0

def _check_unassigned_tasks(self):
    """æ£€æµ‹æœªæŒ‡æ´¾ä»»åŠ¡"""
    from distribution import check_unassigned
    
    # æ”¶é›†æ‰€æœ‰å¤„ç†ç»“æœ
    processed_results = {}
    for i in range(1, 7):
        result_attr = f'processing_results{i}'
        if hasattr(self, result_attr):
            df = getattr(self, result_attr)
            if df is not None and not df.empty:
                processed_results[i] = df
    
    # æ£€æµ‹æœªæŒ‡æ´¾ä»»åŠ¡
    user_roles = getattr(self, 'user_roles', [])
    project_id = self._get_my_project_id()
    
    unassigned = check_unassigned(processed_results, user_roles, project_id)
    return unassigned

def _get_my_project_id(self):
    """è·å–æ¥å£å·¥ç¨‹å¸ˆè´Ÿè´£çš„é¡¹ç›®å·"""
    user_roles = getattr(self, 'user_roles', [])
    
    for role in user_roles:
        if 'æ¥å£å·¥ç¨‹å¸ˆ' in role:
            # æå–é¡¹ç›®å·ï¼ˆå¦‚"2016æ¥å£å·¥ç¨‹å¸ˆ" â†’ "2016"ï¼‰
            project_id = self._parse_interface_engineer_role(role)
            if project_id:
                return project_id
    
    return None

def _show_assignment_reminder(self):
    """æ˜¾ç¤ºæŒ‡æ´¾æé†’å¼¹çª—"""
    from tkinter import messagebox
    from distribution import AssignmentDialog, get_name_list
    
    unassigned = self._check_unassigned_tasks()
    count = len(unassigned)
    
    # æé†’å¼¹çª—
    result = messagebox.askyesno(
        "ä»»åŠ¡æŒ‡æ´¾æé†’",
        f"æ‚¨æœ‰ {count} ä¸ªéœ€è¦æŒ‡æ´¾çš„æ¥å£ä»»åŠ¡\nè¯·æ³¨æ„\n\næ˜¯å¦ç°åœ¨æŒ‡æ´¾ï¼Ÿ",
        parent=self.root
    )
    
    if result:
        # ç°åœ¨æŒ‡æ´¾
        name_list = get_name_list()
        dialog = AssignmentDialog(
            self.root,
            unassigned,
            self.file_manager,
            name_list
        )
        dialog.wait_window()
    else:
        # å–æ¶ˆ - æ˜¾ç¤º"æŒ‡æ´¾ä»»åŠ¡"æŒ‰é’®
        self._show_assignment_button()

def _show_assignment_button(self):
    """æ˜¾ç¤º"æŒ‡æ´¾ä»»åŠ¡"æŒ‰é’®"""
    if hasattr(self, '_assignment_button') and self._assignment_button:
        # æŒ‰é’®å·²å­˜åœ¨
        return
    
    # åˆ›å»ºæŒ‰é’®
    import tkinter as tk
    from tkinter import ttk
    
    button_frame = ttk.Frame(self.root)
    button_frame.pack(side='bottom', fill='x', pady=5)
    
    self._assignment_button = ttk.Button(
        button_frame,
        text="æŒ‡æ´¾ä»»åŠ¡",
        command=self._on_assignment_button_click
    )
    self._assignment_button.pack(side='right', padx=10)

def _on_assignment_button_click(self):
    """æŒ‡æ´¾ä»»åŠ¡æŒ‰é’®ç‚¹å‡»"""
    from distribution import AssignmentDialog, get_name_list
    
    unassigned = self._check_unassigned_tasks()
    if not unassigned:
        messagebox.showinfo("æç¤º", "å½“å‰æ²¡æœ‰éœ€è¦æŒ‡æ´¾çš„ä»»åŠ¡", parent=self.root)
        return
    
    name_list = get_name_list()
    dialog = AssignmentDialog(
        self.root,
        unassigned,
        self.file_manager,
        name_list
    )
    dialog.wait_window()
```

**æ­¥éª¤3.3.2**: è‡ªåŠ¨æ¨¡å¼é›†æˆ

**ä½ç½®**: `update_display()` æ–¹æ³•

```python
def update_display(self):
    """è‡ªåŠ¨æ¨¡å¼ä¸‹æ›´æ–°æ˜¾ç¤º"""
    # ... ç°æœ‰ä»£ç  ...
    
    # å¯¼å‡ºç»“æœ
    if self.export_after_processing_var.get():
        self.export_results()
    
    # ã€æ–°å¢ã€‘æ£€æµ‹æŒ‡æ´¾ä»»åŠ¡ï¼ˆåœ¨å¯¼å‡ºåï¼‰
    if self._should_show_assignment_reminder():
        self.root.after(1000, self._show_assignment_reminder)  # å»¶è¿Ÿ1ç§’
```

#### æ­¥éª¤3.4: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆ1.5å°æ—¶ï¼‰

**æ–‡ä»¶**: `tests/test_distribution.py`

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä»»åŠ¡æŒ‡æ´¾åŠŸèƒ½æµ‹è¯•
"""

import pytest
import pandas as pd
from distribution import (
    check_unassigned,
    get_name_list,
    get_responsible_column
)


class TestCheckUnassigned:
    """æµ‹è¯•æ£€æµ‹æœªæŒ‡æ´¾ä»»åŠ¡"""
    
    def test_detect_empty_responsible(self):
        """æµ‹è¯•æ£€æµ‹è´£ä»»äººä¸ºç©ºçš„æ•°æ®"""
        df = pd.DataFrame({
            'é¡¹ç›®å·': ['2016', '2016', '2026'],
            'æ¥å£å·': ['INT-001', 'INT-002', 'INT-003'],
            'è´£ä»»äºº': ['ç‹ä»»è¶…', '', None],
            'ç§‘å®¤': ['ç»“æ„ä¸€å®¤', 'ç»“æ„ä¸€å®¤', 'ç»“æ„äºŒå®¤'],
            'åŸå§‹è¡Œå·': [2, 3, 4],
            'source_file': ['file1.xlsx'] * 3
        })
        
        processed_results = {1: df}
        user_roles = ['ä¸€å®¤ä¸»ä»»']
        
        unassigned = check_unassigned(processed_results, user_roles)
        
        assert len(unassigned) == 1
        assert unassigned[0]['interface_id'] == 'INT-002'
    
    def test_interface_engineer_filter(self):
        """æµ‹è¯•æ¥å£å·¥ç¨‹å¸ˆåªçœ‹è‡ªå·±é¡¹ç›®"""
        df = pd.DataFrame({
            'é¡¹ç›®å·': ['2016', '2016', '2026'],
            'æ¥å£å·': ['INT-001', 'INT-002', 'INT-003'],
            'è´£ä»»äºº': ['', '', ''],
            'ç§‘å®¤': ['ç»“æ„ä¸€å®¤'] * 3,
            'åŸå§‹è¡Œå·': [2, 3, 4],
            'source_file': ['file1.xlsx'] * 3
        })
        
        processed_results = {1: df}
        user_roles = ['2016æ¥å£å·¥ç¨‹å¸ˆ']
        project_id = '2016'
        
        unassigned = check_unassigned(processed_results, user_roles, project_id)
        
        assert len(unassigned) == 2
        assert all(task['project_id'] == '2016' for task in unassigned)
    
    def test_director_filter(self):
        """æµ‹è¯•å®¤ä¸»ä»»åªçœ‹è‡ªå·±ç§‘å®¤"""
        df = pd.DataFrame({
            'é¡¹ç›®å·': ['2016'] * 4,
            'æ¥å£å·': ['INT-001', 'INT-002', 'INT-003', 'INT-004'],
            'è´£ä»»äºº': ['', '', '', ''],
            'ç§‘å®¤': ['ç»“æ„ä¸€å®¤', 'ç»“æ„äºŒå®¤', 'è¯·å®¤ä¸»ä»»ç¡®è®¤', 'å»ºç­‘æ€»å›¾å®¤'],
            'åŸå§‹è¡Œå·': [2, 3, 4, 5],
            'source_file': ['file1.xlsx'] * 4
        })
        
        processed_results = {1: df}
        user_roles = ['ä¸€å®¤ä¸»ä»»']
        
        unassigned = check_unassigned(processed_results, user_roles)
        
        assert len(unassigned) == 2
        interfaces = [task['interface_id'] for task in unassigned]
        assert 'INT-001' in interfaces  # ç»“æ„ä¸€å®¤
        assert 'INT-003' in interfaces  # è¯·å®¤ä¸»ä»»ç¡®è®¤


class TestGetNameList:
    """æµ‹è¯•è·å–å§“ååˆ—è¡¨"""
    
    def test_get_name_list(self):
        """æµ‹è¯•ä»å§“åè§’è‰²è¡¨è¯»å–å§“å"""
        names = get_name_list()
        assert isinstance(names, list)
        assert len(names) > 0
        # å‡è®¾è¡¨ä¸­æœ‰"ç‹ä»»è¶…"
        # assert "ç‹ä»»è¶…" in names


class TestResponsibleColumn:
    """æµ‹è¯•è´£ä»»äººåˆ—ä½ç½®"""
    
    def test_file1_responsible_column(self):
        """æµ‹è¯•æ–‡ä»¶1è´£ä»»äººåˆ—"""
        col = get_responsible_column(1)
        assert col == 'R'
    
    def test_file2_no_responsible_column(self):
        """æµ‹è¯•æ–‡ä»¶2æ— è´£ä»»äººåˆ—"""
        col = get_responsible_column(2)
        assert col is None
    
    def test_file3_responsible_column(self):
        """æµ‹è¯•æ–‡ä»¶3è´£ä»»äººåˆ—"""
        col = get_responsible_column(3)
        assert col == 'AP'
```

**è¿è¡Œæµ‹è¯•**:
```bash
pytest tests/test_distribution.py -v
```

#### æ­¥éª¤3.5: æ‰‹åŠ¨éªŒè¯ï¼ˆ1å°æ—¶ï¼‰

1. **å‡†å¤‡æµ‹è¯•æ•°æ®**: åˆ›å»ºåŒ…å«æ— è´£ä»»äººæ•°æ®çš„Excelæ–‡ä»¶
2. **æµ‹è¯•æ¥å£å·¥ç¨‹å¸ˆ**:
   - ç™»å½•ä¸ºæ¥å£å·¥ç¨‹å¸ˆè§’è‰²
   - è¿›è¡Œç­›é€‰
   - æ£€æŸ¥æ˜¯å¦å¼¹å‡ºæŒ‡æ´¾æé†’
   - ç‚¹å‡»"ç°åœ¨æŒ‡æ´¾"
   - æ£€æŸ¥åˆ—è¡¨æ˜¯å¦åªæ˜¾ç¤ºè‡ªå·±é¡¹ç›®çš„æ•°æ®
   - é€‰æ‹©å§“åå¹¶æŒ‡æ´¾
   - éªŒè¯Excelæ–‡ä»¶æ˜¯å¦æ­£ç¡®å†™å…¥
3. **æµ‹è¯•å®¤ä¸»ä»»**:
   - ç™»å½•ä¸ºå®¤ä¸»ä»»è§’è‰²
   - è¿›è¡Œç­›é€‰
   - æ£€æŸ¥æ˜¯å¦å¼¹å‡ºæŒ‡æ´¾æé†’
   - æ£€æŸ¥åˆ—è¡¨æ˜¯å¦åªæ˜¾ç¤ºè‡ªå·±ç§‘å®¤çš„æ•°æ®
   - æŒ‡æ´¾ä»»åŠ¡
4. **æµ‹è¯•æ–‡ä»¶2è®°å¿†åŠŸèƒ½**:
   - æŒ‡æ´¾æ–‡ä»¶2çš„æŸä¸ªæ¥å£ç»™"ç‹ä»»è¶…"
   - å†æ¬¡æ‰“å¼€æŒ‡æ´¾ç•Œé¢
   - æ£€æŸ¥è¯¥æ¥å£æ˜¯å¦è‡ªåŠ¨å¡«å……"ç‹ä»»è¶…"
5. **æµ‹è¯•"å–æ¶ˆ"æŒ‰é’®**:
   - ç‚¹å‡»å–æ¶ˆå…³é—­æŒ‡æ´¾å¼¹çª—
   - æ£€æŸ¥"æŒ‡æ´¾ä»»åŠ¡"æŒ‰é’®æ˜¯å¦æ˜¾ç¤º
   - ç‚¹å‡»"æŒ‡æ´¾ä»»åŠ¡"æŒ‰é’®
   - æ£€æŸ¥æŒ‡æ´¾ç•Œé¢æ˜¯å¦é‡æ–°æ‰“å¼€
6. **æµ‹è¯•å®æ—¶æœç´¢**:
   - åœ¨æŒ‡æ´¾ç•Œé¢çš„ä¸‹æ‹‰æ¡†ä¸­è¾“å…¥"ç‹"
   - æ£€æŸ¥æ˜¯å¦åªæ˜¾ç¤º"ç‹"å¼€å¤´çš„å§“å
7. **æµ‹è¯•è‡ªåŠ¨æ¨¡å¼**:
   - å¯ç”¨è‡ªåŠ¨æ¨¡å¼
   - ç­‰å¾…è‡ªåŠ¨ç­›é€‰å®Œæˆ
   - æ£€æŸ¥å¯¼å‡ºåæ˜¯å¦å¼¹å‡ºæŒ‡æ´¾æé†’

#### é˜¶æ®µ3å®Œæˆæ ‡å¿—
- [ ] `distribution.py` æ¨¡å—åˆ›å»ºå®Œæˆ
- [ ] file_manager.pyæ·»åŠ äº†è®°å¿†åŠŸèƒ½
- [ ] base.pyé›†æˆäº†æŒ‡æ´¾æ£€æµ‹å’Œæé†’
- [ ] "æŒ‡æ´¾ä»»åŠ¡"æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- [ ] å®æ—¶æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶2è®°å¿†åŠŸèƒ½æ­£å¸¸
- [ ] æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- [ ] æ‰‹åŠ¨éªŒè¯é€šè¿‡

---

## é˜¶æ®µ4: æŒ‡æ´¾è¿½è¸ªåŠŸèƒ½

### ç›®æ ‡
å®ç°æ¥å£å·¥ç¨‹å¸ˆå’Œå®¤ä¸»ä»»æŸ¥çœ‹å·²æŒ‡æ´¾ä»»åŠ¡çš„å®ŒæˆçŠ¶æ€ã€‚

### å‰ç½®æ¡ä»¶
- é˜¶æ®µ3å·²å®Œæˆ

### æ‰§è¡Œæ­¥éª¤

#### æ­¥éª¤4.1: åœ¨base.pyæ·»åŠ è¿½è¸ªå…¥å£ï¼ˆ30åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `base.py`

**ä½ç½®**: èœå•æ æˆ–å·¥å…·æ 

**æ·»åŠ èœå•é¡¹**:
```python
# åœ¨setup_menu()æ–¹æ³•ä¸­æ·»åŠ 
def setup_menu(self):
    # ... ç°æœ‰ä»£ç  ...
    
    # ã€æ–°å¢ã€‘ä»»åŠ¡è¿½è¸ªèœå•
    track_menu = tk.Menu(menubar, tearoff=0)
    menubar.add_cascade(label="ä»»åŠ¡è¿½è¸ª", menu=track_menu)
    
    track_menu.add_command(label="æŸ¥çœ‹å·²æŒ‡æ´¾ä»»åŠ¡", command=self.show_assigned_tasks)
    track_menu.add_separator()
    track_menu.add_command(label="åˆ·æ–°è¿½è¸ª", command=self.refresh_tracking)
```

**æ·»åŠ æ–¹æ³•**:
```python
def show_assigned_tasks(self):
    """æ˜¾ç¤ºå·²æŒ‡æ´¾ä»»åŠ¡è¿½è¸ª"""
    from distribution import show_tracking_dialog
    
    # æ”¶é›†æ‰€æœ‰å¤„ç†ç»“æœ
    processed_results = {}
    for i in range(1, 7):
        result_attr = f'processing_results{i}'
        if hasattr(self, result_attr):
            df = getattr(self, result_attr)
            if df is not None and not df.empty:
                processed_results[i] = df
    
    user_roles = getattr(self, 'user_roles', [])
    project_id = self._get_my_project_id()
    
    show_tracking_dialog(self.root, processed_results, user_roles, project_id)

def refresh_tracking(self):
    """åˆ·æ–°è¿½è¸ªæ•°æ®"""
    # é‡æ–°å¤„ç†æ•°æ®
    self.start_processing()
    # æ˜¾ç¤ºè¿½è¸ªç•Œé¢
    self.show_assigned_tasks()
```

#### æ­¥éª¤4.2: åœ¨distribution.pyæ·»åŠ è¿½è¸ªåŠŸèƒ½ï¼ˆ1.5å°æ—¶ï¼‰

**æ–‡ä»¶**: `distribution.py`

**æ·»åŠ ç±»**:
```python
class TrackingDialog(tk.Toplevel):
    """ä»»åŠ¡è¿½è¸ªç•Œé¢"""
    
    def __init__(self, parent, assigned_tasks):
        """
        å‚æ•°:
            parent: çˆ¶çª—å£
            assigned_tasks: å·²æŒ‡æ´¾ä»»åŠ¡åˆ—è¡¨
        """
        super().__init__(parent)
        
        self.assigned_tasks = assigned_tasks
        self.setup_ui()
    
    def setup_ui(self):
        """è®¾ç½®ç•Œé¢"""
        self.title("ä»»åŠ¡è¿½è¸ª")
        self.geometry("900x600")
        
        # æ ‡é¢˜
        title_label = ttk.Label(
            self,
            text=f"å·²æŒ‡æ´¾ä»»åŠ¡è¿½è¸ªï¼ˆå…±{len(self.assigned_tasks)}ä¸ªï¼‰",
            font=('Arial', 14, 'bold')
        )
        title_label.pack(pady=10)
        
        # åˆ›å»ºTreeview
        columns = ('é¡¹ç›®å·', 'æ¥å£å·', 'è´£ä»»äºº', 'æŒ‡æ´¾çŠ¶æ€', 'æ¥å£æ—¶é—´')
        
        tree_frame = ttk.Frame(self)
        tree_frame.pack(fill='both', expand=True, padx=10, pady=10)
        
        # æ»šåŠ¨æ¡
        scrollbar = ttk.Scrollbar(tree_frame)
        scrollbar.pack(side='right', fill='y')
        
        self.tree = ttk.Treeview(
            tree_frame,
            columns=columns,
            show='headings',
            yscrollcommand=scrollbar.set
        )
        scrollbar.config(command=self.tree.yview)
        
        # è®¾ç½®åˆ—æ ‡é¢˜
        for col in columns:
            self.tree.heading(col, text=col)
            self.tree.column(col, width=150, anchor='center')
        
        self.tree.pack(fill='both', expand=True)
        
        # å¡«å……æ•°æ®
        self.populate_data()
        
        # å…³é—­æŒ‰é’®
        ttk.Button(self, text="å…³é—­", command=self.destroy).pack(pady=10)
    
    def populate_data(self):
        """å¡«å……æ•°æ®"""
        for task in self.assigned_tasks:
            values = (
                task.get('project_id', ''),
                task.get('interface_id', ''),
                task.get('responsible', ''),
                task.get('status', ''),
                task.get('interface_time', '')
            )
            self.tree.insert('', 'end', values=values)


def get_assigned_tasks_with_status(processed_results, user_roles, project_id=None):
    """
    è·å–å·²æŒ‡æ´¾ä»»åŠ¡åŠå…¶å®ŒæˆçŠ¶æ€
    
    è¿”å›:
        list: ä»»åŠ¡åˆ—è¡¨ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…å«statuså­—æ®µï¼ˆ"å·²å®Œæˆ"æˆ–"å¾…å®Œæˆ"ï¼‰
    """
    assigned_tasks = []
    
    for file_type, df in processed_results.items():
        if df is None or df.empty:
            continue
        
        # ç­›é€‰æœ‰è´£ä»»äººçš„æ•°æ®
        has_responsible = (df['è´£ä»»äºº'].notna()) & (df['è´£ä»»äºº'].astype(str).str.strip() != '') & (df['è´£ä»»äºº'].astype(str).str.strip() != 'æ— ')
        df_assigned = df[has_responsible].copy()
        
        if df_assigned.empty:
            continue
        
        # è§’è‰²æƒé™è¿‡æ»¤
        if is_interface_engineer(user_roles):
            df_assigned = df_assigned[df_assigned['é¡¹ç›®å·'] == project_id]
        elif is_director(user_roles):
            my_department = get_department(user_roles)
            df_assigned = df_assigned[df_assigned['ç§‘å®¤'].isin([my_department, 'è¯·å®¤ä¸»ä»»ç¡®è®¤'])]
        
        # åˆ¤æ–­å®ŒæˆçŠ¶æ€ï¼ˆåŸºäºå›å¤æ—¶é—´åˆ—ï¼‰
        reply_time_col = get_reply_time_column(file_type)
        
        for idx, row in df_assigned.iterrows():
            # æ£€æŸ¥å›å¤æ—¶é—´åˆ—
            reply_time = row.get(reply_time_col, '')
            
            if pd.notna(reply_time) and str(reply_time).strip() != '':
                status = "âœ… å·²å®Œæˆ"
            else:
                status = "â³ å¾…å®Œæˆ"
            
            assigned_tasks.append({
                'file_type': file_type,
                'project_id': row.get('é¡¹ç›®å·', ''),
                'interface_id': row.get('æ¥å£å·', ''),
                'responsible': row.get('è´£ä»»äºº', ''),
                'status': status,
                'interface_time': row.get('æ¥å£æ—¶é—´', ''),
                'file_path': row.get('source_file', ''),
                'row_index': row.get('åŸå§‹è¡Œå·', 0)
            })
    
    return assigned_tasks


def get_reply_time_column(file_type):
    """è·å–å›å¤æ—¶é—´åˆ—åï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦å®Œæˆï¼‰"""
    # å›å¤æ—¶é—´åˆ—ä¸åœ¨DataFrameä¸­ï¼Œéœ€è¦ä»åŸå§‹Excelè¯»å–
    # è¿™é‡Œè¿”å›åº”è¯¥æ£€æŸ¥çš„åˆ—ç´¢å¼•
    reply_time_map = {
        1: 13,  # Nåˆ—
        2: 13,  # Nåˆ—
        3: (16, 19),  # Qåˆ—æˆ–Tåˆ—
        4: 21,  # Våˆ—
        5: 13,  # Nåˆ—
        6: 9    # Jåˆ—
    }
    return reply_time_map.get(file_type, 13)


def show_tracking_dialog(parent, processed_results, user_roles, project_id=None):
    """æ˜¾ç¤ºè¿½è¸ªå¯¹è¯æ¡†"""
    assigned_tasks = get_assigned_tasks_with_status(processed_results, user_roles, project_id)
    
    if not assigned_tasks:
        messagebox.showinfo("æç¤º", "å½“å‰æ²¡æœ‰å·²æŒ‡æ´¾çš„ä»»åŠ¡", parent=parent)
        return
    
    dialog = TrackingDialog(parent, assigned_tasks)
    dialog.wait_window()
```

#### æ­¥éª¤4.3: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆ45åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `tests/test_tracking.py`

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä»»åŠ¡è¿½è¸ªåŠŸèƒ½æµ‹è¯•
"""

import pytest
import pandas as pd
from distribution import (
    get_assigned_tasks_with_status,
    get_reply_time_column
)


class TestTracking:
    """æµ‹è¯•ä»»åŠ¡è¿½è¸ªåŠŸèƒ½"""
    
    def test_detect_completed_tasks(self):
        """æµ‹è¯•æ£€æµ‹å·²å®Œæˆä»»åŠ¡"""
        df = pd.DataFrame({
            'é¡¹ç›®å·': ['2016', '2016'],
            'æ¥å£å·': ['INT-001', 'INT-002'],
            'è´£ä»»äºº': ['ç‹ä»»è¶…', 'æå››'],
            'æ¥å£æ—¶é—´': ['10.28', '10.29'],
            'ç§‘å®¤': ['ç»“æ„ä¸€å®¤', 'ç»“æ„ä¸€å®¤'],
            'åŸå§‹è¡Œå·': [2, 3],
            'source_file': ['file1.xlsx'] * 2,
            # å›å¤æ—¶é—´åˆ—ï¼ˆéœ€è¦ä»åŸå§‹Excelè¯»å–ï¼Œè¿™é‡Œæ¨¡æ‹Ÿï¼‰
            '_reply_time': ['2025-10-29', '']  # ç¬¬ä¸€ä¸ªå·²å®Œæˆï¼Œç¬¬äºŒä¸ªå¾…å®Œæˆ
        })
        
        processed_results = {1: df}
        user_roles = ['ä¸€å®¤ä¸»ä»»']
        
        # è¿™é‡Œéœ€è¦ä¿®æ”¹get_assigned_tasks_with_statusæ¥æ”¯æŒ_reply_timeåˆ—
        # å®é™…å®ç°æ—¶éœ€è¦ä»åŸå§‹Excelè¯»å–
        
        # ç®€åŒ–æµ‹è¯•
        has_reply = df['_reply_time'].notna() & (df['_reply_time'].astype(str).str.strip() != '')
        assert has_reply.iloc[0] == True
        assert has_reply.iloc[1] == False
    
    def test_get_reply_time_column(self):
        """æµ‹è¯•è·å–å›å¤æ—¶é—´åˆ—"""
        assert get_reply_time_column(1) == 13  # Nåˆ—
        assert get_reply_time_column(2) == 13
        assert get_reply_time_column(3) == (16, 19)  # Qæˆ–Tåˆ—
        assert get_reply_time_column(4) == 21
        assert get_reply_time_column(5) == 13
        assert get_reply_time_column(6) == 9
```

#### æ­¥éª¤4.4: æ‰‹åŠ¨éªŒè¯ï¼ˆ30åˆ†é’Ÿï¼‰

1. å…ˆå®Œæˆé˜¶æ®µ3çš„æŒ‡æ´¾æ“ä½œ
2. ä½¿ç”¨input_handlerè¾“å…¥å›æ–‡å•å·ï¼ˆæ ‡è®°ä¸ºå·²å®Œæˆï¼‰
3. æ‰“å¼€"ä»»åŠ¡è¿½è¸ª"èœå•
4. æ£€æŸ¥å·²å®Œæˆå’Œå¾…å®Œæˆçš„ä»»åŠ¡æ˜¾ç¤ºæ˜¯å¦æ­£ç¡®
5. éªŒè¯ç­›é€‰é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼ˆæ¥å£å·¥ç¨‹å¸ˆ/å®¤ä¸»ä»»ï¼‰

#### é˜¶æ®µ4å®Œæˆæ ‡å¿—
- [ ] è¿½è¸ªåŠŸèƒ½èœå•æ·»åŠ å®Œæˆ
- [ ] TrackingDialogç•Œé¢åˆ›å»ºå®Œæˆ
- [ ] å®ŒæˆçŠ¶æ€åˆ¤æ–­é€»è¾‘æ­£ç¡®
- [ ] æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [ ] æ‰‹åŠ¨éªŒè¯é€šè¿‡

---

## é˜¶æ®µ5: ç¼“å­˜é€‚é…ä¸é›†æˆ

### ç›®æ ‡
ç¡®ä¿æ–°åŠŸèƒ½ä¸ç°æœ‰ç¼“å­˜æœºåˆ¶å…¼å®¹ï¼Œé€‚é…è‡ªåŠ¨è¿è¡Œæ¨¡å¼ã€‚

### å‰ç½®æ¡ä»¶
- é˜¶æ®µ1-4å·²å®Œæˆ

### æ‰§è¡Œæ­¥éª¤

#### æ­¥éª¤5.1: éªŒè¯ç¼“å­˜å¤±æ•ˆæœºåˆ¶ï¼ˆ30åˆ†é’Ÿï¼‰

**æµ‹è¯•åœºæ™¯**:
1. è¾“å…¥å›æ–‡å•å·åï¼ŒExcelæ–‡ä»¶ä¿®æ”¹æ—¶é—´æ”¹å˜
2. å†æ¬¡ç­›é€‰æ—¶ï¼Œç¼“å­˜åº”è¯¥å¤±æ•ˆ
3. é‡æ–°è¯»å–Excelï¼Œæ–°æ•°æ®åº”è¯¥ç”Ÿæ•ˆ

**éªŒè¯ä»£ç **:
```python
# 1. ç¬¬ä¸€æ¬¡ç­›é€‰
result1 = process_target_file1(file_path, datetime.now())

# 2. è¾“å…¥å›æ–‡å•å·ï¼ˆä¿®æ”¹Excelï¼‰
write_response_to_excel(file_path, 1, 2, "HW-001", "æµ‹è¯•ç”¨æˆ·", "2016")

# 3. ç¬¬äºŒæ¬¡ç­›é€‰
result2 = process_target_file1(file_path, datetime.now())

# éªŒè¯ï¼šæ–‡ä»¶å“ˆå¸Œåº”è¯¥ä¸åŒ
identity1 = file_manager.generate_file_identity(file_path)
identity2 = file_manager.generate_file_identity(file_path)
assert identity1 != identity2
```

#### æ­¥éª¤5.2: éªŒè¯è‡ªåŠ¨æ¨¡å¼é›†æˆï¼ˆ30åˆ†é’Ÿï¼‰

**æµ‹è¯•æ­¥éª¤**:
1. å¯ç”¨è‡ªåŠ¨æ¨¡å¼
2. è®¾ç½®2åˆ†é’Ÿåˆ·æ–°é—´éš”
3. ç­‰å¾…ç¬¬ä¸€æ¬¡è‡ªåŠ¨ç­›é€‰å®Œæˆ
4. æ£€æŸ¥æ˜¯å¦å¼¹å‡ºæŒ‡æ´¾æé†’ï¼ˆå¦‚æœæœ‰æœªæŒ‡æ´¾ä»»åŠ¡ï¼‰
5. æŒ‡æ´¾ä»»åŠ¡åï¼Œç­‰å¾…ä¸‹æ¬¡è‡ªåŠ¨åˆ·æ–°
6. æ£€æŸ¥æŒ‡æ´¾çš„ä»»åŠ¡æ˜¯å¦ç”Ÿæ•ˆ

#### æ­¥éª¤5.3: éªŒè¯å¹¶å‘åœºæ™¯ï¼ˆ30åˆ†é’Ÿï¼‰

**åœºæ™¯1**: å¤šä¸ªç”¨æˆ·åŒæ—¶è¾“å…¥å›æ–‡å•å·
- ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼šæ­£å¸¸å†™å…¥
- ç¬¬äºŒä¸ªç”¨æˆ·ï¼šæ”¶åˆ°"æ–‡ä»¶å ç”¨"æç¤º

**åœºæ™¯2**: ç”¨æˆ·è¾“å…¥å›æ–‡å•å·æ—¶ï¼Œè‡ªåŠ¨åˆ·æ–°è§¦å‘
- åº”è¯¥ç­‰å¾…è¾“å…¥å®Œæˆåå†åˆ·æ–°

#### æ­¥éª¤5.4: éªŒè¯å‹¾é€‰çŠ¶æ€éš”ç¦»ï¼ˆ15åˆ†é’Ÿï¼‰

**æµ‹è¯•æ­¥éª¤**:
1. ç”¨æˆ·Aç™»å½•ï¼Œå‹¾é€‰æŸäº›è¡Œ
2. åˆ‡æ¢åˆ°ç”¨æˆ·B
3. ç”¨æˆ·Bçš„ç•Œé¢åº”è¯¥çœ‹ä¸åˆ°ç”¨æˆ·Açš„å‹¾é€‰
4. ç”¨æˆ·BæŒ‡æ´¾ä»»åŠ¡åï¼Œä¸åº”è¯¥å½±å“ç”¨æˆ·A

#### æ­¥éª¤5.5: è¿è¡Œå…¨é‡æµ‹è¯•ï¼ˆ15åˆ†é’Ÿï¼‰

```bash
pytest -v
```

**é¢„æœŸç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆæ–°å¢çº¦30ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰

#### é˜¶æ®µ5å®Œæˆæ ‡å¿—
- [ ] ç¼“å­˜å¤±æ•ˆæœºåˆ¶æ­£å¸¸
- [ ] è‡ªåŠ¨æ¨¡å¼é›†æˆæˆåŠŸ
- [ ] å¹¶å‘åœºæ™¯å¤„ç†æ­£ç¡®
- [ ] å‹¾é€‰çŠ¶æ€éš”ç¦»æ­£å¸¸
- [ ] å…¨é‡æµ‹è¯•é€šè¿‡

---

## é˜¶æ®µ6: æ‰“åŒ…ä¸éªŒæ”¶

### ç›®æ ‡
æ›´æ–°æ‰“åŒ…é…ç½®ï¼Œç”ŸæˆEXEï¼Œå…¨é¢éªŒæ”¶åŠŸèƒ½ã€‚

### å‰ç½®æ¡ä»¶
- é˜¶æ®µ1-5å·²å®Œæˆ

### æ‰§è¡Œæ­¥éª¤

#### æ­¥éª¤6.1: æ›´æ–°æ‰“åŒ…é…ç½®ï¼ˆ15åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `excel_processor.spec`

**ä¿®æ”¹**:
```python
a = Analysis(
    ['base.py'],
    pathex=[],
    binaries=[],
    datas=[
        ('ico_bin', 'ico_bin'),
        ('excel_bin', 'excel_bin'),
        ('config.json', '.'),
    ],
    hiddenimports=[
        'pandas',
        'numpy',
        'openpyxl',
        'pystray',
        'PIL',
        'input_handler',      # æ–°å¢
        'distribution',       # æ–°å¢
    ],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    noarchive=False,
)
```

#### æ­¥éª¤6.2: æ‰§è¡Œæ‰“åŒ…ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
pyinstaller -y excel_processor.spec
```

**æ£€æŸ¥è¾“å‡º**:
- `dist/æ¥å£ç­›é€‰/æ¥å£ç­›é€‰.exe` æ˜¯å¦ç”Ÿæˆ
- æ–‡ä»¶å¤§å°æ˜¯å¦åˆç†ï¼ˆçº¦150MBï¼‰

#### æ­¥éª¤6.3: EXEåŠŸèƒ½éªŒæ”¶ï¼ˆ1å°æ—¶ï¼‰

**éªŒæ”¶æ¸…å•**:

**åŸºç¡€åŠŸèƒ½**:
- [ ] ç¨‹åºå¯åŠ¨æ­£å¸¸
- [ ] åŠ è½½é…ç½®æ­£å¸¸
- [ ] æ‰«ææ–‡ä»¶å¤¹æ­£å¸¸
- [ ] å¼€å§‹ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [ ] å¯¼å‡ºç»“æœåŠŸèƒ½æ­£å¸¸

**æ–°åŠŸèƒ½ - è´£ä»»äººåˆ—**:
- [ ] 6ä¸ªé€‰é¡¹å¡éƒ½æ˜¾ç¤ºè´£ä»»äººåˆ—
- [ ] åˆ—ä½ç½®æ­£ç¡®
- [ ] æ•°æ®æ­£ç¡®
- [ ] ç©ºå€¼æ˜¾ç¤º"æ— "

**æ–°åŠŸèƒ½ - å›æ–‡å•å·è¾“å…¥**:
- [ ] ç‚¹å‡»æ¥å£å·å¼¹å‡ºè¾“å…¥æ¡†
- [ ] è¾“å…¥å›æ–‡å•å·å¹¶ä¿å­˜
- [ ] Excelæ–‡ä»¶æ­£ç¡®å†™å…¥ï¼ˆ6ç§æ–‡ä»¶ç±»å‹ï¼‰
- [ ] æ–‡ä»¶3çš„M/Låˆ—åˆ¤æ–­æ­£ç¡®
- [ ] å¹¶å‘ä¿æŠ¤ç”Ÿæ•ˆ

**æ–°åŠŸèƒ½ - ä»»åŠ¡æŒ‡æ´¾**:
- [ ] æ¥å£å·¥ç¨‹å¸ˆçœ‹åˆ°æŒ‡æ´¾æé†’
- [ ] å®¤ä¸»ä»»çœ‹åˆ°æŒ‡æ´¾æé†’
- [ ] æŒ‡æ´¾ç•Œé¢æ˜¾ç¤ºæ­£ç¡®
- [ ] ä¸‹æ‹‰åˆ—è¡¨æ•°æ®æ­£ç¡®
- [ ] å®æ—¶æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶2è®°å¿†åŠŸèƒ½æ­£å¸¸
- [ ] æŒ‡æ´¾ä¿å­˜æˆåŠŸ
- [ ] "æŒ‡æ´¾ä»»åŠ¡"æŒ‰é’®åŠŸèƒ½æ­£å¸¸

**æ–°åŠŸèƒ½ - ä»»åŠ¡è¿½è¸ª**:
- [ ] è¿½è¸ªèœå•æ­£å¸¸
- [ ] è¿½è¸ªç•Œé¢æ˜¾ç¤ºæ­£ç¡®
- [ ] å®ŒæˆçŠ¶æ€åˆ¤æ–­æ­£ç¡®

**å…¼å®¹æ€§**:
- [ ] æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸
- [ ] è§’è‰²æƒé™æ­£å¸¸
- [ ] ç¼“å­˜æœºåˆ¶æ­£å¸¸
- [ ] è‡ªåŠ¨æ¨¡å¼æ­£å¸¸

#### æ­¥éª¤6.4: æ€§èƒ½æµ‹è¯•ï¼ˆ15åˆ†é’Ÿï¼‰

**æµ‹è¯•æŒ‡æ ‡**:
- å¯åŠ¨æ—¶é—´: < 2ç§’
- ç­›é€‰10ä¸ªæ–‡ä»¶: < 10ç§’
- æ‰“å¼€æŒ‡æ´¾ç•Œé¢: < 1ç§’
- è¾“å…¥å›æ–‡å•å·: < 2ç§’ï¼ˆå«Excelå†™å…¥ï¼‰

#### æ­¥éª¤6.5: ç”ŸæˆéªŒæ”¶æŠ¥å‘Šï¼ˆ20åˆ†é’Ÿï¼‰

**æ–‡ä»¶**: `document/åŠŸèƒ½éªŒæ”¶æŠ¥å‘Š.md`

**å†…å®¹**:
- åŠŸèƒ½å®Œæˆæƒ…å†µ
- æµ‹è¯•ç»“æœæ±‡æ€»
- å·²çŸ¥é—®é¢˜ï¼ˆå¦‚æœæœ‰ï¼‰
- åç»­ä¼˜åŒ–å»ºè®®

#### é˜¶æ®µ6å®Œæˆæ ‡å¿—
- [ ] æ‰“åŒ…é…ç½®æ›´æ–°å®Œæˆ
- [ ] EXEæˆåŠŸç”Ÿæˆ
- [ ] æ‰€æœ‰åŠŸèƒ½éªŒæ”¶é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] éªŒæ”¶æŠ¥å‘Šç”Ÿæˆ

---

## æ€»ç»“ä¸äº¤ä»˜

### äº¤ä»˜ç‰©æ¸…å•

**ä»£ç æ–‡ä»¶**:
- [ ] `input_handler.py` - å›æ–‡å•å·è¾“å…¥æ¨¡å—
- [ ] `distribution.py` - ä»»åŠ¡æŒ‡æ´¾æ¨¡å—
- [ ] ä¿®æ”¹çš„ `base.py`
- [ ] ä¿®æ”¹çš„ `window.py`
- [ ] ä¿®æ”¹çš„ `main.py`
- [ ] ä¿®æ”¹çš„ `file_manager.py`
- [ ] æ›´æ–°çš„ `excel_processor.spec`

**æµ‹è¯•æ–‡ä»¶**:
- [ ] `tests/test_responsible_person_display.py`
- [ ] `tests/test_input_handler.py`
- [ ] `tests/test_distribution.py`
- [ ] `tests/test_tracking.py`

**æ–‡æ¡£æ–‡ä»¶**:
- [ ] `document/å›æ–‡å•å·ä¸ä»»åŠ¡æŒ‡æ´¾åŠŸèƒ½éœ€æ±‚æ–‡æ¡£.md`
- [ ] `document/å›æ–‡å•å·ä¸ä»»åŠ¡æŒ‡æ´¾åŠŸèƒ½æ‰§è¡Œè®¡åˆ’.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- [ ] `document/åŠŸèƒ½éªŒæ”¶æŠ¥å‘Š.md`

**å¯æ‰§è¡Œæ–‡ä»¶**:
- [ ] `dist/æ¥å£ç­›é€‰/æ¥å£ç­›é€‰.exe`

### éªŒæ”¶æ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰éœ€æ±‚åŠŸèƒ½å…¨éƒ¨å®ç° âœ…
2. **å‘åå…¼å®¹æ€§**: ç°æœ‰åŠŸèƒ½é›¶ç ´å âœ…
3. **æµ‹è¯•è¦†ç›–ç‡**: æ–°å¢30+æµ‹è¯•ç”¨ä¾‹ï¼Œå…¨éƒ¨é€šè¿‡ âœ…
4. **ä»£ç è´¨é‡**: éµå¾ªç°æœ‰ä»£ç é£æ ¼ï¼Œå……åˆ†æ³¨é‡Š âœ…
5. **æ€§èƒ½è¦æ±‚**: æ»¡è¶³æ€§èƒ½æŒ‡æ ‡ âœ…
6. **ç”¨æˆ·ä½“éªŒ**: ç•Œé¢å‹å¥½ï¼Œæ“ä½œæµç•… âœ…

### åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**: 
   - å¤§æ–‡ä»¶å¤„ç†æ—¶çš„è¿›åº¦æ¡æ˜¾ç¤º
   - æŒ‡æ´¾ç•Œé¢çš„è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚æœä»»åŠ¡æ•°é‡å¾ˆå¤§ï¼‰

2. **åŠŸèƒ½å¢å¼º**:
   - æ‰¹é‡æŒ‡æ´¾åŠŸèƒ½
   - æŒ‡æ´¾å†å²è®°å½•
   - å¯¼å‡ºæŒ‡æ´¾æŠ¥è¡¨

3. **ç”¨æˆ·ä½“éªŒ**:
   - é”®ç›˜å¿«æ·é”®æ”¯æŒ
   - å³é”®èœå•
   - åŒå‡»æ¥å£å·ä¹Ÿè§¦å‘è¾“å…¥

---

**æ‰§è¡Œè®¡åˆ’å®Œæˆï¼ç¥å®æ–½é¡ºåˆ©ï¼ğŸš€**

