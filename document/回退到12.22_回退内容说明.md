## 回退结论

- **目标版本**：`822b617`（commit message：`12.22`，时间：2025-12-22 16:28:22 +0800）
- **当前仓库状态**：已回退到上述提交，工作区已清理为干净状态（无本地修改、无未跟踪文件）。
- **执行的回退动作**：
  - `git reset --hard 822b617`：丢弃工作区/暂存区的所有改动，使代码与 12.22 完全一致
  - `git clean -fd`：删除所有未跟踪文件/目录

> 重要说明：本次回退前的改动均为“未提交改动”，因此回退后 Git 中不再保留这些改动的逐行 diff 内容。
> 本文档记录的是**回退前 Git 状态中出现过的文件清单**与**回退动作会丢弃/删除哪些内容**。


## 回退前（未提交）的改动文件清单

以下文件在回退前处于 **modified (M)** 状态（内容有改动但未提交）：

- `base.py`
- `distribution.py`
- `input_handler.py`
- `main.py`
- `pytest.ini`
- `registry/config.py`
- `registry/db.py`
- `registry/service.py`
- `tests/conftest.py`
- `tests/test_auto_hide_overdue.py`
- `tests/test_auto_mode_fixes.py`
- `tests/test_collect_overdue_from_db.py`
- `tests/test_collect_overdue_tasks.py`
- `tests/test_department_and_config_fix.py`
- `tests/test_real_scenarios_comprehensive.py`
- `tests/test_registry_e2e.py`
- `tests/test_three_critical_fixes.py`
- `window.py`
- `write_tasks/manager.py`
- `write_tasks/task_panel.py`

以下文件在回退前处于 **untracked (??)** 状态（新增但未提交）：

- `app_paths.py`
- `tests/test_cache_reuse_raw_result_for_project.py`
- `tests/test_incremental_refresh_queue_from_write_task.py`
- `tests/test_negative_cache_empty_results.py`
- `tests/test_registry_db_path_does_not_prefer_registry_dir_without_db.py`
- `tests/test_registry_finalize_decision.py`
- `tests/test_reuse_changed_files_between_refresh_and_start.py`
- `tests/test_start_processing_auto_refresh_if_needed.py`


## 回退时被清理（删除）的未跟踪文件/目录

由于执行了 `git clean -fd`，回退过程中删除了未跟踪的文件/目录（典型包括）：

- `.cursor/`
- `Process File/`
- 上述 **untracked (??)** 的新增测试文件、`app_paths.py`


## 回退后你将看到的变化（对使用侧的影响）

回退后代码恢复为 12.22 版本，因此以下“回退前本地改动带来的行为变化”将不再存在（以 12.22 为准）：

- 写入任务本地落盘路径/`result_cache` 路径相关的调整（若你在开机自启场景仍遇到权限问题，需要在 12.22 基础上重新、但更谨慎地做最小修复）
- 写入任务记录窗 UI 的“本地/数据库”标识与按钮调整
- 文件3 `4444` 特殊时间展示与 UI 兜底逻辑
- 用户切换（姓名/角色）触发的自动重筛选/缓存复用修复
- 近期新增的多项 pytest 用例（上面列出的新增测试文件）


## 建议（避免下次回退丢失差异明细）

如果你希望以后能在回退时得到“逐行 diff”，建议回退前先做其中之一：

- `git stash push -u -m "wip before rollback"`（保存所有未提交改动，包含未跟踪文件）
- 或建立一个 WIP 提交（哪怕临时提交到独立分支），再回退主分支


